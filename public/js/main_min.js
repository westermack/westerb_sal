$(function(){Object.defineProperty(Object.prototype,"westerb_sal",{writable:!0,enumerable:!1,configurable:!1,value:Object.create(null)});Object.defineProperty(Object.prototype.westerb_sal,"HOME",{writable:!1,enumerable:!0,configurable:!0,value:"localhost"===window.location.host?"http://localhost/westerb_sal/public/":"http://thesalonproject.com/"});Object.defineProperty(Object.prototype.westerb_sal,"cur_pg",{writable:!0,enumerable:!0,configurable:!0,value:""});(function(){var a=location.href;/(public\/|thesalonproject.com\/)(?!admin)(index.php)?/i.test(a)? westerb_sal.cur_pg="public_index":/admin\/(#)?(index.php(#)?)?$/i.test(a)?westerb_sal.cur_pg="admin_index":/admin\/list_albums.php/i.test(a)?westerb_sal.cur_pg="list_albums":/admin\/list_photos.php/i.test(a)?westerb_sal.cur_pg="list_photos":/admin\/create_album.php/i.test(a)?westerb_sal.cur_pg="create_album":/admin\/photo_upload.php/i.test(a)?westerb_sal.cur_pg="photo_upload":/admin\/login.php/i.test(a)?westerb_sal.cur_pg="login":/admin\/add_user.php/i.test(a)?westerb_sal.cur_pg="add_user":/admin\/list_users.php/i.test(a)? westerb_sal.cur_pg="list_users":/admin\/logfile.php/i.test(a)&&(westerb_sal.cur_pg="logfile")})();Object.defineProperty(Object.prototype.westerb_sal,"getScrollOffsets",{writable:!1,enumerable:!0,configurable:!0,value:function(a){a=a||window;if(null!=a.pageXOffset)return{x:a.pageXOffset,y:a.pageYOffset};a=a.document;return"CSS1Compat"==document.compatMode?{x:a.documentElement.scrollLeft,y:a.documentElement.scrollTop}:{x:a.body.scrollLeft,y:a.body.scrollTop}}});Object.defineProperty(Object.prototype.westerb_sal, "scroll_to_dialog",{writable:!1,enumerable:!0,configurable:!0,value:function(){1===$("#blinker").size()?$("#blinker").get(0).scrollIntoView():1===$("#login_prompt_wrapper")&&$("#login_prompt_wrapper").get(0).scrollIntoView()}});Object.defineProperty(Object.prototype.westerb_sal,"blocking_dialog",{writable:!0,enumerable:!0,configurable:!0,value:!1});Object.defineProperty(Object.prototype.westerb_sal,"is_logged_in",{writable:!0,enumerable:!0,configurable:!0,value:!1});Object.defineProperty(Object.prototype.westerb_sal, "blocking_login_dialog",{value:!1,writable:!0,enumerable:!0,configurable:!1});Object.defineProperty(Object.prototype.westerb_sal,"readjust_general_public_elems",{value:function(){var a=$("#outer_wrapper").innerWidth(),b=a/3.05,c=a/4.91,d=a/7.64,e=a/2.966,f=a/3.34,g=a/3.7,l=a/24.1,m=a/33.125,q=a/13.55,n=a/162,k=a/36.3,p=a/($("#outer_wrapper").hasClass("selected_album_wrapper")?3.5:2.94);$(".public_unit_img").css({width:p,height:p});$("#unit_wrapper").css("min-height",2*p+a/19.7);$("#unit_info").css("width", a/2.2);$(".album_preview").css("height",e);$(".previews_available, .no_previews").css("height",f);$(".a_preview_img").css({width:q,height:q,"margin-right":n,"margin-bottom":k});$(".absolute_pos.name, .absolute_pos.date_owner").css("width",b);$(".absolute_pos.show_prevs").css({width:c,left:d});$(".absolute_pos.no_cover_message").css({width:g,left:l,"font-size":m})},writable:!0,enumerable:!0,configurable:!0});Object.defineProperty(Object.prototype.westerb_sal,"on_display_img_natural_width",{value:0, writable:!0,enumerable:!0,configurable:!1});Object.defineProperty(Object.prototype.westerb_sal,"on_display_img_natural_height",{value:0,writable:!0,enumerable:!0,configurable:!1});Object.defineProperty(Object.prototype.westerb_sal,"readjust_gallery_elems",{value:function(){var a=$("#outer_wrapper"),b=$("div.centering:last"),c=b.innerWidth(),d=$("#gallery_thumbs_wrapper"),e=$("#on_display_gallery_img"),f=c/(1162/westerb_sal.on_display_img_natural_width),g=c/7.2,l=$("#post_comment #author.char_counter, #post_comment input[name=submit], #post_comment #comment.field_msg"), m=$("#loaded_info, #photo_info"),q=$("#loaded_info .no_unit_data"),n=parseInt($("#photo_info").css("height"),10),k=westerb_sal.on_display_img_natural_height*c/1162;340>westerb_sal.on_display_img_natural_width?e.css("width",340):(e.css("width",f),340>parseInt(e.css("width"),10)&&e.css("width",340));$("#unit_info").css("width",c/3.32);$("#post_comment input[name=submit]").css({"margin-left":c/46.48});$("#post_comment input[name=author]").css({width:g,"min-width":g});910>c?(l.css("font-size","12px"), q.css("font-size","13px")):(l.css("font-size",l.eq(2).hasClass("error_msg")||l.eq(2).hasClass("notice_msg")?"13px":"16px"),q.css("font-size","14px"));1140>c&&"430px"!=m.eq(0).css("max-height")?m.css("max-height","-=65"):1140<c&&"495px"!=m.eq(0).css("max-height")&&m.css("max-height","+=65");a.css("margin-left",(c-(a.innerWidth()+$("#unit_info").innerWidth()))/2);d.css("margin-left",(c-d.innerWidth())/2);""!=$("#u_count").text()&&(335>n&&355>k&&370<parseInt(e.css("height"))&&710>c?b.css("min-height", "630px"):335>n&&355>k?b.css("min-height","560px"):375>n?435>k?b.css("min-height","630px"):475>k?b.css("min-height","670px"):b.css("min-height",58+k+100+30+"px"):415>n?475>k?b.css("min-height","670px"):520>k?b.css("min-height","700px"):b.css("min-height",58+k+100+30+"px"):460>n?(520>k&&b.css("min-height","700px"),555>k?b.css("min-height","720px"):b.css("min-height",58+k+100+30+"px")):500>n&&(555>k?b.css("min-height","750px"):b.css("min-height",58+k+100+30+"px")))},writable:!0,enumerable:!0,configurable:!0}); Object.defineProperty(Object.prototype.westerb_sal,"reposition_modal_box",{value:function(){var a=$("#modal_dialog");a.parent("div").css({top:(window.innerHeight-parseInt(a.css("height"),10))/2+westerb_sal.getScrollOffsets().y,left:(window.innerWidth-parseInt(a.css("width"),10))/2+westerb_sal.getScrollOffsets().x})},writable:!0,enumerable:!0,configurable:!0});Object.defineProperty(Object.prototype.westerb_sal,"prompt_login",{value:function(){$("#main_ui_msg_dialog_wrapper").remove();westerb_sal.blocking_login_dialog= westerb_sal.blocking_dialog=!0;$("body").append("<div class='login_dialog' id='login_prompt_wrapper' style='position: absolute; max-width: 700px; border: 5px dotted rgba(29, 29, 29, .8); background-color: rgba(35, 197, 197, .65); padding: 2px; border-radius: 5px; z-index: 5001; '><div class='login_dialog' id='login_prompt_dialog' style='background-color: rgba(245, 245, 245, .9); padding: 10px 15px 15px; box-sizing: border-box; '></div></div>");var a;a="<div class='login_dialog' style='color: #333; font-weight: bold; font-size: 13px; line-height: 18px; '>You appear to be logged out. Please sign in to continue browsing The S<span class='a'>a</span><span class='l'>l</span><span class='o'>o</span><span class='n'>n</span> Admin area</div>"+ ("<form id='login_form' class='modal_dialog big_form' action='"+westerb_sal.HOME+"admin/login.php' method='post'><p><span class='label' id='for_username'>Username</span><input class='p_holder has_pword form_field validate_on_sub reqrd msg_span' type='text' name='username' value='' maxlength='50'></p><p class='pass_text'><span class='label'>Password</span><input class='form_field reqrd validate_on_sub' type='password' name='password' value='' maxlength='40'><input class='form_field msg_span' type='text' value='' name='password_placeholder' maxlength='40'></p><div><input id='login' class='form_field ui_button' type='submit' name='submit' value='LOGIN'><div id='modal_processing_msg' style='position: absolute; top: 8px; left: 85px; width: 125px; color: #333; font-weight: bold; '></div><div id='msg_wrapper' style='position: absolute; top: 6px; left: 200px; width: 440px; z-index: 100; '></div></div></form><script src='"+ westerb_sal.HOME+"js/includes/form_min.js'>\x3c/script>");var b=$("#login_prompt_dialog");b.parent("div").css("visibility","hidden");b.html(a);b.parent("div").css({top:(window.innerHeight-parseInt(b.css("height"),10))/2+westerb_sal.getScrollOffsets().y,left:(window.innerWidth-parseInt(b.css("width"),10))/2+westerb_sal.getScrollOffsets().x}).hide().css("visibility","visible").fadeIn(200);$(document).scroll(westerb_sal.reposition_modal_box);$(window).resize(westerb_sal.reposition_modal_box)},writable:!1, enumerable:!0,configurable:!0});Object.defineProperty(Object.prototype.westerb_sal,"check_login",{value:function(){$.get(westerb_sal.HOME+"ajax/misc_calls.php","is_logged_in",function(a,b,c){westerb_sal.is_logged_in="true"===$.trim(a)?!0:!1;westerb_sal.is_logged_in||westerb_sal.blocking_login_dialog||"public_index"===westerb_sal.cur_pg||"login"===westerb_sal.cur_pg?westerb_sal.is_logged_in&&westerb_sal.blocking_login_dialog&&($("#login_prompt_dialog").parent("div").remove(),$(document).unbind("scroll", westerb_sal.reposition_modal_box),$(window).unbind("resize",westerb_sal.reposition_modal_box),westerb_sal.blocking_login_dialog=westerb_sal.blocking_dialog=!1):westerb_sal.prompt_login()})},writable:!0,enumerable:!0,configurable:!0});Object.defineProperty(Object.prototype.westerb_sal,"check_login_timer",{writable:!0,enumerable:!0,configurable:!0,value:null});westerb_sal.check_login();window.setTimeout(function(){westerb_sal.is_logged_in&&(westerb_sal.check_login_timer=window.setInterval(westerb_sal.check_login, 6E3))},1E3);jQuery.ajaxSetup({timeout:2E4});$(".hover_triggered").hide();Object.defineProperty(Object.prototype.westerb_sal,"extend",{writable:!0,enumerable:!0,configurable:!0,value:function(a){for(var b=Object.getOwnPropertyNames(a),c=0;c<b.length;c++)if(!(b[c]in this)){var d=Object.getOwnPropertyDescriptor(a,b[c]);Object.defineProperty(this,b[c],d)}}});Object.defineProperty(Object.prototype.westerb_sal,"reposition_main_p_msg",{writable:!1,enumerable:!0,configurable:!0,value:function(){var a=$("#main_processing_msg"); a.css({top:(window.innerHeight-parseInt(a.css("height"),10))/2+westerb_sal.getScrollOffsets().y,left:(window.innerWidth-parseInt(a.css("width"),10))/2+westerb_sal.getScrollOffsets().x})}});$("body").append("<div id='main_processing_msg' class='hash_change_removable' style='width: 210px; height: 40px; position: absolute; font-weight: bold; z-index: -1; '></div>");var p=$("#main_processing_msg");p.css({top:(window.innerHeight-parseInt(p.css("height"),10))/2+westerb_sal.getScrollOffsets().y,left:(window.innerWidth- parseInt(p.css("width"),10))/2+westerb_sal.getScrollOffsets().x});$(window).resize(westerb_sal.reposition_main_p_msg);"undefined"!==typeof FormData&&Object.defineProperty(Object.prototype.westerb_sal,"post_FormData",{writable:!1,enumerable:!0,configurable:!0,value:function(a){var b=new FormData,c,d;for(d in westerb_sal.form.fields)if(c=westerb_sal.form.fields[d],"submit"!==d){var e=c.val();"file"===c.attr("type")&&(e=c.prop("files")[0]);c.hasClass("radios")&&westerb_sal.form[d].forEach(function(a, b,c){a.is(":checked")&&(d=a.attr("name"),e=a.val())});b.append(d,e)}a.send(b)}});Object.defineProperty(Object.prototype.westerb_sal,"rand",{writable:!1,enumerable:!0,configurable:!0,value:function(a){a||(a=5);return Math.ceil(Math.random()*a)}});Object.defineProperty(Object.prototype.westerb_sal,"get_url_param_value",{writable:!1,enumerable:!0,configurable:!0,value:function(a){var b=window.location.search.slice(1).split("&"),c=param_val=null;b.forEach(function(b,e,f){c=b.split("=");c[0]===a&&(param_val= c[1])});return param_val}});Object.defineProperty(Object.prototype.westerb_sal,"create_xhr",{writable:!1,enumerable:!0,configurable:!0,value:function(){if(XMLHttpRequest)return new XMLHttpRequest;try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(a){try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(b){throw Error("An error occurred: XMLHttpRequest is not supported by this browser");}}}});Object.defineProperty(Object.prototype.westerb_sal,"full_screen_mode",{writable:!1,enumerable:!0, configurable:!0,value:function(){var a=$("#body").get(0),b=a.requestFullscreen||a.mozRequestFullScreen||a.webkitRequestFullScreen||a.msRequestFullScreen||a.oRequestFullScreen;if(b)b.call(a);else if(window.ActiveXObject)try{(new ActiveXObject("WScript.Shell")).SendKeys("{F11}"),alert("a_x")}catch(c){}}});Object.defineProperty(Object.prototype.westerb_sal,"exit_full_screen_mode",{writable:!1,enumerable:!0,configurable:!0,value:function(){var a=document.exitFullscreen||document.cancelFullscreen||document.mozCancelFullScreen|| document.webkitCancelFullScreen||document.msCancelFullScreen||document.oCancelFullScreen;a&&a.call(document)}});Object.defineProperty(Object.prototype.westerb_sal,"is_full_screen",{writable:!1,enumerable:!0,configurable:!0,value:function(){return document.fullScreen||document.mozfullScreen||document.webkitIsFullScreen||window.fullScreen}});Object.defineProperty(Object.prototype.westerb_sal,"log_action",{writable:!1,enumerable:!0,configurable:!0,value:function(a){$.get(westerb_sal.HOME+"ajax/misc_calls.php", {log_action:a})}});Object.defineProperty(Object.prototype.westerb_sal,"count",{writable:!1,enumerable:!0,configurable:!0,value:function(a){txt_len=$(this).val().length;txt_len>a.data.max_len&&($(this).val($(this).val().substring(0,a.data.max_len)),txt_len=a.data.max_len);$(this).siblings("div").children("span").text(a.data.max_len-txt_len)}});Object.defineProperty(Object.prototype.westerb_sal,"p_timers",{writable:!0,enumerable:!0,configurable:!0,value:[]});Object.defineProperty(Element.prototype, "processing_msg",{writable:!1,enumerable:!0,configurable:!0,value:function(a){a||(a="");var b=$(this);b.html(a);westerb_sal.p_timers[0]=window.setTimeout(function(){b.append('<span id="b_dot" class="processing_ellipsis">&bull;</span>')},200);westerb_sal.p_timers[1]=window.setTimeout(function(){b.append('<span id="r_dot" class="processing_ellipsis">&bull;</span>')},420);westerb_sal.p_timers[2]=window.setTimeout(function(){b.append('<span id="y_dot" class="processing_ellipsis">&bull;</span>')},670); westerb_sal.p_timers[3]=window.setTimeout(function(){b.append('<span id="g_dot" class="processing_ellipsis">&bull;</span>')},920);westerb_sal.p_timers[4]=window.setTimeout(function(){b.get(0).processing_msg(a)},1120)}});Object.defineProperty(Object.prototype.westerb_sal,"clear_p_timers",{writable:!1,enumerable:!0,configurable:!0,value:function(){i=0;for(len=westerb_sal.p_timers.length;i<len;i++)window.clearTimeout(westerb_sal.p_timers[i])}});Object.defineProperty(Object.prototype.westerb_sal,"prop_exists", {writable:!1,enumerable:!0,configurable:!0,value:function(a){return this[a]?!0:!1}});Object.defineProperty(Object.prototype.westerb_sal,"store_page",{writable:!1,enumerable:!0,configurable:!0,value:function(a,b){sessionStorage.setItem(a,JSON.stringify(b))}});sessionStorage.getItem("public_index")||westerb_sal.store_page("public_index",Object.create(null));sessionStorage.getItem("list_albums")||westerb_sal.store_page("list_albums",Object.create(null));sessionStorage.getItem("list_photos")||westerb_sal.store_page("list_photos", Object.create(null));Object.defineProperty(Object.prototype.westerb_sal,"store_set",{writable:!1,enumerable:!0,configurable:!0,value:function(a,b){var c=JSON.parse(sessionStorage.getItem(westerb_sal.cur_pg));Object.defineProperty(c,a,{writable:!0,enumerable:!0,configurable:!0,value:b});westerb_sal.store_page(westerb_sal.cur_pg,c)}});Object.defineProperty(Object.prototype.westerb_sal,"retrieve_set",{writable:!1,enumerable:!0,configurable:!0,value:function(a){return JSON.parse(sessionStorage.getItem(westerb_sal.cur_pg))[a]}}); Object.defineProperty(Object.prototype.westerb_sal,"clear_sets",{writable:!1,enumerable:!0,configurable:!0,value:function(a){a||(a=westerb_sal.cur_pg);sessionStorage.setItem(a,JSON.stringify(Object.create(null)))}});Object.defineProperty(Object.prototype.westerb_sal,"clear_set",{writable:!1,enumerable:!0,configurable:!0,value:function(a){a||(a=westerb_sal.cur_pg+"_"+westerb_sal.pagination.set_group+"_s"+westerb_sal.pagination.current_set);westerb_sal.store_set(a,"")}});Object.defineProperty(Object.prototype.westerb_sal, "store_outer_wrapper_state",{writable:!1,enumerable:!0,configurable:!0,value:function(a,b){b||($(".hover_triggered").hide(),$(".album_preview").css({width:0,display:"none"}),b=$(".centering:last").html());sessionStorage.setItem(a,b)}});Object.defineProperty(Object.prototype.westerb_sal,"retrieve_outer_wrapper_state",{writable:!1,enumerable:!0,configurable:!0,value:function(a){return sessionStorage.getItem(a)}});Object.defineProperty(Object.prototype.westerb_sal,"clear_outer_wrapper_state",{writable:!1, enumerable:!0,configurable:!0,value:function(){}});Object.defineProperty(Object.prototype.westerb_sal,"store_main_page_state",{writable:!1,enumerable:!0,configurable:!0,value:function(a,b){sessionStorage.setItem(a,JSON.stringify(b))}});Object.defineProperty(Object.prototype.westerb_sal,"retrieve_main_page_state",{writable:!1,enumerable:!0,configurable:!0,value:function(a){a=sessionStorage.getItem(a);return"string"===typeof a?JSON.parse(a):null}});Object.defineProperty(Object.prototype.westerb_sal, "clear_main_page_state",{writable:!1,enumerable:!0,configurable:!0,value:function(a){a||(a=window.location.hash);sessionStorage.removeItem(a)}});Object.defineProperty(Object.prototype.westerb_sal,"store_comments",{writable:!1,enumerable:!0,configurable:!0,value:function(a,b){sessionStorage.setItem(a,JSON.stringify(b))}});Object.defineProperty(Object.prototype.westerb_sal,"retrieve_comments",{writable:!1,enumerable:!0,configurable:!0,value:function(a){a=sessionStorage.getItem(a);return"string"===typeof a? JSON.parse(a):null}});Object.defineProperty(Object.prototype.westerb_sal,"clear_comments",{writable:!1,enumerable:!0,configurable:!0,value:function(a){sessionStorage.removeItem("list_photos_pc_id="+a)}});Object.defineProperty(Object.prototype.westerb_sal,"store_albums",{writable:!1,enumerable:!0,configurable:!0,value:function(a,b){sessionStorage.setItem(a,JSON.stringify(b))}});Object.defineProperty(Object.prototype.westerb_sal,"retrieve_albums",{writable:!1,enumerable:!0,configurable:!0,value:function(a){a= sessionStorage.getItem(a);return"string"===typeof a?JSON.parse(a):null}});Object.defineProperty(Object.prototype.westerb_sal,"clear_albums",{writable:!1,enumerable:!0,configurable:!0,value:function(a){sessionStorage.removeItem("list_albums_ao_id="+a)}});Object.defineProperty(Object.prototype.westerb_sal,"store_notes",{writable:!1,enumerable:!0,configurable:!0,value:function(a,b){sessionStorage.setItem(a,JSON.stringify(b))}});Object.defineProperty(Object.prototype.westerb_sal,"retrieve_notes",{writable:!1, enumerable:!0,configurable:!0,value:function(a){a=sessionStorage.getItem(a);return"string"===typeof a?JSON.parse(a):null}});Object.defineProperty(Object.prototype.westerb_sal,"clear_notes",{writable:!1,enumerable:!0,configurable:!0,value:function(a){sessionStorage.removeItem("list_albums_an_id="+a)}});Object.defineProperty(Object.prototype.westerb_sal,"msg_remove_timer",{writable:!0,enumerable:!0,configurable:!0,value:!1});Object.defineProperty(Object.prototype.westerb_sal,"display_msg",{writable:!1, enumerable:!0,configurable:!0,value:function(a,b,c,d){window.clearTimeout(westerb_sal.msg_remove_timer);$("div.message_wrapper").remove();a||(a="Something went wrong. Refresh the page and try again.");b||(b="error");c||(c=4E3);var e=!1,f=$("#upload_progress_percent");"photo_upload"!==westerb_sal.cur_pg&&"#photo_upload"!==window.location.hash||!westerb_sal.progress_events||(e=!0);if(e)var g=0,l=function(){0===g&&(f.css("top","85px"),g++);f.css("top",parseInt(f.css("top"),10)+5+"px");135>parseInt(f.css("top"), 10)&&window.setTimeout(l,0)},m=function(){f.css("top",parseInt(f.css("top"),10)-5+"px");85<parseInt(f.css("top"),10)&&window.setTimeout(m,0)};$(document).scrollTop(0);$("#main h2:first").after("<div style='display: none; "+("public_index"===westerb_sal.cur_pg?"line-height: 15px; ":"")+("photo_upload"===westerb_sal.cur_pg?"margin-bottom: 12px; ":"public_index"===westerb_sal.cur_pg?"margin-bottom: 10px; ":"")+"z-index: 1000;' class='message_wrapper'><div class='alertBox "+b+"'>"+a+"</div></div>");e&& l();$("div.message_wrapper").slideDown(300);westerb_sal.msg_remove_timer=window.setTimeout(function(){e&&m();$("div.message_wrapper").slideUp(300,function(){$(this).remove()})},c+300);westerb_sal.request_done=!0;$("#wait_msg").fadeOut(10,function(){$(this).remove()})}});Object.defineProperty(Object.prototype.westerb_sal,"display_dialog_msg",{writable:!1,enumerable:!0,configurable:!0,value:function(a,b){function c(){e.parent("div").fadeOut(200,function(){$(this).remove()});$("div").not("div.main_dialog").unbind("click", c);$(document).unbind("scroll",westerb_sal.reposition_modal_box);$(window).unbind("resize",westerb_sal.reposition_modal_box)}westerb_sal.request_done=!0;$("#wait_msg").fadeOut(10,function(){$(this).remove()});$("#temp_content_holder").remove();a||(a="Something went wrong while performing your request. Please refresh the page and try again");b||(b="error");$("body").append("<div class='main_dialog' id='main_ui_msg_dialog_wrapper' style='position: absolute; max-width: 485px; border: 5px dotted rgba(29, 29, 29, .8); background-color: rgba("+ ("error"===b?"162, 25, 31":"notice"===b?"195, 101, 0":"info"===b?"35, 197, 197":"147, 165, 11")+", ."+("error"===b?"7":"65")+"); padding: 2px; border-radius: 5px; z-index: 5000; '><div class='main_dialog' id='main_ui_msg_dialog' style='background-color: rgba(245, 245, 245, .9); padding: 4px 8px; box-sizing: border-box; '></div></div>");var d;d="<div class='main_dialog' style='color: #333; font-weight: bold; font-size: 15px; line-height: 18px; '>"+a+"</div><div class='main_dialog' style='text-align: center; margin: 15px 0 4px; '>"; d+="<div id='main_dialog_ok' style='display: inline-block; padding: 10px; ' class='ui_button main_dialog dialog_choice'>ALRIGHT</div>";d+="</div>";var e=$("#main_ui_msg_dialog");e.parent("div").css("visibility","hidden");e.html(d);e.parent("div").css({top:(window.innerHeight-parseInt(e.css("height"),10))/2+westerb_sal.getScrollOffsets().y,left:(window.innerWidth-parseInt(e.css("width"),10))/2+westerb_sal.getScrollOffsets().x}).hide().css("visibility","visible").fadeIn(200);$(document).scroll(westerb_sal.reposition_modal_box); $(window).resize(westerb_sal.reposition_modal_box);$(".dialog_choice").click(c);$("div").not("div.main_dialog").bind("click",c)}});Object.defineProperty(Object.prototype.westerb_sal,"display_modal_msg",{writable:!1,enumerable:!0,configurable:!0,value:function(a,b,c){a||(a="Something went wrong. Refresh the page and try again.");b||(b="error");c||(c=3500);var d=color="";switch(b){case "error":d="#F9E5E6";color="#AA1221";break;case "notice":d="#F7F0CB";color="#C46600";break;case "info":d="#D8ECF5"; color="#2E81A8";break;case "success":d="#E6F0C2",color="#967B35"}window.clearTimeout(westerb_sal.msg_remove_timer);$("#msg_wrapper #modal_msg").remove();$("#msg_wrapper").append("<div id='modal_msg' style='position: absolute; padding: 4px; font-weight: bold; background-color: "+d+"; color: "+color+"; border-radius: 3px; z-index: 1001;'></div>");$("#modal_msg").hide().text(a).fadeIn(200,function(){westerb_sal.msg_remove_timer=window.setTimeout(function(){$("#modal_msg").fadeOut(200,function(){$(this).remove()})}, c)});westerb_sal.request_done=!0;westerb_sal.form.xhr_in_progress=!1}});Object.defineProperty(Object.prototype.westerb_sal,"please_wait_msg",{writable:!1,enumerable:!0,configurable:!0,value:function(a,b){b?($("#msg_wrapper #modal_msg").remove(),$("#msg_wrapper").append("<div id='modal_msg' style='position: absolute; padding: 4px; font-weight: bold; background-color: #F7F0CB; color: #C46600; border-radius: 3px; z-index: 1001;'></div>"),$("#modal_msg").hide().text("Please wait a moment...").fadeIn(200), window.setTimeout(function(){$("#modal_msg").fadeOut(200,function(){$(this).remove()})},2400)):"submit"==a.type?westerb_sal.display_msg("Please wait a moment...","notice",2400):($("#wait_msg").remove(),$("body").append("<div id='wait_msg' style='position: absolute; padding: 4px; font-weight: bold; background-color: #F7F0CB; color: #C46600; border-radius: 3px; z-index: 1001;'></div>"),$("#wait_msg").css({top:a.pageY-7,left:a.pageX+20}).hide().html("Please wait...").fadeIn(200),window.setTimeout(function(){$("#wait_msg").fadeOut(200, function(){$(this).remove()})},1900))}});Object.defineProperty(Object.prototype.westerb_sal,"Scroll_Pagination",{writable:!0,enumerable:!0,configurable:!0,value:function(){this.current_set=1;this.units_per_set=parseInt($("div.u_wrapper").attr("scroll_per_set"),10);this.unit_count=this.calc_unit_count;this.set_count=this.calc_set_count;this.next_set=this.next_page;this.offset=this.calc_offset}});Object.defineProperties(westerb_sal.Scroll_Pagination.prototype,{next_page:{value:function(){var a;return(a= this.current_set+1)>this.set_count()?!1:a},writable:!0,enumerable:!0,configurable:!0},calc_offset:{value:function(){return this.units_per_set*(this.current_set-1)},writable:!0,enumerable:!0,configurable:!0},calc_unit_count:{value:function(){if("list_photos"===westerb_sal.cur_pg)return parseInt($(".clicked").attr("u_count"),10);if("list_albums"===westerb_sal.cur_pg)return parseInt($(".clicked_o_name").attr("u_count"),10);if("public_index"===westerb_sal.cur_pg)return parseInt($("#c_count").children("span").text(), 10)},writable:!0,enumerable:!0,configurable:!0},calc_set_count:{value:function(){return Math.ceil(this.unit_count()/this.units_per_set)},writable:!0,enumerable:!0,configurable:!0}});Object.defineProperty(Object.prototype.westerb_sal,"xhr_for_units",{writable:!1,enumerable:!0,configurable:!0,value:westerb_sal.create_xhr()});Object.defineProperty(Object.prototype.westerb_sal,"get_units_animation_timer",{writable:!0,enumerable:!0,configurable:!0,value:null});Object.defineProperty(Object.prototype.westerb_sal, "handle_xhr_for_units_response",{writable:!1,enumerable:!0,configurable:!0,value:function(){4===westerb_sal.xhr_for_units.readyState&&(window.clearTimeout(westerb_sal.get_units_animation_timer),westerb_sal.clear_p_timers(),200===westerb_sal.xhr_for_units.status?(westerb_sal.store_set(westerb_sal.cur_pg+"_"+westerb_sal.pagination.set_group+"_s"+westerb_sal.pagination.current_set,westerb_sal.xhr_for_units.responseText),"list_photos"===westerb_sal.cur_pg?(/Error:/.test(westerb_sal.xhr_for_units.responseText)? ($("table tbody").attr("remaining_u_count",$("tbody tr").size()),0!=$("table tbody").attr("remaining_u_count")&&1!=$("table tbody").attr("remaining_u_count")||1==westerb_sal.pagination.current_set?$("#ajax_loading_pholder").html(westerb_sal.xhr_for_units.responseText.replace("Error:","")):(westerb_sal.pagination.current_set--,westerb_sal.xhr_for_units.open("get",westerb_sal.HOME+"ajax/list_photos_u_retrieve.php?u_per_set="+westerb_sal.pagination.units_per_set+"&offset="+westerb_sal.pagination.offset()+ "&o_id="+westerb_sal.pagination.albums_owner+"&a_id="+westerb_sal.pagination.album_selected,!0),westerb_sal.xhr_for_units.send(null)),westerb_sal.clear_sets()):($("#ajax_loading_pholder").html(""),$("table tbody").html(westerb_sal.xhr_for_units.responseText),$("form.mini_form").find("span.char_counter").each(function(){var a=$(this).parents("form.mini_form").find(".mini_form_edit_field");$(this).text(parseInt(a.attr("maxlength"),10)-a.val().length)}),$("table tbody").attr("remaining_u_count",$("tbody tr").size()), westerb_sal.pagination.adjust_prev_and_next()),1!=westerb_sal.perms&&$("#ux_nav_guide").text(westerb_sal.pagination.ux_nav_guide())):($("div.movable").html(westerb_sal.xhr_for_units.responseText),westerb_sal.readjust_general_public_elems())):"list_photos"===westerb_sal.cur_pg?($("table thead").hide(),$("#ajax_loading_pholder").html("failure: "+westerb_sal.xhr_for_units.status)):$("div.movable").html("<div id='pholder_f_msg'>failure: "+westerb_sal.xhr_for_units.status+"</div>"),westerb_sal.request_done= !0)}});westerb_sal.xhr_for_units.onreadystatechange=westerb_sal.handle_xhr_for_units_response;Object.defineProperty(Object.prototype.westerb_sal,"display_gallery_unit",{value:function(){$("#temp_content_holder").children("img, #loaded_info").css("display","none");var a=$("#temp_content_holder").children("img"),b=$("#temp_content_holder").children("#loaded_info");$("#temp_content_holder").remove();$("#outer_wrapper").find("#unit_wrapper img, #loaded_info").fadeOut(300,function(){"loaded_info"===$(this).attr("id")? ($(this).replaceWith(b),$("#photo_info").children("#loaded_info").fadeIn(300),8<parseInt($("#c_count").children("span").text())&&$("#loaded_info").scroll(westerb_sal.load_more_public_comments)):($(this).parent("#unit_wrapper").html(a).children("img").fadeIn(310,function(){westerb_sal.retrieve_outer_wrapper_state("photo_wrapper_pa_id_"+$("#unit_wrapper").attr("pa_id")+"_s_"+westerb_sal.pagination.current_set)||westerb_sal.store_outer_wrapper_state("photo_wrapper_pa_id_"+$("#unit_wrapper").attr("pa_id")+ "_s_"+westerb_sal.pagination.current_set,$(".centering:last").html())}),westerb_sal.on_display_img_natural_width=parseInt($("#on_display_gallery_img").attr("natural_width"),10),westerb_sal.on_display_img_natural_height=parseInt($("#on_display_gallery_img").attr("natural_height"),10),westerb_sal.readjust_gallery_elems(),westerb_sal.request_done=!0,$("#wait_msg").fadeOut(10,function(){$(this).remove()}),$("form.big_form").attr("p_id",$("#unit_wrapper img").attr("p_id")),$("#unit_wrapper img").hasClass("comments_locked")? $("input[name=author], input[name=submit], textarea").attr("disabled","disabled"):$("input[name=author], input[name=submit], textarea").removeAttr("disabled"))});if($(".field_msg#comment").hasClass("notice_msg")||$(".field_msg#comment").hasClass("error_msg"))$("textarea").removeClass("notice_bordered error_bordered"),$(".field_msg#comment").removeClass("notice_msg error_msg").addClass("char_counter").text($("textarea").attr("maxlength"));var c=$("img.gallery_thumb.current"),d=$("img.gallery_thumb[s_no="+ westerb_sal.pagination.current_set+"]");c.removeClass("current").wrap("<a href='"+westerb_sal.HOME+"index.php?"+westerb_sal.pagination.set_group+"&c_set="+c.attr("s_no")+"' class='scriptable_gen_link gallery_thumb_link'></a>");d.addClass("current").parent("a").replaceWith(d);westerb_sal.pagination.adjust_prev_and_next()},writable:!1,enumerable:!0,configurable:!0});Object.defineProperty(Object.prototype.westerb_sal,"handle_get_photo_unit_response",{value:function(a,b,c){westerb_sal.clear_p_timers(); $("#main_processing_msg").css("z-index","-1").html("");switch(b){case "error":westerb_sal.display_dialog_msg();break;case "timeout":westerb_sal.display_dialog_msg("The request is taking too long. Please refresh the page and try again","notice");break;case "success":westerb_sal.store_set(westerb_sal.cur_pg+"_"+westerb_sal.pagination.set_group+"_s"+westerb_sal.pagination.current_set,$("#temp_content_holder").html()),westerb_sal.display_gallery_unit()}},writable:!1,enumerable:!0,configurable:!0});Object.defineProperty(Object.prototype.westerb_sal, "get_previous_set",{writable:!1,enumerable:!0,configurable:!0,value:function(a){if(westerb_sal.pagination.previous_set())if(westerb_sal.blocking_dialog)westerb_sal.scroll_to_dialog();else if(westerb_sal.request_done)try{westerb_sal.pagination.current_set--;var b=westerb_sal.retrieve_set(westerb_sal.cur_pg+"_"+westerb_sal.pagination.set_group+"_s"+westerb_sal.pagination.current_set);b?"list_photos"===westerb_sal.cur_pg?window.setTimeout(function(){$("table tbody").html(b);$("form.mini_form").find("span.char_counter").each(function(){var a= $(this).parents("form.mini_form").find(".mini_form_edit_field");$(this).text(parseInt(a.attr("maxlength"),10)-a.val().length)});$("table tbody").attr("remaining_u_count",$("tbody tr").size())},210):$("#outer_wrapper").hasClass("selected_photo_wrapper")?($("#main").append("<div style='display: none; ' id='temp_content_holder'></div>"),$("#temp_content_holder").html(b),westerb_sal.display_gallery_unit()):window.setTimeout(function(){$("div.movable").html(b);westerb_sal.readjust_general_public_elems()}, 230):(westerb_sal.request_done=!1,"list_photos"===westerb_sal.cur_pg?(westerb_sal.get_units_animation_timer=window.setTimeout(function(){$("table tbody").children().css("visibility","hidden")},90),$("#ajax_loading_pholder").html("<div id='pholder_msg'></div>"),$("#pholder_msg").get(0).processing_msg("Loading")):$("#outer_wrapper").hasClass("selected_photo_wrapper")?(westerb_sal.reposition_main_p_msg(),$("#main_processing_msg").css("z-index","5000").get(0).processing_msg()):westerb_sal.get_units_animation_timer= window.setTimeout(function(){$("div.movable").html("<div id='pholder_p_msg'></div>");$("#pholder_p_msg").get(0).processing_msg("Loading")},150),$("#outer_wrapper").hasClass("selected_photo_wrapper")?($("#main").append("<div style='display: none; ' id='temp_content_holder'></div>"),$("#temp_content_holder").load(westerb_sal.HOME+"index.php?"+westerb_sal.pagination.set_group+"&c_set="+westerb_sal.pagination.current_set+"&ajax #unit_wrapper img, #loaded_info",westerb_sal.handle_get_photo_unit_response)): (westerb_sal.xhr_for_units.open("get",westerb_sal.HOME+"ajax/"+westerb_sal.cur_pg+"_u_retrieve.php?u_per_set="+westerb_sal.pagination.units_per_set+"&offset="+westerb_sal.pagination.offset()+"&o_id="+westerb_sal.pagination.albums_owner+"&a_id="+westerb_sal.pagination.album_selected+($(this).hasClass("mini_full_screen")?"&mini_full_screen":""),!0),westerb_sal.xhr_for_units.send(null)));var c=westerb_sal.is_full_screen()?602:582;$("#next").hasClass("inactive")&&$("#next").removeClass("inactive");westerb_sal.pagination.previous_set()|| $(this).children("#prev").addClass("inactive");$("#ux_nav_guide").text(westerb_sal.pagination.ux_nav_guide());"list_photos"===westerb_sal.cur_pg?($("table thead").show(),$("table tbody").fadeOut(150,function(){"list_photos"===westerb_sal.cur_pg?$("table tbody").fadeIn(500):($("div.movable").css("top",-c+"px"),$("div.movable").animate({top:0},300,"linear"))})):$("div.movable").animate({top:c},220,"linear",function(){"list_photos"===westerb_sal.cur_pg?$("table tbody").fadeIn(500):($("div.movable").css("top", -c+"px"),$("div.movable").animate({top:0},300,"linear"))})}catch(d){westerb_sal.pagination.current_set++,alert("Failed to connect to server:\n"+d.toString())}else westerb_sal.please_wait_msg(a);return!1}});Object.defineProperty(Object.prototype.westerb_sal,"get_next_set",{writable:!1,enumerable:!0,configurable:!0,value:function(a){if(westerb_sal.pagination.next_set()||$(this).hasClass("gallery_thumb_link"))if(westerb_sal.blocking_dialog)westerb_sal.scroll_to_dialog();else if(westerb_sal.request_done)try{$(this).hasClass("gallery_thumb_link")? westerb_sal.pagination.current_set=parseInt($(this).children("img.gallery_thumb").attr("s_no"),10):westerb_sal.pagination.current_set++;var b=westerb_sal.retrieve_set(westerb_sal.cur_pg+"_"+westerb_sal.pagination.set_group+"_s"+westerb_sal.pagination.current_set);b?"list_photos"===westerb_sal.cur_pg?window.setTimeout(function(){$("table tbody").html(b);$("form.mini_form").find("span.char_counter").each(function(){var a=$(this).parents("form.mini_form").find(".mini_form_edit_field");$(this).text(parseInt(a.attr("maxlength"), 10)-a.val().length)});$("table tbody").attr("remaining_u_count",$("tbody tr").size())},210):$("#outer_wrapper").hasClass("selected_photo_wrapper")?($("#main").append("<div style='display: none; ' id='temp_content_holder'></div>"),$("#temp_content_holder").html(b),westerb_sal.display_gallery_unit()):window.setTimeout(function(){$("div.movable").html(b);westerb_sal.readjust_general_public_elems()},230):(westerb_sal.request_done=!1,"list_photos"===westerb_sal.cur_pg?(westerb_sal.get_units_animation_timer= window.setTimeout(function(){$("table tbody").children().css("visibility","hidden")},90),$("#ajax_loading_pholder").html("<div id='pholder_msg'></div>"),$("#pholder_msg").get(0).processing_msg("Loading")):$("#outer_wrapper").hasClass("selected_photo_wrapper")?(westerb_sal.reposition_main_p_msg(),$("#main_processing_msg").css("z-index","5000").get(0).processing_msg()):westerb_sal.get_units_animation_timer=window.setTimeout(function(){$("div.movable").html("<div id='pholder_p_msg'></div>");$("#pholder_p_msg").get(0).processing_msg("Loading")}, 150),$("#outer_wrapper").hasClass("selected_photo_wrapper")?($("#main").append("<div style='display: none; ' id='temp_content_holder'></div>"),$("#temp_content_holder").load(westerb_sal.HOME+"index.php?"+westerb_sal.pagination.set_group+"&c_set="+westerb_sal.pagination.current_set+"&ajax #unit_wrapper img, #loaded_info",westerb_sal.handle_get_photo_unit_response)):(westerb_sal.xhr_for_units.open("get",westerb_sal.HOME+"ajax/"+westerb_sal.cur_pg+"_u_retrieve.php?u_per_set="+westerb_sal.pagination.units_per_set+ "&offset="+westerb_sal.pagination.offset()+"&o_id="+westerb_sal.pagination.albums_owner+"&a_id="+westerb_sal.pagination.album_selected+($(this).hasClass("mini_full_screen")?"&mini_full_screen":""),!0),westerb_sal.xhr_for_units.send(null)));var c=westerb_sal.is_full_screen()?602:582;$("#prev").hasClass("inactive")&&$("#prev").removeClass("inactive");westerb_sal.pagination.next_set()||$(this).children("#next").addClass("inactive");$("#ux_nav_guide").text(westerb_sal.pagination.ux_nav_guide());"list_photos"=== westerb_sal.cur_pg?($("table thead").show(),$("table tbody").fadeOut(150,function(){"list_photos"===westerb_sal.cur_pg?$("table tbody").fadeIn(500):($("div.movable").css("top",c+"px"),$("div.movable").animate({top:0},300,"linear"))})):$("div.movable").animate({top:-c},220,"linear",function(){"list_photos"===westerb_sal.cur_pg?$("table tbody").fadeIn(500):($("div.movable").css("top",c+"px"),$("div.movable").animate({top:0},300,"linear"))})}catch(d){westerb_sal.pagination.current_set--,alert("Failed to connect to server:\n"+ d.toString())}else westerb_sal.please_wait_msg(a);return!1}});Object.defineProperty(Object.prototype.westerb_sal,"perms",{writable:!0,enumerable:!0,configurable:!0,value:$("#main").attr("u_p")});Object.defineProperty(Object.prototype.westerb_sal,"cur_u_id",{writable:!0,enumerable:!0,configurable:!0,value:$("#main").attr("cur_u_id")});Object.defineProperty(Object.prototype.westerb_sal,"s_pag_instances",{writable:!0,enumerable:!0,configurable:!0,value:Object.create(null)});Object.defineProperty(Object.prototype.westerb_sal, "request_done",{writable:!0,enumerable:!0,configurable:!0,value:!0});Object.defineProperty(Object.prototype.westerb_sal,"animating",{writable:!0,enumerable:!0,configurable:!0,value:!1});Object.defineProperty(Object.prototype.westerb_sal,"msg_remove_timer",{writable:!0,enumerable:!0,configurable:!0,value:null});Object.defineProperty(Object.prototype.westerb_sal,"progress_events",{writable:!1,enumerable:!0,configurable:!0,value:"onprogress"in westerb_sal.create_xhr()?!0:!1});Object.defineProperty(Object.prototype.westerb_sal, "dev_mode",{writable:!1,enumerable:!0,configurable:!0,value:!0});Object.defineProperty(Object.prototype.westerb_sal,"remove_hash_removed_elems",{writable:!1,enumerable:!0,configurable:!0,value:function(a){var b="list_albums"===westerb_sal.cur_pg||"add_user"===westerb_sal.cur_pg||"photo_upload"===westerb_sal.cur_pg||"create_album"===westerb_sal.cur_pg||"login"===westerb_sal.cur_pg?100:"public_index"===westerb_sal.cur_pg?50:800,c=a.data.class_number,d=$(".hash_change_removed_"+c).toArray(),e=d.length, f=null;(function l(){f=$(d[e-1]);f.hasClass("faded")?f.fadeOut(f.hasClass("field_msg")?1:100,function(){$(this).remove();e--;0!==e?setTimeout(l,20):0===e&&(0!==$(".hash_change_removed_"+(c+1)).size()?$("body").trigger("class"+(c+1)+"_removal"):$("#main").trigger("elems_remaval_complete"))}):f.hasClass("slided")&&f.hide("nav"===f.attr("id")||"photos_wrapper"===f.attr("id")?200:b,function(){$(this).remove();e--;0!==e?setTimeout(l,20):0===e&&(0!==$(".hash_change_removed_"+(c+1)).size()?$("body").trigger("class"+ (c+1)+"_removal"):$("#main").trigger("elems_remaval_complete"))})})()}});Object.defineProperty(Object.prototype.westerb_sal,"clear_cur_page_for_next",{writable:!1,enumerable:!0,configurable:!0,value:function(){$("*",$("#main")).unbind();$("div.message_wrapper").slideUp(10,function(){$(this).remove()});$("#wait_msg").fadeOut(10,function(){$(this).remove()});$("body").trigger("class1_removal")}});Object.defineProperty(Object.prototype.westerb_sal,"handle_hash_change",{value:function(a){if(""!==window.location.hash&& "#"!==window.location.hash){var b=$("#temp_content_holder").html();$("#temp_content_holder").remove();westerb_sal.clear_cur_page_for_next();$("#main").bind("elems_remaval_complete",function(){$(this).unbind("elems_remaval_complete").replaceWith(b);try{switch(window.location.hash){case "#login":westerb_sal.cur_pg="login";westerb_sal.form=new westerb_sal.Form;$("#main").fadeTo(50,1,function(){$("a#home h1").css("width","360");$("a#home span#logo_suffix").text(": Login");$("#gologin").replaceWith("<a class='scriptable_hash_changer scriptable_header_link' id='gopublic' href='"+ westerb_sal.HOME+"'><div class='ui_button ui_button_white'>PUBLIC AREA</div></a>");$("#gopublic").addClass("stnd_alone");$("a#home").attr("href",westerb_sal.HOME+"admin");westerb_sal.request_done=!0});break;case "#public_index":case "#pst_lgout":westerb_sal.cur_pg="public_index";"logout"!==$(".clicked_hash_changer").attr("id")&&0!==$(".show_prevs").size()||$("#unit_wrapper .album").append("<div style='display: none; ' class='absolute_pos show_prevs hover_triggered'>See photo previews</div>");westerb_sal.readjust_general_public_elems(); westerb_sal.pagination=new westerb_sal.Pagination;westerb_sal.pagination.current_set=1;$(".hover_triggered").hide();$("#main").fadeTo(50,1,function(){$("a#home h1").css("width","265");$("a#home span#logo_suffix").html(" &TRADE;");"logout"===$(".clicked_hash_changer").attr("id")?($(".clicked_hash_changer").hide(100,function(){$("#gopublic").addClass("stnd_alone");$(this).remove()}),$("#gopublic, #gostaff").replaceWith("<a class='scriptable_hash_changer scriptable_header_link' id='gologin' href='"+ westerb_sal.HOME+"admin/login.php'><div class='ui_button ui_button_white'>USER LOGIN</div></a>"),window.clearInterval(westerb_sal.check_login_timer),westerb_sal.is_logged_in=!1):westerb_sal.is_logged_in?$("#gopublic").replaceWith("<a class='scriptable_hash_changer scriptable_header_link' id='gostaff' href='"+westerb_sal.HOME+"admin/'><div class='ui_button ui_button_white'>"+(2==westerb_sal.perms?"PRIVATE":"ADMIN")+" AREA</div></a>"):$("#gopublic").replaceWith("<a class='scriptable_hash_changer scriptable_header_link' id='gologin' href='"+ westerb_sal.HOME+"admin/login.php'><div class='ui_button ui_button_white'>USER LOGIN</div></a>");$("a#home").attr("href",westerb_sal.HOME);westerb_sal.request_done=!0});break;case "#admin_index":var a=westerb_sal.cur_pg;westerb_sal.cur_pg="admin_index";$("#main").fadeTo(50,1,function(){$("a#home h1").css("width","360");$("a#home span#logo_suffix").html(2==westerb_sal.perms?" &TRADE;":": Admin");"gostaff"===$(".clicked_hash_changer").attr("id")?$("#gostaff").replaceWith("<a class='scriptable_hash_changer scriptable_header_link' id='gopublic' href='"+ westerb_sal.HOME+"'><div class='ui_button ui_button_white'>PUBLIC AREA</div></a>"):"login"===a&&($("#gopublic").removeClass("stnd_alone"),$("#gopublic").after("<a style='display: none; ' class='scriptable_hash_changer scriptable_header_link' id='logout' href='"+westerb_sal.HOME+"admin/logout.php'><div class='ui_button ui_button_white'>LOGOUT</div></a>"),$("#logout").show(100));$("a#home").attr("href",westerb_sal.HOME+"admin/");westerb_sal.request_done=!0});break;case "#photo_upload":westerb_sal.cur_pg= "photo_upload";westerb_sal.form=new westerb_sal.Form;$("#main").fadeTo(50,1,function(){"photo_upload"===westerb_sal.get_url_param_value("to")&&($("a#home h1").css("width","360"),$("a#home span#logo_suffix").html(2==westerb_sal.perms?" &TRADE;":": Admin"),$("#gopublic").removeClass("stnd_alone"),$("#gopublic").after("<a style='display: none; ' class='scriptable_hash_changer scriptable_header_link' id='logout' href='"+westerb_sal.HOME+"admin/logout.php'><div class='ui_button ui_button_white'>LOGOUT</div></a>"), $("#logout").show(100));westerb_sal.request_done=!0});break;case "#create_album":westerb_sal.cur_pg="create_album";westerb_sal.form=new westerb_sal.Form;$("#main").fadeTo(50,1,function(){"create_album"===westerb_sal.get_url_param_value("to")&&($("a#home h1").css("width","360"),$("a#home span#logo_suffix").html(2==westerb_sal.perms?" &TRADE;":": Admin"),$("#gopublic").removeClass("stnd_alone"),$("#gopublic").after("<a style='display: none; ' class='scriptable_hash_changer scriptable_header_link' id='logout' href='"+ westerb_sal.HOME+"admin/logout.php'><div class='ui_button ui_button_white'>LOGOUT</div></a>"),$("#logout").show(100));westerb_sal.request_done=!0});break;case "#add_user":westerb_sal.cur_pg="add_user";westerb_sal.form=new westerb_sal.Form;$("#main").fadeTo(50,1,function(){"add_user"===westerb_sal.get_url_param_value("to")&&($("a#home h1").css("width","360"),$("a#home span#logo_suffix").html(2==westerb_sal.perms?" &TRADE;":": Admin"),$("#gopublic").removeClass("stnd_alone"),$("#gopublic").after("<a style='display: none; ' class='scriptable_hash_changer scriptable_header_link' id='logout' href='"+ westerb_sal.HOME+"admin/logout.php'><div class='ui_button ui_button_white'>LOGOUT</div></a>"),$("#logout").show(100));westerb_sal.request_done=!0});break;case "#list_users":westerb_sal.cur_pg="list_users";$("#main").fadeTo(50,1,function(){"list_users"===westerb_sal.get_url_param_value("to")&&($("a#home h1").css("width","360"),$("a#home span#logo_suffix").html(2==westerb_sal.perms?" &TRADE;":": Admin"),$("#gopublic").removeClass("stnd_alone"),$("#gopublic").after("<a style='display: none; ' class='scriptable_hash_changer scriptable_header_link' id='logout' href='"+ westerb_sal.HOME+"admin/logout.php'><div class='ui_button ui_button_white'>LOGOUT</div></a>"),$("#logout").show(100));westerb_sal.request_done=!0});break;case "#list_albums":westerb_sal.cur_pg="list_albums";2!=westerb_sal.perms&&westerb_sal.exec_code_for_admin_list_albums();2==westerb_sal.perms&&(westerb_sal.pagination=new westerb_sal.Pagination,westerb_sal.pagination.current_set=1);$("#main").fadeTo(50,1,function(){"list_albums"===westerb_sal.get_url_param_value("to")&&($("a#home h1").css("width", "360"),$("a#home span#logo_suffix").html(2==westerb_sal.perms?" &TRADE;":": Admin"),$("#gopublic").removeClass("stnd_alone"),$("#gopublic").after("<a style='display: none; ' class='scriptable_hash_changer scriptable_header_link' id='logout' href='"+westerb_sal.HOME+"admin/logout.php'><div class='ui_button ui_button_white'>LOGOUT</div></a>"),$("#logout").show(100));westerb_sal.request_done=!0});break;case "#list_photos":"list_photos"===westerb_sal.get_url_param_value("to")?(westerb_sal.cur_pg="list_albums", 2!=westerb_sal.perms&&westerb_sal.exec_code_for_admin_list_albums(),2==westerb_sal.perms&&(westerb_sal.pagination=new westerb_sal.Pagination,westerb_sal.pagination.current_set=1),$("#main").fadeTo(50,1,function(){setTimeout(function(){$("div.message_wrapper").slideUp(300,function(){$(this).remove()})},3E3);westerb_sal.request_done=!0})):(westerb_sal.cur_pg="list_photos",$("form.mini_form").find("span.char_counter").each(function(){var a=$(this).parents("form.mini_form").find(".mini_form_edit_field"); $(this).text(parseInt(a.attr("maxlength"),10)-a.val().length)}),$("#photos_wrapper").css({"min-width":"1012px","min-height":"473px"}),$("#photos_wrapper").append("<div id='ajax_loading_pholder'><div id='pholder_msg'></div></div>"),westerb_sal.pagination=new westerb_sal.Pagination,westerb_sal.pagination.current_set=1,$("#main").fadeTo(50,1,function(){westerb_sal.request_done=!0}));break;case "#logfile":westerb_sal.cur_pg="logfile";$("h2:first").after("<div id='progress_wrapper' style='width: 0; overflow: hidden; display: none; height: 5px; '></div>"); var d="<div class='pregress_info' id='upload_progress_bar' style='position: absolute; top: -8px; left: 0; width: 400px; border-radiu: 30px; overflow: hidden; z-index: 3000; '>",d=d+"<div style='display: inline-block; border-top-left-radius: 35px; border-bottom-left-radius: 35px; width: 100px; height: 5px; background-color: #1C6487; '></div>",d=d+"<div style='display: inline-block; width: 100px; height: 5px; background-color: #A20910; '></div>",d=d+"<div style='display: inline-block; width: 100px; height: 5px; background-color: #C36500; '></div>", d=d+"<div style='display: inline-block; width: 100px; border-top-right-radius: 35px; border-bottom-right-radius: 35px; height: 5px; background-color: #93A50B; '></div>",d=d+"</div>";$("div#progress_wrapper").append(d).after("<span class='pregress_info' id='upload_progress_percent' style='color: #222; font-weight: bold; font-size: 12px; position: absolute; top: 56px; left: 4px; z-index: 3000; display: none; '></span>");$("#main").fadeTo(50,1,function(){"logfile"===westerb_sal.get_url_param_value("to")&& ($("a#home h1").css("width","360"),$("a#home span#logo_suffix").html(2==westerb_sal.perms?" &TRADE;":": Admin"),$("#gopublic").removeClass("stnd_alone"),$("#gopublic").after("<a style='display: none; ' class='scriptable_hash_changer scriptable_header_link' id='logout' href='"+westerb_sal.HOME+"admin/logout.php'><div class='ui_button ui_button_white'>LOGOUT</div></a>"),$("#logout").show(100));westerb_sal.request_done=!0});break}}catch(e){}finally{westerb_sal.perms=$("#main").attr("u_p"),westerb_sal.cur_u_id= $("#main").attr("cur_u_id"),westerb_sal.msg_remove_timer=westerb_sal.get_units_animation_timer=null,"#pst_lgout"===window.location.hash&&(sessionStorage.clear(),westerb_sal.store_page("public_index",Object.create(null)),westerb_sal.store_page("list_albums",Object.create(null)),westerb_sal.store_page("list_photos",Object.create(null)))}})}return!1},writable:!1,enumerable:!0,configurable:!0});Object.defineProperty(Object.prototype.westerb_sal,"change_hash",{value:function(a){var b=$(".clicked_hash_changer"), c=$("#temp_content_holder").html();"home"===b.attr("id")?window.location.hash="public_index"===westerb_sal.cur_pg?"public_index":"admin_index":"gologin"===b.attr("id")?(a&&westerb_sal.store_main_page_state("#login",c),window.location.hash="login"):"login"===b.attr("id")?(a&&westerb_sal.store_main_page_state("#"+(westerb_sal.get_url_param_value("to")||"admin_index"),c),window.location.hash=westerb_sal.get_url_param_value("to")||"admin_index"):"gopublic"===b.attr("id")?(a&&westerb_sal.store_main_page_state("#public_index", c),window.location.hash="public_index"):"gostaff"===b.attr("id")?(a&&westerb_sal.store_main_page_state("#admin_index",c),window.location.hash="admin_index"):"to_admin_home"===b.attr("id")?(a&&westerb_sal.store_main_page_state("#admin_index",c),window.location.hash="admin_index"):"to_albums"===b.attr("id")?(a&&westerb_sal.store_main_page_state("#list_albums",c),window.location.hash="list_albums"):"logout"===b.attr("id")?window.location.hash="pst_lgout":"Upload a new photo"===b.text()?(a&&westerb_sal.store_main_page_state("#photo_upload", c),window.location.hash="photo_upload"):"Create a new album"===b.text()?(a&&westerb_sal.store_main_page_state("#create_album",c),window.location.hash="create_album"):"Add a new user"===b.text()?(a&&westerb_sal.store_main_page_state("#add_user",c),window.location.hash="add_user"):"List users"===b.text()?(a&&westerb_sal.store_main_page_state("#list_users",c),window.location.hash="list_users"):/to_list_photos_/.test(b.attr("id"))?(a&&westerb_sal.store_main_page_state("#list_photos_"+b.parent("div.album").attr("a_id"), c),window.location.hash="list_photos"):"List albums"===b.text()?(a&&westerb_sal.store_main_page_state("#list_albums",c),window.location.hash="list_albums"):"View log file"===b.text()&&(a&&westerb_sal.store_main_page_state("#logfile",c),window.location.hash="logfile");return!1},writable:!1,enumerable:!0,configurable:!0});Object.defineProperty(Object.prototype.westerb_sal,"handle_get_changer_content_response",{value:function(a,b,c){westerb_sal.clear_p_timers();$("#main_processing_msg").css("z-index", "-1").html("");switch(b){case "error":westerb_sal.display_dialog_msg();break;case "timeout":westerb_sal.display_dialog_msg("The request is taking too long. Please refresh the page and try again","notice");break;case "success":westerb_sal.change_hash(!0)}},writable:!1,enumerable:!0,configurable:!0});Object.defineProperty(Object.prototype.westerb_sal,"get_hash_changer_requested_content",{value:function(a){if(westerb_sal.request_done)if(westerb_sal.blocking_dialog)westerb_sal.scroll_to_dialog();else if("The Salon \u2122"=== $.trim($(this).text())||"gologin"===$(this).attr("id")||"gopublic"===$(this).attr("id")||"logout"===$(this).attr("id")||"login"===westerb_sal.cur_pg||"login"===$(this).attr("id")||westerb_sal.is_logged_in){$(".clicked_hash_changer").removeClass("clicked_hash_changer");$(this).addClass("clicked_hash_changer");a=requested_pg_name="";if("home"===$(this).attr("id"))2==westerb_sal.perms?(a=1===$("#gopublic").size()?westerb_sal.HOME+"admin/":westerb_sal.HOME,requested_pg_name=1===$("#gopublic").size()? "admin_index":"public_index"):(a="The Salon: Login"===$.trim($(this).text())?westerb_sal.HOME+"admin/login.php":"The Salon: Admin"===$.trim($(this).text())?westerb_sal.HOME+"admin/":westerb_sal.HOME,requested_pg_name="The Salon: Login"===$.trim($(this).text())?"login":"The Salon: Admin"===$.trim($(this).text())?"admin_index":"public_index");else if("gologin"===$(this).attr("id"))a=westerb_sal.HOME+"admin/login.php",requested_pg_name="login";else if("login"===$(this).attr("id")){var b=westerb_sal.get_url_param_value("to")|| "admin_index";a=westerb_sal.HOME+"admin/"+("admin_index"===b?"index":b)+".php";requested_pg_name=b}else"gopublic"===$(this).attr("id")?(a=westerb_sal.HOME,requested_pg_name="public_index"):"gostaff"===$(this).attr("id")?(a=westerb_sal.HOME+"admin/",requested_pg_name="admin_index"):"to_admin_home"===$(this).attr("id")?(a=westerb_sal.HOME+"admin/",requested_pg_name="admin_index"):"to_albums"===$(this).attr("id")?(a=westerb_sal.HOME+"admin/list_albums.php",requested_pg_name="list_albums"):"logout"=== $(this).attr("id")?(a=westerb_sal.HOME+"admin/logout.php",requested_pg_name="logout"):"Upload a new photo"===$(this).text()?(a=westerb_sal.HOME+"admin/photo_upload.php",requested_pg_name="photo_upload"):"Create a new album"===$(this).text()?(a=westerb_sal.HOME+"admin/create_album.php",requested_pg_name="create_album"):"Add a new user"===$(this).text()?(a=westerb_sal.HOME+"admin/add_user.php",requested_pg_name="add_user"):"List users"===$(this).text()?(a=westerb_sal.HOME+"admin/list_users.php",requested_pg_name= "list_users"):"List albums"===$(this).text()?(a=westerb_sal.HOME+"admin/list_albums.php",requested_pg_name="list_albums"):/to_list_photos_/.test($(this).attr("id"))?(a=westerb_sal.HOME+"admin/list_photos.php?a_id="+$(this).parent("div.album").attr("a_id"),requested_pg_name="list_photos"):"View log file"===$(this).text()&&(a=westerb_sal.HOME+"admin/logfile.php",requested_pg_name="logfile");b=westerb_sal.retrieve_main_page_state("list_photos"===requested_pg_name?"#"+requested_pg_name+"_"+$(this).parent("div.album").attr("a_id"): "#"+requested_pg_name);window.location.hash!=="#"+requested_pg_name&&("home"!==$(this).attr("id")||"public_index"!==westerb_sal.cur_pg||westerb_sal.get_url_param_value("o_id")||westerb_sal.get_url_param_value("c_set")||westerb_sal.get_url_param_value("a_id")||westerb_sal.get_url_param_value("p_id"))&&($("#main").append("<div style='display: none; ' id='temp_content_holder'></div>"),westerb_sal.request_done=!1,b?($("#temp_content_holder").html(b),westerb_sal.change_hash()):(westerb_sal.reposition_main_p_msg(), $("#main_processing_msg").css("z-index","5000").get(0).processing_msg(),$("#temp_content_holder").load(a+" #main","hash_change_pg_call",westerb_sal.handle_get_changer_content_response)))}else westerb_sal.prompt_login();else westerb_sal.please_wait_msg(a);return!1},writable:!1,enumerable:!0,configurable:!0});Object.defineProperties(Object.prototype.westerb_sal,{xhr_switch_owner:{value:westerb_sal.create_xhr(),writable:!0,enumerable:!0,configurable:!0},handle_switch_owner_response:{value:function(){4=== westerb_sal.xhr_switch_owner.readyState&&(westerb_sal.clear_p_timers(),200===westerb_sal.xhr_switch_owner.status?(westerb_sal.store_set(westerb_sal.cur_pg+"_"+westerb_sal.pagination.set_group+"_s"+westerb_sal.pagination.current_set,westerb_sal.xhr_switch_owner.responseText),$("div.movable").hide().html(westerb_sal.xhr_switch_owner.responseText).fadeIn(600),westerb_sal.readjust_general_public_elems()):$("div.movable").html("<div id='pholder_f_msg'>failure: "+westerb_sal.xhr_switch_owner.status+"</div>"))}, writable:!0,enumerable:!0,configurable:!0},switch_owner:{value:function(){if(!$(this).hasClass("current")){$(".public_albums_nav_link").each(function(){$(this).removeClass("current")});$(this).addClass("current");$("#s_group_id").attr("s_group","o_id="+$(this).attr("o_id"));$("#by").text("all"===$(this).attr("o_id")?"All albums":"Albums by"+$(this).text().replace("By",""));$("#u_count").text($(this).attr("u_count"));westerb_sal.pagination.current_set=1;westerb_sal.pagination.set_group="o_id="+$(this).attr("o_id"); westerb_sal.pagination.albums_owner=$(this).attr("o_id");$("#ux_nav_guide").text(westerb_sal.pagination.ux_nav_guide());westerb_sal.pagination.adjust_prev_and_next();$("div.movable").children().fadeOut(200);var a=westerb_sal.retrieve_set(westerb_sal.cur_pg+"_"+westerb_sal.pagination.set_group+"_s"+westerb_sal.pagination.current_set);a?($("div.movable").hide().html(a).fadeIn(600),westerb_sal.readjust_general_public_elems()):($("div.movable").html("<div id='pholder_p_msg'></div>"),$("#pholder_p_msg").get(0).processing_msg("Loading"), westerb_sal.xhr_switch_owner.open("get",westerb_sal.HOME+"ajax/"+westerb_sal.cur_pg+"_u_retrieve.php?u_per_set="+westerb_sal.pagination.units_per_set+"&offset="+westerb_sal.pagination.offset()+"&o_id="+westerb_sal.pagination.albums_owner+"&a_id="+westerb_sal.pagination.album_selected,!0),westerb_sal.xhr_switch_owner.send(null))}return!1},writable:!0,enumerable:!0,configurable:!0},clear_small_screen_for_full:{value:function(){$("#header").slideUp(500,function(){});$("#footer").slideUp(500,function(){}); $("#outer_wrapper").fadeOut(80,function(){$(this).remove()});var a=0;(function c(){$("body").css("background-color","rgba(170, 170, 170, "+a+")");a+=0.1;1>=a&&setTimeout(c,80)})()},writable:!0,enumerable:!0,configurable:!0},clear_full_screen_for_small:{value:function(a){$("#outer_wrapper, #big_error_report").fadeOut(80,function(){$(this).parent("div.centering").html("").removeClass("mini_full_screen")});var b=1;(function d(){$("body").css("background-color","rgba(170, 170, 170, "+b+")");b-=0.1;0.1< b&&setTimeout(d,80);0.1>b&&$("body").css("background-color","transparent")})();$("#header").slideDown(400,function(){});$("#footer").slideDown(400,function(){})},writable:!0,enumerable:!0,configurable:!0},restore_prev_state:{value:function(a){var b=(a="BACK TO ALBUMS"==$(this).text()?!0:!1)?westerb_sal.prev_albums_o_w_st_name:westerb_sal.prev_album_o_w_st_name,c=a?westerb_sal.prev_albums_o_w_st_set_no:westerb_sal.prev_album_o_w_st_set_no;a?westerb_sal.clear_full_screen_for_small():$("#outer_wrapper, #big_error_report").fadeOut(80, function(){$(this).parent("div.centering").html("")});setTimeout(function(){$("div.centering:last").hide().append(westerb_sal.retrieve_outer_wrapper_state(b)).fadeIn(200,function(){});westerb_sal.pagination=new westerb_sal.Pagination;westerb_sal.pagination.current_set=c},150);return!1},writable:!0,enumerable:!0,configurable:!0},apply_mini_full_screen_styles:{value:function(){$(".centering, .photo img, .u_wrapper.non_photo, #title h2, #title #ux_nav_guide, .scriptable_gen_nav_link, #unit_info, #album_info, .no_content, #big_error_report, #big_error_report #msg, #big_error_report #exit, #outer_wrapper + #for_margin").addClass("mini_full_screen"); $("#outer_wrapper").hasClass("selected_photo_wrapper")?westerb_sal.readjust_gallery_elems():westerb_sal.readjust_general_public_elems()},writable:!0,enumerable:!0,configurable:!0},display_album:{value:function(a){stall_time=a?200:120;setTimeout(function(){var b=a||westerb_sal.xhr_get_album_for_display.responseText;$("div.centering:last").append(b);westerb_sal.apply_mini_full_screen_styles();$("#outer_wrapper").fadeIn(200,function(){});var c=$(".unit.photo").toArray(),d=c.length,e=0,f=300;0!==d&&function l(){$(c[e]).show(f, function(){e++;f-=50;e<d&&l()})}();westerb_sal.pagination=new westerb_sal.Pagination;westerb_sal.pagination.current_set=1},stall_time)},writable:!0,enumerable:!0,configurable:!0},display_photo:{value:function(a){stall_time=a?200:120;setTimeout(function(){var b=a||$("#temp_content_holder").html();$("#temp_content_holder").remove();$("div.centering:last").append(b);westerb_sal.selected_from_album?$("#to_albums_nav").removeClass("fullscreen_closer").text("BACK TO ALBUM"):$("#to_albums_nav").addClass("fullscreen_closer").text("BACK TO ALBUMS"); westerb_sal.apply_mini_full_screen_styles();$(".field_msg.char_counter").remove();westerb_sal.form=new westerb_sal.Form;$("#outer_wrapper").fadeIn(200,function(){});8<parseInt($("#c_count").children("span").text())&&$("#loaded_info").scroll(westerb_sal.load_more_public_comments);westerb_sal.pagination=new westerb_sal.Pagination;westerb_sal.pagination.current_set=parseInt($("#on_display_gallery_img").attr("c_set"))},stall_time)},writable:!0,enumerable:!0,configurable:!0},xhr_get_album_for_display:{value:westerb_sal.create_xhr(), writable:!0,enumerable:!0,configurable:!0},handle_get_album_for_display_error:{value:function(){var a=westerb_sal.dev_mode?westerb_sal.xhr_get_album_for_display.status:"Oops! Something went wrong while loading the album";$("div.centering:last").append("<div style='display: none; ' id='big_error_report'><div id='msg'>"+a+"</div><div id='exit' class='ui_button'><a style='text-decoration: none; display: block; color: #fff; height: 100%; width: 97%; padding: 5% 1.5%; ' href='.' class='fullscreen_closer scriptable_prev_state_restorer'>BACK TO ALBUMS</a></div></div>"); westerb_sal.apply_mini_full_screen_styles();$("#big_error_report").fadeIn(250)},writable:!0,enumerable:!0,configurable:!0},clicked_album_id:{value:"",writable:!0,enumerable:!0,configurable:!0},clicked_photo_suffix_info:{value:"",writable:!0,enumerable:!0,configurable:!0},prev_albums_o_w_st_name:{value:"",writable:!0,enumerable:!0,configurable:!0},prev_albums_o_w_st_set_no:{value:"",writable:!0,enumerable:!0,configurable:!0},prev_album_o_w_st_name:{value:"",writable:!0,enumerable:!0,configurable:!0}, prev_album_o_w_st_set_no:{value:"",writable:!0,enumerable:!0,configurable:!0},selected_from_album:{value:!1,writable:!0,enumerable:!0,configurable:!0},handle_get_album_for_display_response:{value:function(){4===westerb_sal.xhr_get_album_for_display.readyState&&(westerb_sal.clear_p_timers(),$("#main_processing_msg").html("").css("z-index","-1"),200===westerb_sal.xhr_get_album_for_display.status?/Error|Warning|Notice/i.test(westerb_sal.xhr_get_album_for_display.responseText)?westerb_sal.handle_get_album_for_display_error(): (westerb_sal.display_album(),westerb_sal.store_outer_wrapper_state("album_wrapper_a_id_"+westerb_sal.clicked_album_id+"_set1",westerb_sal.xhr_get_album_for_display.responseText)):westerb_sal.handle_get_album_for_display_error())},writable:!0,enumerable:!0,configurable:!0},handle_get_photo_for_display_response:{value:function(a,b,c){westerb_sal.clear_p_timers();$("#main_processing_msg").css("z-index","-1").html("");switch(b){case "error":westerb_sal.display_dialog_msg();break;case "timeout":westerb_sal.display_dialog_msg("The request is taking too long. Please refresh the page and try again", "notice");break;case "success":westerb_sal.display_photo(),westerb_sal.store_outer_wrapper_state("photo_wrapper_pa_id_"+westerb_sal.clicked_photo_suffix_info,a)}},writable:!0,enumerable:!0,configurable:!0},get_album_for_display:{value:function(a){a=westerb_sal.retrieve_outer_wrapper_state("album_wrapper_a_id_"+$(this).parent("div.album").attr("a_id")+"_set1");var b="albums_wrapper_"+$(".public_albums_nav_link.current").text()+"_set"+westerb_sal.pagination.current_set;westerb_sal.prev_albums_o_w_st_name= b;westerb_sal.prev_albums_o_w_st_set_no=westerb_sal.pagination.current_set;a?(westerb_sal.store_outer_wrapper_state(b),westerb_sal.clear_small_screen_for_full(),westerb_sal.display_album(a)):(westerb_sal.clicked_album_id=$(this).parent("div.album").attr("a_id"),westerb_sal.store_outer_wrapper_state(b),westerb_sal.reposition_main_p_msg(),$("#main_processing_msg").css("z-index","5000").get(0).processing_msg(),westerb_sal.clear_small_screen_for_full(),westerb_sal.xhr_get_album_for_display.open("get", westerb_sal.HOME+"index.php?a_id="+$(this).parent("div.album").attr("a_id")+"&ajax",!0),westerb_sal.xhr_get_album_for_display.send(null));return!1},writable:!0,enumerable:!0,configurable:!0},get_photo_for_display:{value:function(a){a=westerb_sal.retrieve_outer_wrapper_state("photo_wrapper_pa_id_"+$(this).parents("[a_id]").attr("a_id")+"_s_"+$(this).attr("s_no"));var b=$("#outer_wrapper").hasClass("selected_album_wrapper")?"album_wrapper_a_id_"+$(this).parents("[a_id]").attr("a_id")+"_set"+westerb_sal.pagination.current_set: "albums_wrapper_"+$(".public_albums_nav_link.current").text()+"_set"+westerb_sal.pagination.current_set;$("#outer_wrapper").hasClass("selected_album_wrapper")?(westerb_sal.prev_album_o_w_st_name=b,westerb_sal.prev_album_o_w_st_set_no=westerb_sal.pagination.current_set,westerb_sal.selected_from_album=!0):(westerb_sal.prev_albums_o_w_st_name=b,westerb_sal.prev_albums_o_w_st_set_no=westerb_sal.pagination.current_set,westerb_sal.selected_from_album=!1);a?(westerb_sal.store_outer_wrapper_state(b),westerb_sal.clear_small_screen_for_full(), westerb_sal.display_photo(a)):(westerb_sal.clicked_photo_suffix_info=$(this).parents("[a_id]").attr("a_id")+"_s_"+$(this).attr("s_no"),westerb_sal.store_outer_wrapper_state(b),westerb_sal.reposition_main_p_msg(),$("#main_processing_msg").css("z-index","5000").get(0).processing_msg(),westerb_sal.clear_small_screen_for_full(),$("#main").append("<div style='display: none; ' id='temp_content_holder'></div>"),$("#temp_content_holder").load($(this).attr("href")+"&ajax",westerb_sal.handle_get_photo_for_display_response)); return!1},writable:!0,enumerable:!0,configurable:!0},scroll_thumbs_wrapper_timer:{value:null,writable:!0,enumerable:!0,configurable:!0},scroll_thumbs_wrapper:{value:function(){var a=$("#gallery_thumbs_wrapper");a.scrollLeft(a.scrollLeft()+1);a.scrollLeft()<a.prop("scrollWidth")-Math.ceil(a.innerWidth())?westerb_sal.scroll_thumbs_wrapper_timer=window.setTimeout(westerb_sal.scroll_thumbs_wrapper,20):westerb_sal.scroll_thumbs_wrapper_timer=window.setTimeout(function(){a.scrollLeft(0);westerb_sal.scroll_thumbs_wrapper()}, 600)},writable:!0,enumerable:!0,configurable:!0},stop_thumbs_wrapper_scroll:{value:function(){window.clearTimeout(westerb_sal.scroll_thumbs_wrapper_timer)},writable:!0,enumerable:!0,configurable:!0},load_more_public_comments:{value:function(a){if($(this).scrollTop()===$(this).prop("scrollHeight")-Math.ceil($(this).innerHeight())&&westerb_sal.request_done)if(westerb_sal.blocking_dialog)westerb_sal.scroll_to_dialog(),westerb_sal.highlight_dialog(a);else{a=new westerb_sal.Scroll_Pagination;var b=parseInt($(this).attr("cur_set"), 10);westerb_sal.request_done=!1;a.current_set=b;a.next_set()?($(this).append("<div id='temp_a_processing_msg' style='position: absolute; top: "+($(this).prop("scrollHeight")-40)+"px; left: "+($(this).innerWidth()-178)/2+"px; font-weight: bold; font-size: 19px'></div>"),$("#temp_a_processing_msg").get(0).processing_msg("Loading more"),a.current_set++,$("#main").append("<div style='display: none; ' id='temsp_content_holder'></div>"),$("#temp_content_holder").load(westerb_sal.HOME+"ajax/misc_calls.php?pc_id="+ $("#unit_wrapper img").attr("p_id")+"&u_per_set="+a.units_per_set+"&offset="+a.offset()+"&public_comments",function(a,b,e){switch(b){case "error":westerb_sal.display_dialog_msg("Something went wrong while loading more comments. You can try again later","error");break;case "timeout":westerb_sal.display_dialog_msg("Loading more comments is taking too long. Please try again","notice");break;case "success":westerb_sal.clear_p_timers();$(this).children("#comments").append($("#temp_content_holder").html()); $("#temp_content_holder, #temp_a_processing_msg").remove();$("#loaded_info").attr("cur_set",parseInt($(this).attr("cur_set"),10)+1);westerb_sal.store_set(westerb_sal.cur_pg+"_"+westerb_sal.pagination.set_group+"_s"+westerb_sal.pagination.current_set,$("#unit_wrapper").html()+"<div id='loaded_info' cur_set='"+$("#loaded_info").attr("cur_set")+"'>"+$("#loaded_info").html()+"</div>");if($("#unit_wrapper").attr("pa_id")+"_s_"+$(this).attr("s_no")===westerb_sal.clicked_photo_suffix_info){$("input[name=author], textarea").blur(); if($(".field_msg#comment").hasClass("notice_msg")||$(".field_msg#comment").hasClass("error_msg"))$("textarea").removeClass("notice_bordered error_bordered"),$(".field_msg#comment").removeClass("notice_msg error_msg").addClass("char_counter").text($("textarea").attr("maxlength"));westerb_sal.store_outer_wrapper_state("photo_wrapper_pa_id_"+westerb_sal.clicked_photo_suffix_info,$(".centering:last").html())}westerb_sal.request_done=!0;$("#wait_msg").fadeOut(10,function(){$(this).remove()})}})):westerb_sal.request_done= !0}},writable:!0,enumerable:!0,configurable:!0}});westerb_sal.xhr_switch_owner.onreadystatechange=westerb_sal.handle_switch_owner_response;westerb_sal.xhr_get_album_for_display.onreadystatechange=westerb_sal.handle_get_album_for_display_response;Object.defineProperties(Object.prototype.westerb_sal,{clicked_input_parent:{value:null,writable:!0,enumerable:!0,configurable:!0},highlight_dialog:{value:function(a){if(!westerb_sal.animating){westerb_sal.animating=!0;var b="",c="35, 197, 197, ;;162, 25, 31, ;;195, 101, 0, ;;147, 165, 11, ".split(";"), b="blinker",d=0;(function f(){$("#"+b).css({"border-color":"transparent","background-color":"transparent"});for(var a=0;0.8>=a;a+=0.1)$("#"+b).css({"border-color":"rgba("+c[d]+a+")","background-color":"rgba("+c[d]+a+")"});d++;7>d&&window.setTimeout(f,150)})();window.setTimeout(function(){$("#"+b).css({"border-color":"transparent","background-color":"transparent"});for(var a=0;0.8>=a;a+=0.1)$("#"+b).css({"border-color":"rgba("+a+")","background-color":"rgba("+a+")"})},1050);window.setTimeout(function(){$("#"+ b).css({"border-color":"transparent","background-color":"transparent"});for(var a=0;0.8>=a;a+=0.1)$("#"+b).css({"border-color":"rgba(29, 29, 29, "+a+")","background-color":"rgba(96, 96, 96, "+a+")"});westerb_sal.animating=!1},1200)}},writable:!0,enumerable:!0,configurable:!0},confirm_del:{value:function(a){if(westerb_sal.blocking_dialog)westerb_sal.scroll_to_dialog();else if(westerb_sal.request_done)if($(this).children("div").hasClass("delete")&&0==parseInt($(this).siblings("div.date_owner").children("div:last").text()))westerb_sal.del_album_as_admin($(this).parent("div.album")); else{if($(this).parent("span").hasClass("del_coms_parent")||$(this).parent("span").hasClass("del_albums_parent")||$(this).parent("div").hasClass("album"))$(".active").removeClass("active"),$(this).parent("div").hasClass("album")?$(this).parent("div").addClass("active"):$(this).parent("span").addClass("active");westerb_sal.blocking_dialog=!0;westerb_sal.confirm_del_dialog(a,$(this))}else westerb_sal.please_wait_msg(a);return!1},writable:!0,enumerable:!0,configurable:!0},xhr_del_all:{value:westerb_sal.create_xhr(), writable:!0,enumerable:!0,configurable:!0},confirm_del_dialog:{value:function(a,b){$("body").append("<div class='blocking_dialog' id='blinker' style='position: absolute; max-width: 320px; border: 3px dotted rgba(29, 29, 29, .8); background-color: rgba(96, 96, 96, .8); padding: 2px; border-radius: 5px; z-index: 2000; '><div class='blocking_dialog' id='del_confirm_dialog' style='background-color: rgba(245, 245, 245, .9); padding: 4px 8px; box-sizing: border-box; '></div></div>");var c=callback=what= d_trigger_parent=a_by="",c=0;switch(b.text()){case "Delete all photos":c="Are you sure you want to delete all photos on this album?";callback=westerb_sal.del_all_photos;what="photos";d_trigger_parent=$("span.del_all_photos");break;case "Delete album":c="Are you sure you want to delete this album from The S<span class='a'>a</span><span class='l'>l</span><span class='o'>o</span><span class='n'>n</span>?";callback=westerb_sal.del_album;what="album";d_trigger_parent=$("span.del_album");break;case "Delete all comments":c= "Are you sure you want to delete all comments on this photo?";callback=westerb_sal.del_all_comments;what="comments";d_trigger_parent=$("span.del_coms_parent.active");break;case "Delete all albums":a_by=b.parent("span.del_albums_parent").parent("p").parent("div.inner_a_wrapper").parent("div.albums").siblings("div.o_name").attr("by");c=parseInt(b.parent("span.del_albums_parent").siblings("span").text());c="All albums"==a_by?"Are you sure you want to delete all "+c+" albums on The S<span class='a'>a</span><span class='l'>l</span><span class='o'>o</span><span class='n'>n</span>?": "Are you sure you want to delete all "+c+" albums by "+a_by.replace("By ","");callback=del_all_albums;what="albums";d_trigger_parent=$("span.del_albums_parent.active");break;default:c=parseInt(b.siblings("div.date_owner").children("div:last").text()),c="Are you sure you want to delete this album and the "+c+" photo"+(1==c?"":"s")+" in it?",callback=westerb_sal.del_album_as_admin,what="album_on_list_albums",d_trigger_parent=$("div.album.active")}var c="<div class='blocking_dialog' style='color: #333; font-weight: bold; font-size: 15px; line-height: 18px; '>"+ c+"</div><div class='blocking_dialog' style='text-align: center; margin: 15px 0 4px; '>",c=c+"<div id='confirm_dialog_ok'style='display: inline-block' class='ui_button blocking_dialog dialog_choice'>DELETE</div>",c=c+"<div id='confirm_dialog_cancel' style='display: inline-block; margin-left: 20px' class='ui_button blocking_dialog dialog_choice'>CANCEL</div>",c=c+"</div>",d=$("#del_confirm_dialog");d.parent("div").css("visibility","hidden");d.html(c);d.parent("div").css({top:a.pageY-parseInt(d.css("height"))/ 2,left:a.pageX+30}).hide().css("visibility","visible").fadeIn(200);$(".dialog_choice").click(function(){d.parent("div").fadeOut(200,function(){$(this).remove()});westerb_sal.blocking_dialog=westerb_sal.animating=!1;$("a").unbind("click",westerb_sal.highlight_dialog);$("div").not("div.blocking_dialog").unbind("click",westerb_sal.scroll_to_dialog);$("div").not("div.blocking_dialog").unbind("click",westerb_sal.highlight_dialog)});$("#confirm_dialog_ok").bind("click",function(){d_trigger_parent.css("width", "120px");d_trigger_parent.get(0).processing_msg("Deleting");westerb_sal.xhr_del_all.onreadystatechange=function(){if(4===westerb_sal.xhr_del_all.readyState)if(200===westerb_sal.xhr_del_all.status)switch(what){case "photos":case "album":westerb_sal.visualize_all_photos_or_album_deletion(d_trigger_parent,what);break;case "comments":westerb_sal.visualize_all_comments_deletion(d_trigger_parent)}else switch(what){case "photos":case "album":case "comments":westerb_sal.clear_p_timers(),"photos"===what?d_trigger_parent.html("<a id='del_all' href='confirm_deletion.php?a_id="+ d_trigger_parent.attr("a_id")+"' class='scriptable_gen_link confirm_del'>Delete all photos</a>"):"album"===what?d_trigger_parent.html("<a id='del_album' href='confirm_deletion.php?da_id="+d_trigger_parent.attr("a_id")+"' class='scriptable_gen_link confirm_del'>Delete album</a>"):d_trigger_parent.css("width","160px").html("<a href='delete_comment.php?p_id="+d_trigger_parent.parent("p").parent("div").parent("td").parent("tr").prev("tr").attr("p_id")+"' class='scriptable_gen_link confirm_del'>Delete all comments</a>"), westerb_sal.display_tiny_msg("Failure: "+westerb_sal.xhr_del_all.status,"error",4E3)}};callback(d_trigger_parent,what)});$("a").bind("click",westerb_sal.highlight_dialog);$("div").not("div.blocking_dialog").bind("click",westerb_sal.scroll_to_dialog);$("div").not("div.blocking_dialog").bind("click",westerb_sal.highlight_dialog)},writable:!0,enumerable:!0,configurable:!0},modal_caller_parent:{value:null,writable:!0,enumerable:!0,configurable:!0},modal_dialog:{value:function(a,b,c){westerb_sal.request_done= !1;westerb_sal.modal_caller_parent=b.parent("div").hasClass("album")?b.parent("div.album"):b.parent("span.modal_caller_parent");b.parent("div").hasClass("album")?b.children("div.upload").css({"font-size":"12px",padding:"5px 0 5px 5px","text-align":"left"}).get(0).processing_msg("Loading"):westerb_sal.modal_caller_parent.get(0).processing_msg("Loading");var d=westerb_sal.create_xhr();d.onreadystatechange=function(){if(4===d.readyState)if(westerb_sal.clear_p_timers(),westerb_sal.modal_caller_parent.hasClass("album")? b.children("div.upload").css({"font-size":"14px",padding:"5px 2px","text-align":"center"}).text("Upload a photo"):westerb_sal.modal_caller_parent.hasClass("new_photo")?westerb_sal.modal_caller_parent.html("<a href='photo_upload.php?a_id="+westerb_sal.modal_caller_parent.attr("a_id")+"' class='scriptable_gen_link photo_upload'>Upload a new photo</a>"):westerb_sal.modal_caller_parent.html("<a href='create_album.php' class='new_album_modal scriptable_gen_link'>Create a new album</a>"),200===d.status){westerb_sal.blocking_dialog= !0;var a;a="<div class='blocking_dialog' id='blinker' style='position: absolute; width: 815px; border: 3px dotted rgba(29, 29, 29, .8); background-color: rgba(96, 96, 96, .8); padding: 2px; border-radius: 5px; z-index: 2000; '><div id='title_bar' class='blocking_dialog' ";a+="style='background-color: rgba(195, 195, 195, 0.9); padding: 5px 7px; font-weight: bold; '>";a+="<span style='font-size: 14px; color: #222; '>"+(westerb_sal.modal_caller_parent.hasClass("album")||westerb_sal.modal_caller_parent.hasClass("new_photo")? "Upload a new photo":"Create a new album")+"</span><div ";a+="class='blocking_dialog' id='close_dialog' style='position: absolute; top: 0; right: 0; font-size: ";a+="18px; padding: 5px; background-color: rgba(19, 17, 17, 0.3); color: #fff; ";a+="text-align: center; transition: .3s; cursor: pointer'>&#x2717;</div>";a+="<div id='modal_processing_msg' class='blocking_dialog' style='position: absolute; top: 305px; left: 120px; width: 140px; ";a+="z-index: 100; color: #222; '></div><div id='msg_wrapper' class='blocking_dialog' style='position: absolute; top: 2px; "; a+="left: 220px; width: 422px; z-index: 100; '></div></div><div ";a+="class='blocking_dialog' id='modal_dialog' style='background-color: rgba(245, 245, 245, .9); ";a+="padding: 15px 8px; box-sizing: border-box; '></div></div>";$("body").append(a);var c=$("#modal_dialog");c.parent("div").css("visibility","hidden");c.html(d.responseText);westerb_sal.form=new westerb_sal.Form;c.parent("div").css({top:(window.innerHeight-parseInt(c.css("height")))/2+westerb_sal.getScrollOffsets().y,left:(window.innerWidth- parseInt(c.css("width")))/2+westerb_sal.getScrollOffsets().x}).hide().css("visibility","visible").fadeIn(200,function(){$("#wait_msg").fadeOut(10,function(){$(this).remove()});westerb_sal.request_done=!0});$(document).scroll(westerb_sal.reposition_modal_box);$(window).resize(westerb_sal.reposition_modal_box);var g=function(){if(westerb_sal.modal_caller_parent.hasClass("album")||westerb_sal.modal_caller_parent.hasClass("new_photo"))for(h=0;1E4>h;h++)window.clearInterval(h);c.parent("div").fadeOut(200, function(){$(this).remove();westerb_sal.blocking_dialog=westerb_sal.animating=!1});$("a").unbind("click",westerb_sal.highlight_dialog);$("div").not("div.blocking_dialog").unbind("click",westerb_sal.scroll_to_dialog);$("div").not("div.blocking_dialog").unbind("click",westerb_sal.highlight_dialog);$(document).unbind("scroll",westerb_sal.reposition_modal_box);$(window).unbind("resize",westerb_sal.reposition_modal_box)};$("#close_dialog").click(function(a){!westerb_sal.request_done||westerb_sal.form.xhr_in_progress? westerb_sal.please_wait_msg(a,!0):g()});$("#close_dialog").hover(function(){$(this).css("background-color","rgba(19, 17, 17, 0.6)")},function(){$(this).css("background-color","rgba(19, 17, 17, 0.3)")});$("a").bind("click",westerb_sal.highlight_dialog);$("div").not("div.blocking_dialog").bind("click",westerb_sal.scroll_to_dialog);$("div").not("div.blocking_dialog").bind("click",westerb_sal.highlight_dialog)}else westerb_sal.display_msg("Failure: "+d.status,"error")};d.open("get",c,!0);d.send(null)}, writable:!0,enumerable:!0,configurable:!0},upload_photo_by_modal:{value:function(a){westerb_sal.blocking_dialog?westerb_sal.scroll_to_dialog():westerb_sal.request_done?westerb_sal.modal_dialog(a,$(this),westerb_sal.HOME+"ajax/misc_calls.php?new_photo_modal="+("list_albums"===westerb_sal.cur_pg?$(this).parent("div").attr("a_id"):$(this).parent("span").attr("a_id"))):westerb_sal.please_wait_msg(a);return!1},writable:!0,enumerable:!0,configurable:!0},exec_code_for_album_group:{value:function(){$(".hover_triggered").each(function(){$(this).parents("div.albums").siblings("div.o_name").hasClass("clicked_o_name")&& $(this).hide()});8<parseInt($(".clicked_o_name").siblings("div.albums").children("div.inner_a_wrapper").children("div.sect_head").children("span:first").text(),10)&&(westerb_sal.s_pag_instances["o_id_"+$(".clicked_o_name").parent("div").attr("id")]=new westerb_sal.Scroll_Pagination,$(".clicked_o_name").siblings("div.albums").bind("scroll",westerb_sal.load_more_albums),$(".clicked_o_name").bind("click",{s_pag_instance_id:"o_id_"+$(".clicked_o_name").parent("div").attr("id"),this_o_name_div:$(".clicked_o_name")}, westerb_sal.destroy_s_pag_instance))},writable:!0,enumerable:!0,configurable:!0},destroy_s_pag_instance:{value:function(a){"list_albums"===westerb_sal.cur_pg?westerb_sal.blocking_dialog||window.setTimeout(function(){westerb_sal.request_done&&(delete westerb_sal.s_pag_instances[a.data.s_pag_instance_id],a.data.this_o_name_div.siblings("div.albums").html(""),a.data.this_o_name_div.unbind("click",westerb_sal.destroy_s_pag_instance))},820):westerb_sal.request_done&&!westerb_sal.blocking_dialog&&(delete westerb_sal.s_pag_instances[a.data.s_pag_instance_id], a.data.this_o_name_div.unbind("click",westerb_sal.destroy_s_pag_instance))},writable:!0,enumerable:!0,configurable:!0},exec_code_for_admin_list_albums:{value:function(){var a=null,b=$("#albums_wrapper"),c="";westerb_sal.opened_album_groups=new westerb_sal.Opened_Album_Groups;$("#to_admin_home").text("<< Back home");b.before("<div name='for_block_effect'></div>");b.css({"min-width":"170px",display:"inline-block"});$("a.album_by_owner").each(function(){c="";c+="<div class='albums_by hash_change_removed_3 slided' id='"; c+=$(this).attr("href").split("=")[1];c+="'>";c+="<div class='processing_msg'></div>";c+="<div u_count='"+$(this).attr("u_count")+"' by='"+$(this).text()+"' class='o_name'>";c+=$(this).text()+"</div>";c+="<div class='albums'></div>";c+="</div>";$(this).remove();b.append(c)});var d=$("div.o_name");d.hover(function(){$(this).css("opacity","1")},function(){$(this).css("opacity",".8")});d.bind("click",function(c){westerb_sal.request_done&&$(this).toggleClass("clicked");westerb_sal.blocking_dialog?westerb_sal.scroll_to_dialog(): westerb_sal.request_done?$(this).hasClass("clicked")?(westerb_sal.request_done=!1,$(".clicked_o_name").removeClass("clicked_o_name"),$(this).addClass("clicked_o_name"),(pre_stored_albums=westerb_sal.retrieve_albums("list_albums_ao_id="+$(this).parent("div").attr("id")))?(westerb_sal.opened_album_groups.add_record($(this)),1==westerb_sal.opened_album_groups.opened_count?(b.animate({width:"1050px","min-width":""},200,"linear",function(){$(".clicked_o_name").siblings("div.albums").hide().html(pre_stored_albums); westerb_sal.exec_code_for_album_group();$(".clicked_o_name").siblings("div.albums").slideDown(800,function(){$("#wait_msg").fadeOut(10,function(){$(this).remove()});westerb_sal.request_done=!0})}),$("div.message_wrapper").slideUp(100)):($(this).siblings("div.albums").hide().html(pre_stored_albums),westerb_sal.exec_code_for_album_group(),$(this).siblings("div.albums").slideDown(800,function(){$("#wait_msg").fadeOut(10,function(){$(this).remove()});westerb_sal.request_done=!0}))):($(this).text(""), $(this).siblings(".processing_msg").css({"margin-top":"7px",left:0!=westerb_sal.opened_album_groups.opened_count?"45%":"22%","z-index":"1000"}).get(0).processing_msg("Loading"),a.open("get",westerb_sal.HOME+"ajax/misc_calls.php?ao_id="+$(this).parent("div").attr("id")+"&u_per_set="+parseInt($("div.u_wrapper").attr("scroll_per_set"),10)+"&offset=0",!0),a.send(null))):westerb_sal.blocking_dialog?westerb_sal.scroll_to_dialog():westerb_sal.request_done?(westerb_sal.request_done=!1,westerb_sal.opened_album_groups.remove_record($(this)), 0==westerb_sal.opened_album_groups.opened_count&&b.animate({width:"","min-width":"180px"},200,"linear"),$(this).siblings("div.albums").slideUp(800,function(){$("#wait_msg").fadeOut(10,function(){$(this).remove()});westerb_sal.request_done=!0})):westerb_sal.please_wait_msg(c):westerb_sal.please_wait_msg(c)});a=westerb_sal.create_xhr();a.onreadystatechange=function(){4===a.readyState&&(clicked_o_name=$(".clicked_o_name"),westerb_sal.clear_p_timers(),clicked_o_name.siblings(".processing_msg").html("").css("z-index", "0"),clicked_o_name.text(clicked_o_name.attr("by")),200===a.status?(westerb_sal.opened_album_groups.add_record(clicked_o_name),1==westerb_sal.opened_album_groups.opened_count?(b.animate({width:"1050px","min-width":""},200,"linear",function(){clicked_o_name.siblings("div.albums").hide().html(a.responseText);westerb_sal.exec_code_for_album_group();clicked_o_name.siblings("div.albums").slideDown(800,function(){$("#wait_msg").fadeOut(10,function(){$(this).remove()});westerb_sal.request_done=!0})}),$("div.message_wrapper").slideUp(100)): (clicked_o_name.siblings("div.albums").hide().html(a.responseText),westerb_sal.exec_code_for_album_group(),clicked_o_name.siblings("div.albums").slideDown(800,function(){$("#wait_msg").fadeOut(10,function(){$(this).remove()});westerb_sal.request_done=!0})),westerb_sal.store_albums("list_albums_ao_id="+clicked_o_name.parent("div").attr("id"),a.responseText)):(clicked_o_name.removeClass("clicked"),westerb_sal.display_msg("Failure: "+a.status,"error")))}},writable:!1,enumerable:!0,configurable:!0},a_name_edit_mode:{value:function(a){if(westerb_sal.request_done)if(westerb_sal.blocking_dialog)westerb_sal.scroll_to_dialog(); else{var b="<form class='mini_form a_name_edit' method='post' action='edit_aname.php?enma_id=",b=b+($(this).parent(".name_edit_save").parent(".album").attr("a_id")+"'>"),b=b+"<input class='mini_form_edit_field' name='a_name' type='text' maxlength='100' value='",c=$(this).siblings(".name").text(),d=$(this).parents("div.album"),b=b+(c+"'>"),b=b+"<div class='cancel_counter'>",b=b+"<a href='list_albums.php?o_id=",b=b+d.attr("name"),b=b+"' class='scriptable_gen_link cancel_name_edit'>Cancel editing</a>", b=b+("<span class='char_counter'>"+(100-$(this).siblings(".name").text().length)+"</span>"),b=b+"</div>",b=b+"<input class='save_a_name_edit scriptable_gen_link' type='submit' value='' title='Update changes'>",b=b+"</form>";$(this).parent(".name_edit_save").html(b);var e=function(){westerb_sal.request_done?westerb_sal.blocking_dialog?westerb_sal.scroll_to_dialog():(b="<span class='name'>",b+=c+"</span>",b+="<a href='list_albums.php?o_id=",b+=$(this).parent(".cancel_counter").parent("form").parent(".name_edit_save").parent(".album").attr("name")+ "&enma_id=",b+=$(this).parent(".cancel_counter").parent("form").parent(".name_edit_save").parent(".album").attr("a_id"),b+="' class='edit edit_a_name scriptable_gen_link' title='Edit album name'></a>",d.find("a.cancel_name_edit").unbind("click",e),$(this).parent(".cancel_counter").parent("form").parent(".name_edit_save").html(b)):westerb_sal.please_wait_msg(a);return!1};$("a.cancel_name_edit",d).click(e);d.find("input.save_a_name_edit").data("unedited_a_name",c)}else westerb_sal.please_wait_msg(a); return!1},writable:!0,enumerable:!0,configurable:!0},display_albums_section_msg:{value:function(a,b,c,d){b||(b="Something went wrong while updating the name. Refresh the page and try again.");c||(c="error");d||(d=4E3);var e=$(".albums_by#"+a).find("div.section_ui_msg_wrapper"),f=color="";window.clearTimeout(westerb_sal.msg_remove_timer);e.html("");$(".albums_by#"+a).find("div.albums").scrollTop(0);switch(c){case "error":f="#F9E5E6";color="#AA1221";break;case "notice":f="#F7F0CB";color="#C46600";break; case "info":f="#D8ECF5";color="#2E81A8";break;case "success":f="#E6F0C2",color="#967B35"}e.append("<div id='sect_msg' style='position: absolute; padding: 4px; font-weight: bold; background-color: "+f+"; color: "+color+"; border-radius: 3px; z-index: 1001;'></div>");$("#sect_msg").hide().text(b).fadeIn(200,function(){westerb_sal.msg_remove_timer=window.setTimeout(function(){$("#sect_msg").fadeOut(200,function(){$(this).remove()})},d)});if("error"===c||"success"===c)westerb_sal.request_done=!0},writable:!0, enumerable:!0,configurable:!0},construct_notes_box:{value:function(a,b,c){null==c&&(c=!1);null==b&&(b=0);var d;d="<div class='a_notes_wrapper ajax_called'>"+("<form class='mini_form' action='edit_notes.php?a_notes="+a+"' method='post'>");d+="<textarea sentry='0' name='a_notes' class='anotes ajax_called mini_form_edit_field' maxlength='3000'></textarea>";d+="<div class='notes_edit'><a class='close_notes' style='margin-left: 2px; font-weight: bold; font-size: 12px;' href='#'>";d+=c?"Close notes":"Cancel"; d+="</a>";d+="<span class='char_counter'>";d+=c?3E3-b:"3000";d+="</span>";c&&(d+="<a class='del_notes' href='edit_notes.php?da_notes="+a,d+="' title='Delete album notes'><div class='absolute_pos delete ajax_called'>&#x2717;</div></a>");d+="</div></form>";return d+="</div>"},writable:!0,enumerable:!0,configurable:!0},xhr_update_notes:{value:westerb_sal.create_xhr(),writable:!0,enumerable:!0,configurable:!0},handle_update_notes_response:{value:function(){if(4===westerb_sal.xhr_update_notes.readyState){westerb_sal.clear_p_timers(); var a=/Adding/.test(westerb_sal.clicked_input_parent.text())?!0:!1;if(200===westerb_sal.xhr_update_notes.status){var b=$.trim(westerb_sal.xhr_update_notes.responseText.replace(' target="_blank"',"","gm"));westerb_sal.clicked_input_parent.hasClass("deleting_notes")?($(".album[a_id="+westerb_sal.clicked_input_parent.parent("form").parent("div.a_notes_wrapper").parent("div.album").attr("a_id")+"]").each(function(){$(this).children("a.notes").children("div.notes").text("Add notes");$(this).children("div.a_notes_wrapper").slideUp(400, function(){$(this).remove()})}),westerb_sal.clear_notes(westerb_sal.clicked_input_parent.parent("form").parent("div.a_notes_wrapper").parent("div.album").attr("a_id")),westerb_sal.clear_albums(westerb_sal.clicked_input_parent.parent("form").parent("div.a_notes_wrapper").parent("div.album").attr("o_id")),westerb_sal.clear_albums("a"),window.setTimeout(function(){westerb_sal.display_msg("Notes succesfully deleted","success",2500)},430)):($(".album[a_id="+westerb_sal.clicked_input_parent.parent("form").parent("div.a_notes_wrapper").parent("div.album").attr("a_id")+ "]").each(function(){$(this).children("div.a_notes_wrapper").children("form").children(".mini_form_edit_field").val(b).text(b);$(this).children("div.a_notes_wrapper").children("form").children("textarea").attr("sentry","0");$(this).children("div.a_notes_wrapper").children("form").children("textarea").unbind("keyup",westerb_sal.toggle_cancel).bind("keyup",{initial_val:b,see:!0},westerb_sal.toggle_cancel);$(this).children("div.a_notes_wrapper").children("form").children("div.notes_edit").html("<a class='close_notes' style='margin-left: 2px; font-weight: bold; font-size: 12px;' href='#'>Close notes</a><span class='char_counter'>"+ (3E3-westerb_sal.clicked_input_parent.parent("form").children("textarea").val().length)+"</span><a class='del_notes' href='edit_notes.php?da_notes="+westerb_sal.clicked_input_parent.parent("form").parent("div.a_notes_wrapper").parent("div.album").attr("a_id")+"' title='Delete album notes'><div class='absolute_pos delete ajax_called'>&#x2717;</div></a>");$(this).children("div.a_notes_wrapper").children("form").children("div.notes_edit").children("a.close_notes").unbind("click",westerb_sal.close_notes_box).click(westerb_sal.close_notes_box); $(this).children("div.a_notes_wrapper").children("form").children("div.notes_edit").children("a.del_notes").unbind("click",westerb_sal.update_notes).click(westerb_sal.update_notes)}),a&&($(".album[a_id="+westerb_sal.clicked_input_parent.parent("form").parent("div.a_notes_wrapper").parent("div.album").attr("a_id")+"]").each(function(){$(this).children("a.notes").children("div.notes").text("See notes")}),westerb_sal.clear_albums(westerb_sal.clicked_input_parent.parent("form").parent("div.a_notes_wrapper").parent("div.album").attr("o_id")), westerb_sal.clear_albums("a")),westerb_sal.store_notes("list_albums_an_id="+westerb_sal.clicked_input_parent.parent("form").parent("div.a_notes_wrapper").parent("div.album").attr("a_id"),b),window.setTimeout(function(){westerb_sal.display_msg("Notes updated successfully","success",2500)},30))}else a=a?"<input type='submit' value='Add album notes' class='update_notes'><span class='char_counter'>"+(3E3-westerb_sal.clicked_input_parent.parent("form").children("textarea").val().length)+"</span>":"<input type='submit' value='Update changes' class='update_notes'><span class='char_counter'>"+ (3E3-westerb_sal.clicked_input_parent.parent("form").children("textarea").val().length)+"</span><a class='del_notes' href='edit_notes.php?da_notes="+westerb_sal.clicked_input_parent.parent("form").parent("div.a_notes_wrapper").parent("div.album").attr("a_id")+"' title='Delete album notes'><div class='absolute_pos delete ajax_called'>&#x2717;</div></a>",westerb_sal.clicked_input_parent.html(a),westerb_sal.display_msg("Failure: "+westerb_sal.xhr_update_notes.status,"error"),westerb_sal.clicked_input_parent.children("input.update_notes").click(westerb_sal.update_notes), westerb_sal.clicked_input_parent.children("a.del_notes").click(westerb_sal.update_notes)}},writable:!0,enumerable:!0,configurable:!0},update_notes:{value:function(a){westerb_sal.blocking_dialog?(westerb_sal.scroll_to_dialog(),westerb_sal.highlight_dialog(a)):westerb_sal.request_done?(westerb_sal.request_done=!1,westerb_sal.clicked_input_parent=$(this).parent("div.notes_edit"),$(this).hasClass("del_notes")?westerb_sal.clicked_input_parent.addClass("deleting_notes"):westerb_sal.clicked_input_parent.removeClass("deleting_notes"), 1==westerb_sal.perms?(a="",a=westerb_sal.clicked_input_parent.hasClass("deleting_notes")?"delete":"Update changes"==$(this).val()?"edit":"add",westerb_sal.display_msg("As a guest, you do not have sufficient privileges to "+a+" album notes","notice")):(westerb_sal.clicked_input_parent.hasClass("deleting_notes")?westerb_sal.clicked_input_parent.get(0).processing_msg("Deleting"):"Update changes"==$(this).val()?westerb_sal.clicked_input_parent.get(0).processing_msg("Updating"):westerb_sal.clicked_input_parent.get(0).processing_msg("Adding"), westerb_sal.xhr_update_notes.open("post",westerb_sal.HOME+"ajax/misc_calls.php?a_notes="+westerb_sal.clicked_input_parent.parent("form").parent("div.a_notes_wrapper").parent("div.album").attr("a_id"),!0),westerb_sal.xhr_update_notes.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),westerb_sal.xhr_update_notes.send("a_notes="+(westerb_sal.clicked_input_parent.hasClass("deleting_notes")?"":encodeURIComponent(westerb_sal.clicked_input_parent.parent("form").children("textarea").val().replace(" ", "+","gm")))))):westerb_sal.please_wait_msg(a);return!1},writable:!0,enumerable:!0,configurable:!0},close_notes_box:{value:function(a){westerb_sal.blocking_dialog?(westerb_sal.scroll_to_dialog(),westerb_sal.highlight_dialog(a)):$(this).parent("div.notes_edit").parent("form").parent("div.a_notes_wrapper").slideUp(400,function(){$(this).remove()});return!1},writable:!0,enumerable:!0,configurable:!0},toggle_cancel:{value:function(a){0==$(this).attr("sentry")&&$.trim($(this).val())!=a.data.initial_val? ($(this).siblings("div.notes_edit").children("a.close_notes").remove(),a.data.see?$(this).siblings("div.notes_edit").children("span.char_counter").before("<input type='submit' value='Update changes' class='update_notes'>"):$(this).siblings("div.notes_edit").children("span.char_counter").before("<input type='submit' value='Add album notes' class='update_notes'>"),$(this).siblings("div.notes_edit").children("input.update_notes").click(westerb_sal.update_notes),$(this).attr("sentry","1")):1==$(this).attr("sentry")&& $.trim($(this).val())==a.data.initial_val&&($(this).siblings("div.notes_edit").children("input.update_notes").remove(),$(this).siblings("div.notes_edit").children("span.char_counter").before("<a class='close_notes' style='margin-left: 3px; font-weight: bold; font-size: 12px;' href='#'>"+(a.data.see?"Close notes":"Cancel")+"</a>"),$(this).siblings("div.notes_edit").children("a.close_notes").click(westerb_sal.close_notes_box),$(this).attr("sentry","0"))},writable:!0,enumerable:!0,configurable:!0},xhr_get_notes:{value:westerb_sal.create_xhr(), writable:!0,enumerable:!0,configurable:!0},handle_get_notes_response:{value:function(){if(4===westerb_sal.xhr_get_notes.readyState)if(clicked_see_notes=$(".clicked_see_notes"),westerb_sal.clear_p_timers(),clicked_see_notes.children("div.notes").css({"font-size":"14px",padding:"5px 2px","text-align":"center"}).text("See notes"),200===westerb_sal.xhr_get_notes.status){var a=$.trim(westerb_sal.xhr_get_notes.responseText.replace(' target="_blank"',"","gm"));clicked_see_notes.parent("div.album").append(westerb_sal.construct_notes_box(clicked_see_notes.parent("div.album").attr("a_id"), a.length,!0));clicked_see_notes.parent("div.album").children("div.a_notes_wrapper").children("form").children("textarea").val(a);clicked_see_notes.parent("div.album").children("div.a_notes_wrapper").children("form").children("textarea").bind("keyup",{initial_val:a,see:!0},westerb_sal.toggle_cancel);clicked_see_notes.parent("div.album").children("div.a_notes_wrapper").children("form").children("div.notes_edit").children("a.close_notes").click(westerb_sal.close_notes_box);clicked_see_notes.parent("div.album").children("div.a_notes_wrapper").children("form").children("div.notes_edit").children("a.del_notes").click(westerb_sal.update_notes); clicked_see_notes.parent("div.album").children("div.a_notes_wrapper").slideDown(400,function(){$("#wait_msg").fadeOut(10,function(){$(this).remove()});westerb_sal.request_done=!0});westerb_sal.store_notes("list_albums_an_id="+clicked_see_notes.parent("div.album").attr("a_id"),a)}else westerb_sal.display_msg("Failure: "+westerb_sal.xhr_get_notes.status,"error")},writable:!0,enumerable:!0,configurable:!0},add_notes:{value:function(a){westerb_sal.blocking_dialog?westerb_sal.scroll_to_dialog():"See notes"=== $(this).children("div.notes").text()?(pre_stored_notes=westerb_sal.retrieve_notes("list_albums_an_id="+$(this).parent("div.album").attr("a_id")),pre_stored_notes)?westerb_sal.request_done&&(westerb_sal.request_done=!1,$(this).parent("div.album").append(westerb_sal.construct_notes_box($(this).parent("div.album").attr("a_id"),pre_stored_notes.length,!0)),a=$(this).parent("div.album").children("div.a_notes_wrapper").children("form"),a.children("textarea").val(pre_stored_notes),a.children("textarea").bind("keyup", {initial_val:pre_stored_notes,see:!0},westerb_sal.toggle_cancel),a.children("div.notes_edit").children("a.close_notes").click(westerb_sal.close_notes_box),a.children("div.notes_edit").children("a.del_notes").click(westerb_sal.update_notes),$(this).parent("div.album").children("div.a_notes_wrapper").slideDown(400,function(){westerb_sal.request_done=!0})):westerb_sal.request_done?(westerb_sal.request_done=!1,$(".clicked_see_notes").removeClass("clicked_see_notes"),$(this).addClass("clicked_see_notes"), $(this).children("div.notes").css({"font-size":"12px",padding:"5px 0 5px 5px","text-align":"left"}).get(0).processing_msg("Loading"),westerb_sal.xhr_get_notes.open("get",westerb_sal.HOME+"ajax/misc_calls.php?an_id="+$(this).parent("div.album").attr("a_id"),!0),westerb_sal.xhr_get_notes.send(null)):westerb_sal.please_wait_msg(a):"Add notes"===$(this).children("div.notes").text()&&westerb_sal.request_done&&(westerb_sal.request_done=!1,$(this).parent("div.album").append(westerb_sal.construct_notes_box($(this).parent("div.album").attr("a_id"))), a=$(this).parent("div.album").children("div.a_notes_wrapper").children("form"),a.children("textarea").bind("keyup",{initial_val:"",see:!1},westerb_sal.toggle_cancel),a.children("div.notes_edit").children("a.close_notes").click(westerb_sal.close_notes_box),$(this).parent("div.album").children("div.a_notes_wrapper").slideDown(400,function(){westerb_sal.request_done=!0}));return!1},writable:!0,enumerable:!0,configurable:!0},xhr_del_album_as_admin:{value:westerb_sal.create_xhr(),writable:!0,enumerable:!0, configurable:!0},handle_del_album_as_admin_response:{value:function(){if(4===westerb_sal.xhr_del_album_as_admin.readyState){album=$(".deleted_album");var a=album.parent("div.inner_a_wrapper");westerb_sal.clear_p_timers();a.parent("div.albums").siblings("div.processing_msg").html("");if(200===westerb_sal.xhr_del_album_as_admin.status){var b=0;westerb_sal.opened_album_groups.is_opened("a")&&(b=parseInt(a.children("p").children("span:first").text())-1,a.children("p").children("span:first").text(b+(1== b?" album":" albums")),1===b&&a.children("p").children("span:last").fadeOut(250,function(){$(this).remove()}),album.slideUp(350,function(){$(this).remove();if(8<parseInt(a.parent("div").parent("td").parent("tr").prev("tr").children("td.see_close_coms").attr("u_count"),10)&&0==clicked_parent_parent.children("div").size()){var b=westerb_sal.s_pag_instances["p_id_"+a.parent("div").parent("td").parent("tr").prev("tr").attr("p_id")];b.current_set=parseInt(a.parent("div").attr("cur_set"),10);b.next_set()&& (westerb_sal.request_done=!1,$(".clicked").removeClass("clicked"),a.parent("div").parent("td").parent("tr").prev("tr").children("td.see_close_coms").addClass("clicked"),$(".clicked").removeClass("create_new_s_pag"),a.parent("div").parent("td").children("div.load_more_msg").css("margin-top","6px").get(0).processing_msg("Please wait"),b.current_set++,xhr_get_more_comments.open("get",westerb_sal.HOME+"ajax/misc_calls.php?pc_id="+a.parent("div").parent("td").parent("tr").prev("tr").attr("p_id")+"&u_per_set="+ b.units_per_set+"&offset="+b.offset(),!0),xhr_get_more_comments.send(null))}}));0===remaining_comments&&(a.parent("div").parent("td").parent("tr").slideUp(360,function(){westerb_sal.clear_sets();westerb_sal.clear_comments(a.parent("div").parent("td").parent("tr").prev("tr").attr("p_id"));$(this).remove()}),a.parent("div").parent("td").parent("tr").prev("tr").children(".see_close_coms").text("No comments"));$("#wait_msg").fadeOut(10,function(){$(this).remove()});westerb_sal.clear_comments(a.parent("div").parent("td").parent("tr").prev("tr").attr("p_id")); westerb_sal.request_done=!0}else alert("failure")}},writable:!0,enumerable:!0,configurable:!0},del_album_as_admin:{value:function(a){westerb_sal.request_done=!1;1==westerb_sal.perms?westerb_sal.display_msg("As a guest, you do not have sufficient privileges to delete albums","notice"):($(".deleted_album").removeClass("deleted_album"),a.addClass("deleted_album"),a.parent("div.inner_a_wrapper").parent("div.albums").siblings("div.processing_msg").css("margin-top","44px").get(0).processing_msg("Deleting"), westerb_sal.xhr_del_album_as_admin.open("get",westerb_sal.HOME+"ajax/misc_calls.php?da_id="+a.attr("a_id"),!0),westerb_sal.xhr_del_album_as_admin.send(null));return!1},writable:!0,enumerable:!0,configurable:!0},xhr_get_more_albums:{value:westerb_sal.create_xhr(),writable:!0,enumerable:!0,configurable:!0},handle_get_more_albums_response:{value:function(){if(4===westerb_sal.xhr_get_more_albums.readyState)if(clicked_o_name=$(".clicked_o_name"),westerb_sal.clear_p_timers(),clicked_o_name.siblings(".processing_msg").html("").css("z-index", "0"),200===westerb_sal.xhr_get_more_albums.status){var a=clicked_o_name.siblings("div.albums").children("div.inner_a_wrapper");a.append(westerb_sal.xhr_get_more_albums.responseText);a.children("div.album").children("div.hover_triggered").hide();a.children("div.album").children("a").children("div.hover_triggered").hide();a.attr("cur_set",parseInt(a.attr("cur_set"),10)+1);westerb_sal.store_albums("list_albums_ao_id="+clicked_o_name.parent("div.albums_by").attr("id"),clicked_o_name.siblings("div.albums").html()); westerb_sal.request_done=!0;$("#wait_msg").fadeOut(10,function(){$(this).remove()})}else westerb_sal.display_msg("Failure: "+westerb_sal.xhr_get_more_albums.status,"error")},writable:!0,enumerable:!0,configurable:!0},load_more_albums:{value:function(a){if($(this).scrollTop()===$(this).prop("scrollHeight")-400&&westerb_sal.request_done)if(westerb_sal.blocking_dialog)westerb_sal.scroll_to_dialog(),westerb_sal.highlight_dialog(a);else{$(".clicked_o_name").removeClass("clicked_o_name");$(this).siblings("div.o_name").addClass("clicked_o_name"); a=westerb_sal.s_pag_instances["o_id_"+$(".clicked_o_name").parent("div").attr("id")];var b=parseInt($(this).children("div.inner_a_wrapper").attr("cur_set"),10);westerb_sal.request_done=!1;a.current_set=b;a.next_set()?($(this).siblings("div.processing_msg").css({"margin-top":"415px",left:"45%","z-index":"1000"}).get(0).processing_msg("Loading more"),a.current_set++,westerb_sal.xhr_get_more_albums.open("get",westerb_sal.HOME+"ajax/misc_calls.php?ao_id="+$(this).parent("div.albums_by").attr("id")+"&u_per_set="+ a.units_per_set+"&offset="+a.offset(),!0),westerb_sal.xhr_get_more_albums.send(null)):westerb_sal.request_done=!0}},writable:!0,enumerable:!0,configurable:!0}});westerb_sal.xhr_update_notes.onreadystatechange=westerb_sal.handle_update_notes_response;westerb_sal.xhr_get_notes.onreadystatechange=westerb_sal.handle_get_notes_response;westerb_sal.xhr_del_album_as_admin.onreadystatechange=westerb_sal.handle_del_album_as_admin_response;westerb_sal.xhr_get_more_albums.onreadystatechange=westerb_sal.handle_get_more_albums_response; Object.defineProperty(Object.prototype.westerb_sal,"Opened_Album_Groups",{writable:!1,enumerable:!0,configurable:!0,value:function(){this.opened={};this.opened_count=0}});Object.defineProperties(westerb_sal.Opened_Album_Groups.prototype,{add_record:{value:function(a){this.opened[a.parent("div.albums_by").attr("id")]=a;this.opened_count++},writable:!1,enumerable:!0,configurable:!0},remove_record:{value:function(a){delete this.opened[a.parent("div.albums_by").attr("id")];this.opened_count--},writable:!1, enumerable:!0,configurable:!0}});Object.defineProperty(Object.prototype.westerb_sal,"opened_album_groups",{writable:!0,enumerable:!0,configurable:!0,value:new westerb_sal.Opened_Album_Groups});Object.defineProperties(Object.prototype.westerb_sal,{display_tiny_msg:{value:function(a,b,c){var d=$("#ajax_msg");window.clearTimeout(westerb_sal.msg_remove_timer);d.fadeOut(10);a||(a="Success");var e=a.length;35>e?(b||(b="success"),c||(c=1900),26<e?d.attr("colspan","3"):15<e?d.attr("colspan","2"):d.attr("colspan", "1"),$(document).scrollTop(0),d.removeClass("success notice info error").addClass(b).html(a).fadeIn(50,function(){westerb_sal.msg_remove_timer=window.setTimeout(function(){d.fadeOut(400)},c)}),westerb_sal.request_done=!0,$("#wait_msg").fadeOut(10,function(){$(this).remove()})):westerb_sal.display_msg(a,b,6400)},writable:!1,enumerable:!0,configurable:!0},xhr_make_cover:{value:westerb_sal.create_xhr(),writable:!1,enumerable:!0,configurable:!0},handle_cover_change_response:{value:function(){if(4===westerb_sal.xhr_make_cover.readyState){var a= $(".clicked");westerb_sal.clear_p_timers();if(200===westerb_sal.xhr_make_cover.status){var b=$("#current_cover");b.removeAttr("id").html("<a href='list_photos.php?a_id="+westerb_sal.pagination.album_selected+"&mkcover="+b.parent("tr").attr("p_id")+"' class='scriptable_table_link change_cover'>Make cover photo</a>");a.attr("id","current_cover").html("Current album cover");westerb_sal.display_tiny_msg();westerb_sal.clear_sets()}else a.html("<a href='list_photos.php?a_id="+westerb_sal.pagination.album_selected+ "&mkcover="+a.parent("tr").attr("p_id")+"' class='scriptable_table_link change_cover'>Make cover photo</a>"),westerb_sal.display_tiny_msg("Failure: "+westerb_sal.xhr_make_cover.status,"error",4E3)}},writable:!1,enumerable:!0,configurable:!0},make_cover:{value:function(a){westerb_sal.blocking_dialog?westerb_sal.scroll_to_dialog():westerb_sal.request_done?(westerb_sal.request_done=!1,$(".clicked").removeClass("clicked"),$(this).parent("td").addClass("clicked"),$(this).parent("td").get(0).processing_msg("Changing"), westerb_sal.xhr_make_cover.open("get",westerb_sal.HOME+"ajax/misc_calls.php?mkcover="+$(".clicked").parent("tr").attr("p_id"),!0),westerb_sal.xhr_make_cover.send(null)):westerb_sal.please_wait_msg(a);return!1},writable:!1,enumerable:!0,configurable:!0},xhr_get_comments:{value:westerb_sal.create_xhr(),writable:!1,enumerable:!0,configurable:!0},handle_get_comments_response:{value:function(){if(4===westerb_sal.xhr_get_comments.readyState){var a=$(".clicked"),b=a.parent("tr").next("tr").children("td"); westerb_sal.clear_p_timers();b.children("div.load_more_msg").html("");200===westerb_sal.xhr_get_comments.status?(a.parent("tr").after("<tr class='p_comments'><td colspan='8' class='p_comments'></td></tr>"),a.parent("tr").next("tr").hide().children("td").html(westerb_sal.xhr_get_comments.responseText),a.parent("tr").next("tr").children("td").children("div.comments_wrapper").hide(),a.parent("tr").next("tr").show(),a.parent("tr").next("tr").children("td").children("div.comments_wrapper").slideDown(500), a.html("<a href='list_photos.php?a_id="+westerb_sal.pagination.album_selected+"' class='scriptable_table_link hide_comments'>Close comments</a>"),westerb_sal.store_comments("list_photos_pc_id="+a.parent("tr").attr("p_id"),westerb_sal.xhr_get_comments.responseText),westerb_sal.request_done=!0):(a.html("<a u_count='"+parseInt(a.attr("u_count"),10)+"' href='list_photos.php?a_id="+westerb_sal.pagination.album_selected+"&pc_id="+a.parent("tr").attr("p_id")+"' class='scriptable_table_link'>See comments</a>"), westerb_sal.display_tiny_msg("Failure: "+westerb_sal.xhr_get_comments.status,"error",4E3))}},writable:!1,enumerable:!0,configurable:!0},see_comments:{value:function(a){var b=westerb_sal.retrieve_comments("list_photos_pc_id="+$(this).parent("td").parent("tr").attr("p_id"));if(b)if(westerb_sal.blocking_dialog)westerb_sal.scroll_to_dialog();else if(westerb_sal.request_done){westerb_sal.request_done=!1;$(".clicked").removeClass("clicked");$(this).parent("td").addClass("clicked");$(".clicked").addClass("create_new_s_pag"); var c=$(".clicked");a=c.parent("tr");a.after("<tr class='p_comments'><td colspan='8' class='p_comments'></td></tr>");a.next("tr").hide().children("td").html(b);a.next("tr").children("td").children("div.comments_wrapper").hide();a.next("tr").show();a.next("tr").children("td").children("div.comments_wrapper").slideDown(500,function(){c.html("<a href='list_photos.php?a_id="+westerb_sal.pagination.album_selected+"' class='scriptable_table_link hide_comments'>Close comments</a>");$("#wait_msg").fadeOut(10, function(){$(this).remove()});westerb_sal.request_done=!0})}else westerb_sal.please_wait_msg(a);else westerb_sal.blocking_dialog?westerb_sal.scroll_to_dialog():westerb_sal.request_done?(westerb_sal.request_done=!1,$(".clicked").removeClass("clicked"),$(this).parent("td").addClass("clicked"),$(".clicked").addClass("create_new_s_pag"),$(".clicked").get(0).processing_msg("Loading"),westerb_sal.xhr_get_comments.open("get",westerb_sal.HOME+"ajax/misc_calls.php?pc_id="+$(".clicked").parent("tr").attr("p_id")+ "&u_per_set="+parseInt($("div.u_wrapper").attr("scroll_per_set"),10)+"&offset=0",!0),westerb_sal.xhr_get_comments.send(null)):westerb_sal.please_wait_msg(a);return!1},writable:!1,enumerable:!0,configurable:!0},close_comments:{value:function(a){if(westerb_sal.blocking_dialog)westerb_sal.scroll_to_dialog();else if(!westerb_sal.request_done&&$(this).hasClass("del_in_progress"))westerb_sal.please_wait_msg(a);else{var b=$(this).parent("td"),c=b.parent("tr");c.next("tr").children("td").children("div.comments_wrapper").slideUp(500, function(){c.next("tr").remove();b.html("<a u_count='"+parseInt(b.attr("u_count"),10)+"' href='list_photos.php?a_id="+westerb_sal.pagination.album_selected+"&pc_id="+c.attr("p_id")+"' class='scriptable_table_link display_comments'>See comments</a>")})}return!1},writable:!1,enumerable:!0,configurable:!0},xhr_add_capt:{value:westerb_sal.create_xhr(),writable:!1,enumerable:!0,configurable:!0},add_capt:{value:function(a){westerb_sal.request_done&&!westerb_sal.blocking_dialog?(westerb_sal.request_done= !1,""==a.data.c_parent.children("form").children(".mini_form_edit_field").val()?westerb_sal.display_tiny_msg("You can not add an empty caption","notice",4E3):1==westerb_sal.perms?westerb_sal.display_msg("As a guest, you do not have sufficient privileges to add photo captions","notice"):(westerb_sal.clicked_input_parent=$(this).parent("div"),westerb_sal.clicked_input_parent.get(0).processing_msg("Adding"),westerb_sal.xhr_add_capt.open("post",westerb_sal.HOME+"ajax/misc_calls.php?p_cap="+westerb_sal.clicked_input_parent.parent("form").parent("td").parent("tr").attr("p_id"), !0),westerb_sal.xhr_add_capt.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),westerb_sal.xhr_add_capt.send("p_cap="+encodeURIComponent(westerb_sal.clicked_input_parent.parent("form").children(".mini_form_edit_field").val().replace(" ","+","gm"))))):westerb_sal.please_wait_msg(a);return!1},writable:!1,enumerable:!0,configurable:!0},update_capt_changes:{value:function(a){if(westerb_sal.blocking_dialog)westerb_sal.scroll_to_dialog();else if(westerb_sal.request_done)if(westerb_sal.request_done= !1,$(this).children("div").hasClass("delete_cap")?$(this).parent("div").addClass("deleting_capt"):$(this).parent("div").removeClass("deleting_capt"),1==westerb_sal.perms)westerb_sal.display_msg("As a guest, you do not have sufficient privileges to edit photo captions","notice");else{westerb_sal.clicked_input_parent=$(this).parent("div");var b="";$(this).children("div").hasClass("delete")?(a="Deleting",b=""):(a="Updating",b=encodeURIComponent(westerb_sal.clicked_input_parent.parent("form").children(".mini_form_edit_field").val().replace(" ", "+","gm")));westerb_sal.clicked_input_parent.get(0).processing_msg(a);westerb_sal.xhr_add_capt.open("post",westerb_sal.HOME+"ajax/misc_calls.php?p_cap="+westerb_sal.clicked_input_parent.parent("form").parent("td").parent("tr").attr("p_id"),!0);westerb_sal.xhr_add_capt.setRequestHeader("Content-Type","application/x-www-form-urlencoded");westerb_sal.xhr_add_capt.send("p_cap="+b)}else westerb_sal.please_wait_msg(a);return!1},writable:!1,enumerable:!0,configurable:!0},show_add_capt_input:{value:function(a){if(westerb_sal.blocking_dialog)westerb_sal.scroll_to_dialog(); else{a=$(this).parent("td");var b="<form class='mini_form' action='misc_calls.php?p_cap="+a.parent("tr").attr("p_id")+"' method='post'>",b=b+"<textarea name='p_cap' class='fcapt mini_form_edit_field' maxlength='4000'></textarea><div class='capt_edit new_capt'><input type='submit' value='Add caption' class='scriptable_table_link show_capt_input'>",b=b+"<span class='char_counter'>4000</span>",b=b+"</div></form>";a.html(b);a.children("form").children(".capt_edit").children("input").bind("click",{c_parent:a}, westerb_sal.add_capt)}return!1},writable:!1,enumerable:!0,configurable:!0},handle_add_capt_response:{value:function(){if(4===westerb_sal.xhr_add_capt.readyState)if(westerb_sal.clear_p_timers(),200===westerb_sal.xhr_add_capt.status){var a=$.trim(westerb_sal.xhr_add_capt.responseText.replace(' target="_blank"',"","gm"));westerb_sal.clicked_input_parent.hasClass("deleting_capt")?(westerb_sal.clicked_input_parent.parent("form").parent("td").html("<a class='scriptable_table_link show_capt_input' href='list_photos.php?a_id="+ westerb_sal.pagination.album_selected+"&pcap_id="+westerb_sal.clicked_input_parent.parent("form").parent("td").parent("tr").attr("p_id")+"'>Add caption</a>"),westerb_sal.display_tiny_msg(),westerb_sal.store_set(westerb_sal.cur_pg+"_"+westerb_sal.pagination.set_group+"_s"+westerb_sal.pagination.current_set,$("table tbody").html())):(/Notice:/.test(a)?westerb_sal.display_tiny_msg(a.replace("Notice:",""),"notice",4E3):(westerb_sal.clicked_input_parent.parent("form").children(".mini_form_edit_field").val(a).text(a), westerb_sal.display_tiny_msg()),westerb_sal.clicked_input_parent.removeClass("new_capt"),westerb_sal.clicked_input_parent.html("<input type='submit' value='Update changes' class='scriptable_table_link edit_caption'><span class='char_counter'>"+(4E3-westerb_sal.clicked_input_parent.parent("form").children(".mini_form_edit_field").val().length)+"</span><a class='scriptable_table_link' href='edit_capt.php?dp_cap="+westerb_sal.clicked_input_parent.parent("form").parent("td").parent("tr").attr("p_id")+ "' title='Delete caption'><div class='absolute_pos delete delete_cap'>&#x2717;</div></a>"),/Notice:/.test(a)||westerb_sal.store_set(westerb_sal.cur_pg+"_"+westerb_sal.pagination.set_group+"_s"+westerb_sal.pagination.current_set,$("table tbody").html()))}else a=westerb_sal.clicked_input_parent.hasClass("new_capt")?"<input type='submit' value='Add caption' class='scriptable_table_link show_capt_input'><span class='char_counter'>"+(4E3-westerb_sal.clicked_input_parent.parent("form").children(".mini_form_edit_field").val().length)+ "</span>":"<input type='submit' value='Update changes' class='scriptable_table_link edit_caption'><span class='char_counter'>"+(4E3-westerb_sal.clicked_input_parent.parent("form").children(".mini_form_edit_field").val().length)+"</span><a class='scriptable_table_link' href='edit_capt.php?dp_cap="+westerb_sal.clicked_input_parent.parent("form").parent("td").parent("tr").attr("p_id")+"' title='Delete caption'><div class='absolute_pos delete delete_cap'>&#x2717;</div></a>",westerb_sal.clicked_input_parent.html(a), westerb_sal.display_tiny_msg("Failure: "+westerb_sal.xhr_add_capt.status,"error",4E3),westerb_sal.clicked_input_parent.hasClass("new_capt")&&westerb_sal.clicked_input_parent.children("input").bind("click",{c_parent:westerb_sal.clicked_input_parent.parent("form").parent("td")},westerb_sal.add_capt)},writable:!1,enumerable:!0,configurable:!0},xhr_del_photo:{value:westerb_sal.create_xhr(),writable:!1,enumerable:!0,configurable:!0},del_photo:{value:function(a){westerb_sal.blocking_dialog?westerb_sal.scroll_to_dialog(): westerb_sal.request_done?(westerb_sal.request_done=!1,1==westerb_sal.perms?westerb_sal.display_msg("As a guest, you do not have sufficient privileges to delete photos","notice"):($(".clicked").removeClass("clicked"),$(this).parent("td").addClass("clicked"),$(this).parent("td").get(0).processing_msg(),westerb_sal.xhr_del_photo.open("get",westerb_sal.HOME+"ajax/misc_calls.php?del_p_id="+$(".clicked").parent("tr").attr("p_id"),!0),westerb_sal.xhr_del_photo.send(null))):westerb_sal.please_wait_msg(a); return!1},writable:!1,enumerable:!0,configurable:!0},handle_del_photo_response:{value:function(){if(4===westerb_sal.xhr_del_photo.readyState){var a=$(".clicked");westerb_sal.clear_p_timers();200===westerb_sal.xhr_del_photo.status?(a.parent("tr").slideUp(400,function(){$(this).remove()}),a=parseInt($("#u_count").text(),10)-1,$("#u_count").text(a),westerb_sal.clear_sets(),westerb_sal.clear_albums("a"),westerb_sal.clear_albums($("#photos_wrapper").attr("ao_id")),westerb_sal.clear_main_page_state("#list_photos_"+ $("span.modal_caller_parent.new_photo").attr("a_id")),1==a&&($("#plural_s").text(""),$("#del_all").parent("span").prev().fadeOut(300,function(){$(this).remove()}),$("#del_all").parent("span").fadeOut(300,function(){$(this).remove()})),0==a?($("#plural_s").text("s"),$("#del_album").parent("span").prev().fadeOut(300,function(){$(this).remove()}),$("#del_album").parent("span").fadeOut(300,function(){$(this).remove()}),window.setTimeout(function(){$("table").replaceWith("<div id='no_photos_alert'>There are currently no photos in this album</div>")}, 400)):4>=a?4==$("#u_count").text()&&($("#nav").remove(),$("#ux_nav_guide").hide(),1!=westerb_sal.pagination.current_set&&westerb_sal.pagination.current_set--,westerb_sal.get_units_animation_timer=window.setTimeout(function(){$("table tbody").children().css("visibility","hidden")},90),$("#ajax_loading_pholder").html("<div id='pholder_msg'></div>"),$("#pholder_msg").get(0).processing_msg("Loading"),westerb_sal.xhr_for_units.open("get",westerb_sal.HOME+"ajax/list_photos_u_retrieve.php?u_per_set="+westerb_sal.pagination.units_per_set+ "&offset="+westerb_sal.pagination.offset()+"&o_id="+westerb_sal.pagination.albums_owner+"&a_id="+westerb_sal.pagination.album_selected,!0),westerb_sal.xhr_for_units.send(null)):(westerb_sal.get_units_animation_timer=window.setTimeout(function(){$("table tbody").children().css("visibility","hidden")},90),$("#ajax_loading_pholder").html("<div id='pholder_msg'></div>"),$("#pholder_msg").get(0).processing_msg("Loading"),westerb_sal.xhr_for_units.open("get",westerb_sal.HOME+"ajax/list_photos_u_retrieve.php?u_per_set="+ westerb_sal.pagination.units_per_set+"&offset="+westerb_sal.pagination.offset()+"&o_id="+westerb_sal.pagination.albums_owner+"&a_id="+westerb_sal.pagination.album_selected,!0),westerb_sal.xhr_for_units.send(null)),westerb_sal.request_done=!0):(a.html("<a href='delete_photo.php?p_id="+a.parent("tr").attr("p_id")+"' class='scriptable_table_link photo_delete'>Delete</a>"),westerb_sal.display_tiny_msg("Failure: "+westerb_sal.xhr_del_photo.status,"error",4E3))}},writable:!1,enumerable:!0,configurable:!0}, restore_pre_simulation_state:{value:function(a){$(this).children("div").hasClass("inactive")&&$("tr.simulation_row").fadeOut(400,function(){$(this).remove()});westerb_sal.pagination.adjust_prev_and_next();$("#u_count").text($("#u_count").attr("p_count_before_simulation_starts"));0==$("#u_count").attr("p_count_before_simulation_starts")?($("span.del_album").prev("span.link_separator").fadeOut(400,function(){$(this).next("span.del_album").fadeOut(400,function(){$(this).remove()});$(this).remove()}), $("span.del_all_photos").prev("span.link_separator").fadeOut(450,function(){$(this).next("span.del_all_photos").fadeOut(450,function(){$(this).remove()});$(this).remove()}),$("#ux_nav_guide").text("0 of 0"),$("#plural_s").text("s")):$("#ux_nav_guide").text(westerb_sal.pagination.ux_nav_guide());1==$("#u_count").attr("p_count_before_simulation_starts")&&($("span.del_all_photos").prev("span.link_separator").fadeOut(450,function(){$(this).next("span.del_all_photos").fadeOut(450,function(){$(this).remove()}); $(this).remove()}),$("#plural_s").text(""))},writable:!1,enumerable:!0,configurable:!0},xhr_get_more_comments:{value:westerb_sal.create_xhr(),writable:!1,enumerable:!0,configurable:!0},handle_get_more_comments_response:{value:function(){if(4===westerb_sal.xhr_get_more_comments.readyState){var a=$(".clicked"),b=a.parent("tr").next("tr").children("td"),c="";westerb_sal.clear_p_timers();b.children("div.load_more_msg").html("");200===westerb_sal.xhr_get_more_comments.status?(b.children("div.comments_wrapper").children("div.comments").append(westerb_sal.xhr_get_more_comments.responseText), c=b.children("div.comments_wrapper").children("div.comments").children("div.comment").children("a.del_com"),c.each(function(){$(this).hasClass("bound")||$(this).click(westerb_sal.del_com).addClass("bound")}),b.children("div.comments_wrapper").attr("cur_set",parseInt(b.children("div.comments_wrapper").attr("cur_set"),10)+1),westerb_sal.store_comments("list_photos_pc_id="+a.parent("tr").attr("p_id"),a.parent("tr").next("tr").children("td").html()),westerb_sal.request_done=!0):westerb_sal.display_tiny_msg("Failure: "+ westerb_sal.xhr_get_more_comments.status)}},writable:!1,enumerable:!0,configurable:!0},load_more_comments:{value:function(a){if($(this).scrollTop()===$(this).prop("scrollHeight")-280&&westerb_sal.request_done)if(westerb_sal.blocking_dialog)westerb_sal.scroll_to_dialog(),westerb_sal.highlight_dialog(a);else{$(".clicked").removeClass("clicked");$(this).parent("td").parent("tr").prev("tr").children("td.see_close_coms").addClass("clicked");a=westerb_sal.s_pag_instances["p_id_"+$(".clicked").parent("tr").attr("p_id")]; var b=parseInt($(this).attr("cur_set"),10);westerb_sal.request_done=!1;a.current_set=b;a.next_set()?($(".clicked").removeClass("create_new_s_pag"),$(this).parent("td").children("div.load_more_msg").css("margin-top","245px").get(0).processing_msg("Loading more"),a.current_set++,westerb_sal.xhr_get_more_comments.open("get",westerb_sal.HOME+"ajax/misc_calls.php?pc_id="+$(this).parent("td").parent("tr").prev("tr").attr("p_id")+"&u_per_set="+a.units_per_set+"&offset="+a.offset(),!0),westerb_sal.xhr_get_more_comments.send(null)): westerb_sal.request_done=!0}},writable:!1,enumerable:!0,configurable:!0},xhr_del_com:{value:westerb_sal.create_xhr(),writable:!1,enumerable:!0,configurable:!0},visualize_comment_deletion:{value:function(){var a=$(".clicked"),b=a.parent("div"),c=parseInt(b.siblings("p").children("span:first").text(),10)-1;westerb_sal.clear_p_timers();b.parent("div").siblings(".load_more_msg").html("");b.siblings("p").children("span:first").text(c+(1==c?" comment":" comments"));1===c&&b.siblings("p").children("span:last").fadeOut(250, function(){$(this).remove()});a.slideUp(350,function(){$(this).remove();if(8<parseInt(b.parent("div").parent("td").parent("tr").prev("tr").children("td.see_close_coms").attr("u_count"),10)&&0==b.children("div").size()){var a=westerb_sal.s_pag_instances["p_id_"+b.parent("div").parent("td").parent("tr").prev("tr").attr("p_id")];a.current_set=parseInt(b.parent("div").attr("cur_set"),10);$(".clicked").removeClass("clicked");b.parent("div").parent("td").parent("tr").prev("tr").children("td.see_close_coms").addClass("clicked"); a.next_set()&&(westerb_sal.request_done=!1,$(".clicked").removeClass("create_new_s_pag"),b.parent("div").parent("td").children("div.load_more_msg").css("margin-top","6px").get(0).processing_msg("Please wait"),a.current_set++,westerb_sal.xhr_get_more_comments.open("get",westerb_sal.HOME+"ajax/misc_calls.php?pc_id="+b.parent("div").parent("td").parent("tr").prev("tr").attr("p_id")+"&u_per_set="+a.units_per_set+"&offset="+a.offset(),!0),westerb_sal.xhr_get_more_comments.send(null))}});0===c&&(b.parent("div").parent("td").parent("tr").slideUp(360, function(){westerb_sal.clear_sets();westerb_sal.s_pag_instances["p_id_"+b.parent("div").parent("td").parent("tr").prev("tr").attr("p_id")]&&delete westerb_sal.s_pag_instances["p_id_"+b.parent("div").parent("td").parent("tr").prev("tr").attr("p_id")];$(this).remove()}),b.parent("div").parent("td").parent("tr").prev("tr").children(".see_close_coms").text("No comments"));$("#wait_msg").fadeOut(10,function(){$(this).remove()});westerb_sal.clear_comments(b.parent("div").parent("td").parent("tr").prev("tr").attr("p_id")); westerb_sal.request_done=!0},writable:!1,enumerable:!0,configurable:!0},del_com:{value:function(a){westerb_sal.blocking_dialog?westerb_sal.scroll_to_dialog():westerb_sal.request_done?(westerb_sal.request_done=!1,$(".clicked").removeClass("clicked"),$(this).parent("div").addClass("clicked"),$(this).parent("div").parent("div").parent("div").siblings(".load_more_msg").css("margin-top","22px").get(0).processing_msg("Deleting"),1==westerb_sal.perms?setTimeout(function(){westerb_sal.visualize_comment_deletion()}, 1E3):(westerb_sal.xhr_del_com.open("get",westerb_sal.HOME+"ajax/misc_calls.php?dc_id="+$(".clicked").attr("c_id"),!0),westerb_sal.xhr_del_com.send(null))):westerb_sal.please_wait_msg(a);return!1},writable:!1,enumerable:!0,configurable:!0},handle_del_com_response:{value:function(){4===westerb_sal.xhr_del_com.readyState&&(200===westerb_sal.xhr_del_com.status?westerb_sal.visualize_comment_deletion():westerb_sal.display_tiny_msg("Failure: "+westerb_sal.xhr_del_com.status))},writable:!1,enumerable:!0, configurable:!0},visualize_all_photos_or_album_deletion:{value:function(a,b){function c(){$("tr").each(function(){d.push($(this))});e=d.length-1;(function m(){f=d[e];f.fadeOut(450,function(){f.remove()});e--;0<=e&&(f.attr("p_id")&&window.setTimeout(function(){g.text(parseInt(g.text(),10)-1);$("#plural_s").text(1===e?"":"s")},450),window.setTimeout(m,470),0===e&&window.setTimeout(function(){westerb_sal.clear_sets();if("photos"===b){westerb_sal.clear_p_timers();var c=$("span.del_confirm_parent:first"), d=$("#del_album");$("span.link_separator:last").remove();d.fadeOut(300,function(){d.remove()});c.prev().remove();c.fadeOut(400,function(){c.remove()});$("table").replaceWith("<div id='no_photos_alert'></div>");$("#no_photos_alert").hide().text("There are currently no photos in this album").fadeIn(500)}else westerb_sal.clear_p_timers(),a.get(0).processing_msg("Redirecting"),window.setTimeout(function(){westerb_sal.clear_p_timers();location="list_albums.php"},2E3);westerb_sal.request_done=!0},700))})()} var d=[],e=0,f=null,g=$("#u_count");4<parseInt(g.text(),10)?$("#nav").fadeOut(400,function(){$("#ux_nav_guide").fadeOut(400,function(){g.text("4");c()})}):(g.text("4"),c())},writable:!1,enumerable:!0,configurable:!0},del_all_photos:{value:function(a,b){westerb_sal.request_done=!1;1==westerb_sal.perms?westerb_sal.visualize_all_photos_or_album_deletion(a,b):(westerb_sal.xhr_del_all.open("get",westerb_sal.HOME+"ajax/misc_calls.php?dpa_id="+a.attr("a_id"),!0),westerb_sal.xhr_del_all.send(null));return!1}, writable:!1,enumerable:!0,configurable:!0},del_album:{value:function(a,b){westerb_sal.request_done=!1;1==westerb_sal.perms?westerb_sal.visualize_all_photos_or_album_deletion(a,b):(westerb_sal.xhr_del_all.open("get",westerb_sal.HOME+"ajax/misc_calls.php?da_id="+a.attr("a_id"),!0),westerb_sal.xhr_del_all.send(null));return!1},writable:!1,enumerable:!0,configurable:!0},visualize_all_comments_deletion:{value:function(a){var b=[],c=0,d=null;a.parent("p").parent("div").children(".comments").children("div").each(function(){b.push($(this))}); c=b.length-1;(function f(){d=b[c];d.slideUp(300,function(){d.remove()});c--;0<=c&&(window.setTimeout(function(){a.parent("p").children("span:first").text(c+(1===c?" comment":" comments"))},300),window.setTimeout(f,310),0===c&&window.setTimeout(function(){westerb_sal.clear_p_timers();var b=a.parent("p").parent("div").parent("td").parent("tr");b.fadeOut(500,function(){westerb_sal.clear_comments(b.prev("tr").attr("p_id"));b.remove()});westerb_sal.display_tiny_msg();b.prev("tr").children(".see_close_coms").text("No comments"); window.setTimeout(function(){westerb_sal.store_set(westerb_sal.cur_pg+"_"+westerb_sal.pagination.set_group+"_s"+westerb_sal.pagination.current_set,$("table tbody").html())},550)},500))})()},writable:!1,enumerable:!0,configurable:!0},del_all_comments:{value:function(a){westerb_sal.request_done=!1;1==westerb_sal.perms?westerb_sal.visualize_all_comments_deletion(a):(a.parent("p").parent("div").parent("td").parent("tr").prev("tr").children(".see_close_coms").children("a").addClass("del_in_progress"), westerb_sal.xhr_del_all.open("get",westerb_sal.HOME+"ajax/misc_calls.php?del_pc_id="+a.parent("p").parent("div").parent("td").parent("tr").prev("tr").attr("p_id"),!0),westerb_sal.xhr_del_all.send(null));return!1},writable:!1,enumerable:!0,configurable:!0}});westerb_sal.xhr_make_cover.onreadystatechange=westerb_sal.handle_cover_change_response;westerb_sal.xhr_get_comments.onreadystatechange=westerb_sal.handle_get_comments_response;westerb_sal.xhr_add_capt.onreadystatechange=westerb_sal.handle_add_capt_response; westerb_sal.xhr_del_photo.onreadystatechange=westerb_sal.handle_del_photo_response;westerb_sal.xhr_del_com.onreadystatechange=westerb_sal.handle_del_com_response;westerb_sal.xhr_get_more_comments.onreadystatechange=westerb_sal.handle_get_more_comments_response;Object.defineProperties(Object.prototype.westerb_sal,{xhr_del_user:{value:westerb_sal.create_xhr(),writable:!0,enumerable:!0,configurable:!0},visualize_user_deletion:{value:function(){$(".clicked").slideUp(150,function(){$(this).prev("td").slideUp(150, function(){$(this).prev("td").slideUp(150,function(){$(this).prev("td").slideUp(150,function(){$(this).prev("td").slideUp(150,function(){$(this).parent("tr").slideUp(100,function(){var a=$(this).attr("u_id");$(this).remove();$("#u_count").text(parseInt($("#u_count").text())-1);a===westerb_sal.cur_u_id?(westerb_sal.display_msg("You successfully deleted yourself from The Salon","success",4E3),westerb_sal.request_done=!1,window.setTimeout(function(){window.location=".."},4300)):westerb_sal.display_msg("The user was successfully deleted", "success",4E3)})})})})})})},writable:!0,enumerable:!0,configurable:!0},handle_del_user_response:{value:function(){if(4===westerb_sal.xhr_del_user.readyState)if(westerb_sal.clear_p_timers(),200===westerb_sal.xhr_del_user.status)1!=westerb_sal.perms&&westerb_sal.clear_main_page_state(),westerb_sal.visualize_user_deletion();else{var a=$(".clicked");a.css("font-size","13px").html("<a href='delete_user.php?u_id="+a.parent("tr").attr("u_id")+"' class='scriptable_table_link user_delete'>Delete user</a>"); westerb_sal.display_msg("Failure: "+westerb_sal.xhr_del_user.status)}},writable:!0,enumerable:!0,configurable:!0},del_user:{value:function(a){westerb_sal.blocking_dialog?westerb_sal.scroll_to_dialog():westerb_sal.request_done?(westerb_sal.request_done=!1,$(".clicked").removeClass("clicked"),$(this).parent("td").addClass("clicked"),$(this).parent("td").css("font-size","12px").get(0).processing_msg(),1==westerb_sal.perms?window.setTimeout(westerb_sal.visualize_user_deletion,2E3):(westerb_sal.xhr_del_user.open("get", westerb_sal.HOME+"ajax/misc_calls.php?du_id="+$(".clicked").parent("tr").attr("u_id"),!0),westerb_sal.xhr_del_user.send(null))):westerb_sal.please_wait_msg(a);return!1},writable:!0,enumerable:!0,configurable:!0}});westerb_sal.xhr_del_user.onreadystatechange=westerb_sal.handle_del_user_response;Object.defineProperties(Object.prototype.westerb_sal,{xhr_clear_log:{value:westerb_sal.create_xhr(),writable:!0,enumerable:!0,configurable:!0},visualize_log_clearing:{value:function(){var a=$(".clicked"),b= $("tr.log_entry").toArray(),c=null;entry_count=b.length;i=entry_count-1;linear_increment=Math.ceil(400/entry_count);percent_increment=Math.ceil(100/entry_count);p_wrapper=$("#progress_wrapper");p_percent=$("#upload_progress_percent");slideup_duration=15>=entry_count?50:20;a.get(0).processing_msg("Clearing logs");p_wrapper.css("width","0px").show();p_percent.css("left","4px").show().text("0%");(function e(){c=$(b[i]);c.children("td:last").slideUp(slideup_duration,function(){$(this).prev("td").slideUp(slideup_duration, function(){$(this).prev("td").slideUp(slideup_duration,function(){$(this).prev("td").slideUp(slideup_duration,function(){$(this).parent("tr").slideUp(slideup_duration,function(){$(this).remove();p_wrapper.width(function(a,b){return 400<parseInt(b)+linear_increment?400:parseInt(b)+linear_increment});p_percent.css("left",function(a,b){return 404<parseInt(b)+linear_increment?404:parseInt(b)+linear_increment});100<parseInt(p_percent.text())+percent_increment?p_percent.text("100%"):p_percent.text(parseInt(p_percent.text())+ percent_increment+"%")})})})})});--i;0<i&&window.setTimeout(e,5*slideup_duration);0===i&&(e(),window.setTimeout(function(){westerb_sal.clear_p_timers();a.html("<a id='clear_logs' href='"+westerb_sal.HOME+"admin/logfile.php?clear=true' class='scriptable_gen_link'>Clear log file</a>");var b=new Date;$("tbody").append(1==westerb_sal.perms?"<tr style='display: none; ' class='log_entry'><td>Clear logs simulation</td><td>Welcomed Guest</td><td>"+((10>b.getDate()?"0":"")+b.getDate()+"-"+((9>b.getMonth()? "0":"")+(b.getMonth()+1))+"-"+b.getFullYear())+"</td><td>"+((10>b.getHours()?"0":"")+b.getHours()+":"+((10>b.getMinutes()?"0":"")+b.getMinutes())+":"+((10>b.getSeconds()?"0":"")+b.getSeconds()))+"</td></tr>":$.trim(westerb_sal.xhr_clear_log.responseText));$("tr.log_entry").fadeIn(1500);p_percent.fadeOut(1500);p_wrapper.fadeOut(1500,function(){westerb_sal.display_msg("Logs successfully cleared","success",4E3)})},5*slideup_duration))})()},writable:!0,enumerable:!0,configurable:!0},handle_clear_log_response:{value:function(){4=== westerb_sal.xhr_clear_log.readyState&&(westerb_sal.clear_p_timers(),200===westerb_sal.xhr_clear_log.status?(westerb_sal.clear_main_page_state(),westerb_sal.visualize_log_clearing()):($(".clicked").html("<a id='clear_logs' href='"+westerb_sal.HOME+"admin/logfile.php?clear=true' class='scriptable_gen_link'>Clear log file</a>"),westerb_sal.display_msg("Failure: "+westerb_sal.xhr_clear_log.status)))},writable:!0,enumerable:!0,configurable:!0},clear_logs:{value:function(a){westerb_sal.blocking_dialog? westerb_sal.scroll_to_dialog():westerb_sal.request_done?1===$("tr.log_entry").size()?westerb_sal.display_msg("There is nothing to clear at the moment","notice",4E3):(westerb_sal.request_done=!1,$(".clicked").removeClass("clicked"),$(this).parent("span").addClass("clicked"),$(this).parent("span").get(0).processing_msg("Please wait"),1==westerb_sal.perms?(window.setTimeout(function(){westerb_sal.clear_p_timers();westerb_sal.visualize_log_clearing()},2E3),westerb_sal.log_action("Clear logs simulation"), westerb_sal.clear_main_page_state()):(westerb_sal.xhr_clear_log.open("get",westerb_sal.HOME+"ajax/misc_calls.php?clearlogs",!0),westerb_sal.xhr_clear_log.send(null))):westerb_sal.please_wait_msg(a);return!1},writable:!0,enumerable:!0,configurable:!0}});westerb_sal.xhr_clear_log.onreadystatechange=westerb_sal.handle_clear_log_response;window.location.hash="";$(window).resize(function(){$("#outer_wrapper").hasClass("selected_photo_wrapper")&&westerb_sal.readjust_gallery_elems()});$(window).resize(function(){$("#outer_wrapper").hasClass("selected_photo_wrapper")|| westerb_sal.readjust_general_public_elems()});$("body").on("mouseenter","#gallery_thumbs_wrapper",westerb_sal.stop_thumbs_wrapper_scroll);$("body").on("mouseenter","#gallery_thumbs_wrapper",westerb_sal.scroll_thumbs_wrapper);$("body").on("mouseleave","#gallery_thumbs_wrapper",westerb_sal.stop_thumbs_wrapper_scroll);$("body").on("mouseenter",".hover_trigger",function(){$(this).children(".hover_triggered").fadeIn(10);$(this).children("a").children(".hover_triggered").fadeIn(10)});$("body").on("mouseleave", ".hover_trigger",function(){$(this).children(".hover_triggered").fadeOut(5);$(this).children("a").children(".hover_triggered").fadeOut(5)});$("body").on("click",".scriptable_gen_nav_link.prev_set",westerb_sal.get_previous_set);$("body").on("click",".scriptable_gen_nav_link.next_set, .scriptable_gen_link.gallery_thumb_link",westerb_sal.get_next_set);$("body").on("click",".scriptable_gen_nav_link.prev_set, .scriptable_gen_nav_link.next_set",function(){"list_photos"===westerb_sal.cur_pg&&1==westerb_sal.perms&& westerb_sal.restore_pre_simulation_state()});$("body").on("click",".scriptable_header_link",function(a){westerb_sal.blocking_dialog?(a.stopImmediatePropagation(),a.preventDefault(),westerb_sal.scroll_to_dialog()):westerb_sal.request_done||(a.stopImmediatePropagation(),a.preventDefault(),westerb_sal.please_wait_msg(a))});$("body").on("click",".scriptable_hash_changer",westerb_sal.get_hash_changer_requested_content);$("body").on("click",".fullscreen_closer",westerb_sal.exit_full_screen_mode);$("body").on("click", ".scriptable_prev_state_restorer",westerb_sal.restore_prev_state);$("body").on("click",".public_albums_nav_link",westerb_sal.switch_owner);$("body").bind("class1_removal",{class_number:1},westerb_sal.remove_hash_removed_elems).bind("class2_removal",{class_number:2},westerb_sal.remove_hash_removed_elems).bind("class3_removal",{class_number:3},westerb_sal.remove_hash_removed_elems).bind("class4_removal",{class_number:4},westerb_sal.remove_hash_removed_elems);$(window).bind("hashchange",westerb_sal.handle_hash_change); westerb_sal.dev_mode?window.onerror=function(a,b,c){alert("Error: "+a+"\n\nURL: "+b+"\n\nLine number: "+c);return!1}:$(document).contextmenu(function(a){a.preventDefault()});$("body").on("click",".to_album",westerb_sal.get_album_for_display);$("body").on("click",".to_album",westerb_sal.full_screen_mode);$("body").on("click",".preview_photo, .a_photo",westerb_sal.get_photo_for_display);$("body").on("click",".preview_photo, .a_photo",westerb_sal.full_screen_mode);$("body").on("mouseenter",".show_prevs", function(){var a=$(this).siblings("div.album_preview").attr("count");$(this).parent("div.album").children("div.album_preview").css("display","inline-block");$(this).parent("div.album").children("div.album_preview").animate({width:0==a?122:$("#outer_wrapper").innerWidth()/5.68},100,"linear")});$("body").on("mouseleave",".show_prevs",function(){0==$(this).siblings("div.album_preview").attr("count")&&$(this).parent("div.album").children("div.album_preview").animate({width:0},100,"linear",function(){$(this).css("display", "none")})});$("body").on("mouseleave",".album",function(){0!=$(this).children("div.album_preview").attr("count")&&$(this).children("div.album_preview").animate({width:0},100,"linear",function(){$(this).css("display","none")})});$("body").on("click",".scriptable_gen_link.edit_a_name",westerb_sal.a_name_edit_mode);$("body").on("click",".scriptable_gen_link.notes",westerb_sal.add_notes);$("body").on("click",".scriptable_gen_link.photo_upload",westerb_sal.upload_photo_by_modal);$("body").on("click",".scriptable_gen_link.confirm_del", westerb_sal.confirm_del);$("body").on("click","a.new_album_modal",function(a){westerb_sal.blocking_dialog?westerb_sal.scroll_to_dialog():westerb_sal.request_done?westerb_sal.modal_dialog(a,$(this),westerb_sal.HOME+"ajax/misc_calls.php?new_album_modal"):westerb_sal.please_wait_msg(a);return!1});$("body").on("click",".save_a_name_edit",function(a){if(westerb_sal.request_done)if(westerb_sal.blocking_dialog)westerb_sal.scroll_to_dialog();else if($.trim($(this).data("unedited_a_name"))===$.trim($(this).siblings("input.mini_form_edit_field").val()))2== westerb_sal.perms?westerb_sal.display_msg("You did not make any changes. Nothing to update","notice",2500):westerb_sal.display_albums_section_msg($(this).parents("div.albums_by").attr("id"),"You did not make any changes. Nothing to update","notice",2500);else if(1==westerb_sal.perms)westerb_sal.display_albums_section_msg($(this).parents("div.albums_by").attr("id"),"As a guest, you do not have sufficient privileges to edit album names","notice",3E3);else{westerb_sal.request_done=!1;var b=$(this).parents("div.album"), c=$(this).parents("div.albums_by").attr("id");b.append("<div id='temp_a_processing_msg' style='position: absolute; top: 118px; left: 83px; '></div>");$("#temp_a_processing_msg").get(0).processing_msg();$.post(westerb_sal.HOME+"ajax/misc_calls.php?enma_id="+b.attr("a_id"),{a_name:$(this).siblings("input.mini_form_edit_field").val()}).success(function(a,e,f){westerb_sal.clear_p_timers();$("#temp_a_processing_msg").remove();content="<span class='name'>";content+=a+"</span>";content+="<a href='list_albums.php?o_id="; content+=b.attr("name")+"&enma_id=";content+=b.attr("a_id");content+="' class='edit edit_a_name scriptable_gen_link' title='Edit album name'></a>";$(".album[a_id="+b.attr("a_id")+"]").each(function(){$(this).find("a.cancel_name_edit").unbind("click");$(this).find("div.name_edit_save").html(content)});westerb_sal.clear_albums("a");westerb_sal.clear_albums(b.attr("o_id"));westerb_sal.clear_main_page_state("#list_albums");westerb_sal.clear_main_page_state("#photo_upload");westerb_sal.clear_main_page_state("#list_photos_"+ b.attr("a_id"));2==westerb_sal.perms?westerb_sal.display_msg("The album name was successfully updated","success",2500):westerb_sal.display_albums_section_msg(c,"The album name was successfully updated","success",2500)}).error(function(a,b){westerb_sal.clear_p_timers();$("#temp_a_processing_msg").remove();"timeout"===b?(2==westerb_sal.perms?westerb_sal.display_msg("The request is taking too long. Please refresh the page and try again","notice",3E3):westerb_sal.display_albums_section_msg(c,"The request is taking too long. Please refresh the page and try again", "notice",3E3),westerb_sal.request_done=!0):"error"===b&&(2==westerb_sal.perms?westerb_sal.display_msg("Something went wrong while updating the name. Refresh the page and try again."):westerb_sal.display_albums_section_msg(c))})}else westerb_sal.please_wait_msg(a);return!1});$("body").on("keyup",".mini_form_edit_field",function(a){a=$(this).parents("form.mini_form").find("span.char_counter");var b=$(this).val().length,c=parseInt($(this).attr("maxlength"),10);b>c&&($(this).val($(this).val().substring(0, c)),b=c);a.text(c-b)});$("body").on("click",".scriptable_table_link.change_cover",westerb_sal.make_cover);$("body").on("click",".scriptable_table_link.display_comments",westerb_sal.see_comments);$("body").on("click",".scriptable_table_link.hide_comments",westerb_sal.close_comments);$("body").on("click",".scriptable_table_link.edit_caption, .scriptable_table_link.delete_cap",westerb_sal.update_capt_changes);$("body").on("click",".scriptable_table_link.show_capt_input",westerb_sal.show_add_capt_input); $("body").on("click",".scriptable_table_link.photo_delete",westerb_sal.del_photo);$("body").on("click",".scriptable_table_link.user_delete",westerb_sal.del_user);$("body").on("click",".scriptable_gen_link#clear_logs",westerb_sal.clear_logs)});