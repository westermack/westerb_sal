$(function(){Object.defineProperty(Object.prototype.westerb_sal,"is_modal_call",{value:!1,writable:!0,enumerable:!0,configurable:!0});Object.defineProperty(Object.prototype.westerb_sal,"onprogress_fired",{value:!1,writable:!0,enumerable:!0,configurable:!0});Object.defineProperty(Object.prototype.westerb_sal,"photo_validation_sentinel",{value:0,writable:!0,enumerable:!0,configurable:!0});Object.defineProperty(Object.prototype.westerb_sal,"xhr_check_u_name",{value:westerb_sal.create_xhr(),writable:!0, enumerable:!0,configurable:!0});Object.defineProperty(Object.prototype.westerb_sal,"handle_check_u_name_response",{value:function(){var a=westerb_sal.form.validate_on_sub.new_username;4===westerb_sal.xhr_check_u_name.readyState&&(westerb_sal.clear_p_timers(),200===westerb_sal.xhr_check_u_name.status?0==westerb_sal.xhr_check_u_name.responseText?(a.removeClass("error_bordered"),$("#"+a.attr("name")).removeClass("error_msg char_counter").addClass("success_msg").text("Username available"),westerb_sal.form.remove_field_err_rec(a)): 1==westerb_sal.xhr_check_u_name.responseText&&(window.clearInterval(westerb_sal.form.update_counter_timer),a.addClass("error_bordered"),$("#"+a.attr("name")).removeClass("char_counter success_msg").addClass("error_msg").text('Sorry, "'+a.val()+'" is already taken. Please provide another one'),westerb_sal.form.record_errored_field(a)):(westerb_sal.display_msg("Something went wrong while trying to validate the username. But feel free to proceed","notice",5700),$("#"+a.attr("name")).removeClass("error_msg success_msg").addClass("char_counter").text(parseInt(a.attr("maxlength"))- a.val().length),westerb_sal.form.remove_field_err_rec(a)),westerb_sal.form.xhr_in_progress=!1)},writable:!0,enumerable:!0,configurable:!0});westerb_sal.xhr_check_u_name.onreadystatechange=westerb_sal.handle_check_u_name_response;Object.defineProperty(Object.prototype.westerb_sal,"update_photo_upload_onscreen_info",{value:function(a){var c=westerb_sal.onprogress_fired?1200:0,d=decodeURIComponent("undefined"===typeof FormData?a:westerb_sal.form.xhr_submit_data.responseText);if(westerb_sal.modal_caller_parent.hasClass("album"))$(".album[a_id="+ westerb_sal.modal_caller_parent.attr("a_id")+"]").each(function(){var e=parseInt($(this).children("div.date_owner").children("div:last").text());$(this).children("div.date_owner").children("div:last").text(e+1+(0===e?" photo":" photos"));0===e&&$(this).children("img").wrap("<a class='scriptable_hash_changer' id='to_list_photos_"+$(this).attr("a_id")+"' href='list_photos.php?a_id="+$(this).attr("a_id")+"'></a>");window.setTimeout(function(){$(".album[a_id="+westerb_sal.modal_caller_parent.attr("a_id")+ "]").children("a").children("img").attr("src",westerb_sal.HOME+westerb_sal.modal_caller_parent.parents("div#albums_wrapper").attr("albums_upload_dir")+"/"+westerb_sal.modal_caller_parent.attr("a_id")+"/"+westerb_sal.modal_caller_parent.data("uploaded_f_name"))},c)}),c=westerb_sal.onprogress_fired?7200:6E3,window.setTimeout(function(){1==westerb_sal.perms&&$.get(westerb_sal.HOME+"ajax/misc_calls.php",{delete_just_uploaded_photo:d})},c),westerb_sal.clear_sets("list_photos");else if(westerb_sal.modal_caller_parent.hasClass("new_photo")){var e= $("tr.photo_row").size(),b=parseInt($("#u_count").text());window.setTimeout(function(){$("#u_count").text(b+1);0===b?$("#plural_s").text(""):$("#plural_s").text("s");4>=e&&(""!==$("#ajax_loading_pholder").text()&&($("#ajax_loading_pholder").text(""),$("tr.photo_row").remove(),e=0),0===b?($("#no_photos_alert").replaceWith("<table class='bordered'><thead style='display: none; '><tr id='thead'><th>Photo</th><th>Original Filename</th><th>Size</th><th>Type</th><th>Caption</th><th colspan='' id='ajax_msg' class=''></th></tr></thead><tbody remaining_u_count=''></tbody></thead>"), $("thead").fadeIn(400),$("span.new_photo").after("<span style='display: none; ' class='link_separator'> | </span><span style='display: none; ' a_id='"+westerb_sal.modal_caller_parent.attr("a_id")+"' class='del_confirm_parent del_album'><a id='del_album' href='confirm_deletion.php?da_id="+westerb_sal.modal_caller_parent.attr("a_id")+"' class='scriptable_gen_link confirm_del'>Delete album</a></span>"),$("span.link_separator:last").fadeIn(400),$("span.del_album").fadeIn(400)):1===e&&4>b&&($("span.new_photo").after("<span id='temp_id' style='display: none; ' class='link_separator'>| </span><span a_id='"+ westerb_sal.modal_caller_parent.attr("a_id")+"' class='del_confirm_parent del_all_photos'><a id='del_all' href='confirm_deletion.php?a_id="+westerb_sal.modal_caller_parent.attr("a_id")+"' class='scriptable_gen_link confirm_del'>Delete all photos</a></span>"),$("span.link_separator#temp_id").fadeIn(400).removeAttr("id"),$("span.del_all_photos").fadeIn(400)),4===e&&4===b?($("#nav").remove(),$("#photos_nav_wrapper").append("<div style='display: none; ' id='nav' class='hash_change_removed_3 slided'><a href='#' class='scriptable_gen_nav_link prev_set'><div class='ui_button nav_opt inactive' id='prev'>&#x2227;</div></a><a href='list_photos.php?a_id="+ westerb_sal.modal_caller_parent.attr("a_id")+"&c_set=2' class='scriptable_gen_nav_link next_set'><div class='ui_button nav_opt' id='next'>&#x2228;</div></a></div>"),$("#ux_nav_guide").text(westerb_sal.pagination.ux_nav_guide()),$("#ux_nav_guide, #nav").fadeIn(400)):4>e&&($("tbody").append(d),$("tr.photo_row:last").fadeIn(400,function(){$(this).children("#temp_id_1").removeAttr("id");$("#temp_id_1_1").removeAttr("id").bind("keyup",{max_len:4E3},westerb_sal.count);$("#temp_id_1_2").removeAttr("id").bind("click", {c_parent:$(this).parent("div.capt_edit").parent("form").parent("td")},westerb_sal.add_capt);$("#temp_id_1_3").removeAttr("id");$(this).children("#temp_id_2").removeAttr("id");$(this).children("#temp_id_3").removeAttr("id")})),1==westerb_sal.perms&&4===e&&$("tbody").append(d),1==westerb_sal.perms&&($.get(westerb_sal.HOME+"ajax/misc_calls.php",{delete_just_uploaded_photo:$("tr.photo_row:last").attr("p_id")}),4===e&&$("tr.photo_row:last").remove()),1==westerb_sal.modal_caller_parent.data("chosen_as_cover")&& ($("#current_cover").html("<a style='display: none; ' href='list_photos.php?a_id="+westerb_sal.modal_caller_parent.attr("a_id")+"&mkcover="+$("tr.photo_row:last").attr("p_id")+"' class='scriptable_table_link change_cover'>Make cover photo</a>"),$("#current_cover").children("a").fadeIn(400,function(){$(this).parent("#current_cover").removeAttr("id")}),$("#current_cover_just_chosen").children("span").fadeIn(450,function(){$(this).parent("#current_cover_just_chosen").attr("id","current_cover").html("Current album cover")}))); 4<b&&($("#ux_nav_guide").text(westerb_sal.pagination.ux_nav_guide()),westerb_sal.pagination.adjust_prev_and_next(),westerb_sal.clear_sets())},c)}},writable:!0,enumerable:!0,configurable:!0});Object.defineProperty(Object.prototype.westerb_sal,"close_box",{value:function(){westerb_sal.blocking_login_dialog?$("#login_prompt_dialog").parent("div").fadeOut(200,function(){$(this).remove();westerb_sal.blocking_login_dialog=!1}):($("#modal_dialog").parent("div").fadeOut(200,function(){$(this).remove()}), $("a").unbind("click",westerb_sal.highlight_dialog),$("div").not("div.blocking_dialog").unbind("click",westerb_sal.scroll_to_dialog),$("div").not("div.blocking_dialog").unbind("click",westerb_sal.highlight_dialog));setTimeout(function(){westerb_sal.blocking_dialog=westerb_sal.animating=!1},210);$(document).unbind("scroll",westerb_sal.reposition_modal_box);$(window).unbind("resize",westerb_sal.reposition_modal_box)},writable:!0,enumerable:!0,configurable:!0});Object.defineProperty(Object.prototype.westerb_sal, "handle_modal_submit_data_response",{value:function(a){a=westerb_sal.onprogress_fired?1200:0;if(4===westerb_sal.form.xhr_submit_data.readyState)if(westerb_sal.clear_p_timers(),$("#modal_processing_msg").html(""),$.each(westerb_sal.form.fields,function(e,a){a.removeAttr("disabled")}),200===westerb_sal.form.xhr_submit_data.status){var c=$.trim(westerb_sal.form.xhr_submit_data.responseText);if(/Error:/.test(c))c=c.replace("Error:",""),"new_photo_upload"===westerb_sal.submit_form_data.request&&55<c.length? window.setTimeout(function(){$("#"+westerb_sal.form.fields.photo.attr("name")).removeClass("success_msg notice_msg").addClass("error_msg").text(c);westerb_sal.form.xhr_in_progress=!1},a):westerb_sal.display_modal_msg(c);else{if("new_photo_upload"===westerb_sal.submit_form_data.request)westerb_sal.update_photo_upload_onscreen_info(),westerb_sal.clear_main_page_state("#list_photos_"+(westerb_sal.modal_caller_parent.hasClass("album"),westerb_sal.modal_caller_parent.attr("a_id")));else if("new_album_creation"=== westerb_sal.submit_form_data.request){if(westerb_sal.opened_album_groups&&0!=westerb_sal.opened_album_groups.opened_count)for(opened_group in westerb_sal.opened_album_groups.opened){if("a"===opened_group||opened_group===westerb_sal.modal_caller_parent.attr("cur_user_id")||1==westerb_sal.perms&&opened_group===westerb_sal.modal_caller_parent.attr("original_user_id")){var d=westerb_sal.opened_album_groups.opened[opened_group],e=d.siblings("div.albums").children("div.inner_a_wrapper").children("p").children("span:first"); 1===parseInt(e.text())&&d.siblings("div.albums").children("div.inner_a_wrapper").children("p").append("<span class='del_albums_parent'><a href='delete_album.php?ao_id="+d.parent("div.albums_by").attr("id")+"' class='scriptable_gen_link del_all_albums confirm_del'>Delete all albums</a></span>");if(8===parseInt(e.text())){westerb_sal.s_pag_instances["o_id_"+d.parent("div.albums_by").attr("id")]=new westerb_sal.Scroll_Pagination;d.siblings("div.albums").bind("scroll",{s_pagination:westerb_sal.s_pag_instances["o_id_"+ d.parent("div.albums_by").attr("id")]},westerb_sal.load_more_albums);var b=function(e){westerb_sal.blocking_dialog||window.setTimeout(function(){westerb_sal.request_done&&(delete westerb_sal.s_pag_instances[e.data.s_pag_instance_id],e.data.this_o_name_div.siblings("div.albums").html(""),e.data.this_o_name_div.unbind("click",b))},820)};d.bind("click",{s_pag_instance_id:"o_id_"+d.parent("div.albums_by").attr("id"),this_o_name_div:d},b)}if(0!==d.siblings("div.albums").children("div.inner_a_wrapper").children("div.album").size()% 8){d.siblings("div.albums").children("div.inner_a_wrapper").append(c);var f=d.siblings("div.albums").children("div.inner_a_wrapper").children("div.album:last");"a"===opened_group?(f.attr("name","a"),f.children("div.date_owner").children("div:first").after("By "+f.children("div#data").attr("a_owner_name"))):(f.attr("name",f.children("div#data").attr("a_owner_id")),f.children("img").attr("src",westerb_sal.HOME+"images/placeholders/"+westerb_sal.rand()+".png"));f.children("div#data").remove();f.fadeIn(500)}d.attr("u_count", parseInt(d.attr("u_count"))+1);e.text(parseInt(e.text())+1+" albums")}}else westerb_sal.opened_album_groups&&0==westerb_sal.opened_album_groups.opened_count&&($("div.albums_by[id=a]").children("div.o_name").attr("u_count",parseInt($("div.albums_by[id=a]").children("div.o_name").attr("u_count"))+1),$("div.albums_by[id="+westerb_sal.modal_caller_parent.attr("cur_user_id")+"]").children("div.o_name").attr("u_count",parseInt($("div.albums_by[id="+westerb_sal.modal_caller_parent.attr("cur_user_id")+"]").children("div.o_name").attr("u_count"))+ 1));westerb_sal.clear_main_page_state("#photo_upload")}else"login"===westerb_sal.submit_form_data.request&&(westerb_sal.is_logged_in=!0,westerb_sal.clear_main_page_state("#public_index"));window.setTimeout(function(){westerb_sal.close_box();"login"!==westerb_sal.submit_form_data.request&&westerb_sal.display_msg("new_photo_upload"===westerb_sal.submit_form_data.request?"Photo uploaded successfully":"Album successfully created","success",4E3)},a);"login"!==westerb_sal.submit_form_data.request&&(westerb_sal.clear_albums("a"), westerb_sal.clear_albums(westerb_sal.modal_caller_parent.hasClass("album")?westerb_sal.modal_caller_parent.attr("o_id"):westerb_sal.modal_caller_parent.hasClass("new_photo")?$("#photos_wrapper").attr("ao_id"):westerb_sal.modal_caller_parent.attr("cur_user_id")),westerb_sal.clear_main_page_state("#list_albums"),westerb_sal.clear_main_page_state("#logfile"))}}else westerb_sal.display_modal_msg(),westerb_sal.form.xhr_in_progress=!1},writable:!0,enumerable:!0,configurable:!0});Object.defineProperty(Object.prototype.westerb_sal, "handle_submit_data_response",{value:function(a){a=westerb_sal.onprogress_fired?1200:0;if(4===westerb_sal.form.xhr_submit_data.readyState){westerb_sal.clear_p_timers();$("#processing_msg").html("");"public_index"!==westerb_sal.cur_pg&&$.each(westerb_sal.form.fields,function(e,a){a.removeAttr("disabled");/Error:/.test(c)||200!==westerb_sal.form.xhr_submit_data.status||"first_name"!==a.attr("name")&&"last_name"!==a.attr("name")&&"new_username"!==a.attr("name")&&"new_password"!==a.attr("name")&&"caption"!== a.attr("name")&&"albumname"!==a.attr("name")&&"notes"!==a.attr("name")||(a.css({color:"#777","font-weight":"bold"}).val($("#for_"+a.attr("name")).text()),$("#"+a.attr("name")).removeClass("success_msg notice_msg error_msg").addClass("char_counter").text(a.attr("maxlength")))});if(200===westerb_sal.form.xhr_submit_data.status){var c=$.trim(westerb_sal.form.xhr_submit_data.responseText);if(/Error:/.test(c))window.setTimeout(function(){westerb_sal.display_msg(c.replace("Error:",""));"new_photo_upload"=== westerb_sal.submit_form_data.request&&$("#"+westerb_sal.form.fields.photo.attr("name")).removeClass("success_msg notice_msg error_msg").text("")},a);else if(/Info:/.test(c))window.setTimeout(function(){westerb_sal.display_msg(c.replace("Info:",""),"info",8500);$("#"+westerb_sal.form.fields.photo.attr("name")).removeClass("success_msg notice_msg error_msg").text("")},a),westerb_sal.form.fields.album_id.css({color:"#777","font-weight":"bold"}).val("0"),$("form input:checked").removeAttr("checked"), $("ul.radios").addClass("none_checked");else if("new_photo_upload"===westerb_sal.submit_form_data.request||"new_album_creation"===westerb_sal.submit_form_data.request||"add_user"===westerb_sal.submit_form_data.request)"new_photo_upload"===westerb_sal.submit_form_data.request?(window.setTimeout(function(){$("#"+westerb_sal.form.fields.photo.attr("name")).removeClass("success_msg notice_msg error_msg").text("")},a),westerb_sal.clear_main_page_state("#list_photos_"+westerb_sal.form.fields.album_id.val()), westerb_sal.form.fields.album_id.css({color:"#777","font-weight":"bold"}).val("0"),$("form input:checked").removeAttr("checked"),$("ul.radios").addClass("none_checked")):"add_user"===westerb_sal.submit_form_data.request&&($("form input:checked").removeAttr("checked"),$("ul.radios").addClass("none_checked"),$("p.non_guest:first").removeClass("hash_change_removed_3 slided").slideUp(300,function(){$("p.non_guest:last").removeClass("hash_change_removed_3 slided").slideUp(400)}),$("p.non_guest").children("input").each(function(){delete westerb_sal.form.validate_on_sub[$(this).attr("name")]}), 1!=westerb_sal.perms&&westerb_sal.clear_main_page_state("#list_users")),$("#main a:first").text("<< Back home"),window.setTimeout(function(){westerb_sal.display_msg("new_photo_upload"===westerb_sal.submit_form_data.request?"Photo uploaded successfully":"new_album_creation"===westerb_sal.submit_form_data.request?"Album successfully created":c,"success",4E3)},a),"new_album_creation"===westerb_sal.submit_form_data.request&&1!=westerb_sal.perms&&westerb_sal.clear_main_page_state("#photo_upload"),"new_photo_upload"!== westerb_sal.submit_form_data.request&&"new_album_creation"!==westerb_sal.submit_form_data.request||3!=westerb_sal.perms||(westerb_sal.clear_albums("a"),westerb_sal.clear_albums(westerb_sal.cur_u_id),westerb_sal.clear_main_page_state("#list_albums"),"new_photo_upload"===westerb_sal.submit_form_data.request&&westerb_sal.clear_sets("list_photos")),westerb_sal.clear_main_page_state("#logfile");else if("login"===westerb_sal.submit_form_data.request)$("#login").addClass("login_success").trigger("click"), westerb_sal.is_logged_in=!0,westerb_sal.clear_main_page_state("#public_index"),westerb_sal.check_login_timer=window.setInterval(westerb_sal.check_login,6E3);else if("post_comment"===westerb_sal.submit_form_data.request){a=$.trim(westerb_sal.form.fields.author.val());$.each(westerb_sal.form.fields,function(a,e){"submit"===a&&e.attr("disabled","disabled");if("author"===e.attr("name")||"comment"===e.attr("name"))e.css({color:"#444","font-weight":"bold"}).val($("#for_"+e.attr("name")).text()),$("#"+e.attr("name")).removeClass("success_msg notice_msg error_msg").addClass("char_counter").text(e.attr("maxlength"))}); var d=$("#c_count").children("span"),e=parseInt(d.text()),b=8>e?410:0;d.text(e+1+(0===e?" comment":" comments"));$("#unit_wrapper img").addClass("comments_locked");8>e?(0===e?$("#comments").html($.trim(westerb_sal.form.xhr_submit_data.responseText)):$("#comments").append($.trim(westerb_sal.form.xhr_submit_data.responseText)),$("#loaded_info").scrollTop($("#loaded_info").prop("scrollHeight")-Math.ceil($("#loaded_info").innerHeight())),$(".comment:last").fadeIn(400,function(){westerb_sal.store_set(westerb_sal.cur_pg+ "_"+westerb_sal.pagination.set_group+"_s"+westerb_sal.pagination.current_set,$("#unit_wrapper").html()+"<div id='loaded_info' cur_set='"+$("#loaded_info").attr("cur_set")+"'>"+$("#loaded_info").html()+"</div>")})):(westerb_sal.store_set(westerb_sal.cur_pg+"_"+westerb_sal.pagination.set_group+"_s"+westerb_sal.pagination.current_set,$("#unit_wrapper").html()+"<div id='loaded_info' cur_set='"+$("#loaded_info").attr("cur_set")+"'>"+$("#loaded_info").html()+"</div>"),8===u_count&&$("#loaded_info").scroll(westerb_sal.load_more_public_comments)); setTimeout(function(){westerb_sal.store_outer_wrapper_state("photo_wrapper_pa_id_"+$("#unit_wrapper").attr("pa_id")+"_s_"+westerb_sal.pagination.current_set,$(".centering:last").html())},b);westerb_sal.display_dialog_msg("Thank you for your comment"+("Your name"===a?"":", "+a)+"! The form for this photo has now been locked to discourage spamming","success")}}else"post_comment"===westerb_sal.submit_form_data.request?westerb_sal.display_dialog_msg():westerb_sal.display_msg("Failure: "+westerb_sal.form.xhr_submit_data.status), "public_index"===westerb_sal.cur_pg&&$.each(westerb_sal.form.fields,function(e,a){a.removeAttr("disabled")}),westerb_sal.progress_events&&$(".pregress_info").fadeOut(800,function(){$("form div.file_selector").parent("div").css("width","1000px")});westerb_sal.form.xhr_in_progress=westerb_sal.progress_events&&"new_photo_upload"===westerb_sal.submit_form_data.request&&westerb_sal.onprogress_fired?!0:!1}},writable:!0,enumerable:!0,configurable:!0});Object.defineProperty(Object.prototype.westerb_sal,"submit_form_data", {value:function(){westerb_sal.submit_form_data.processing_msg=westerb_sal.submit_form_data.guest_msg=westerb_sal.submit_form_data.request=westerb_sal.submit_form_data.url="";westerb_sal.submit_form_data.p_message_pos=0;westerb_sal.is_modal_call&&$("#msg_wrapper #modal_msg").remove();westerb_sal.form.xhr_in_progress=!0;switch($("form.big_form").attr("id")){case "photo_upload":westerb_sal.submit_form_data.processing_msg="Uploading";westerb_sal.submit_form_data.p_message_pos=305;westerb_sal.submit_form_data.request= "new_photo_upload";westerb_sal.submit_form_data.url=westerb_sal.HOME+"ajax/misc_calls.php?upload_photo"+(westerb_sal.is_modal_call&&"list_photos"===westerb_sal.cur_pg?"=via_list_photos":westerb_sal.is_modal_call&&"list_albums"===westerb_sal.cur_pg?"=via_list_albums":"");break;case "create_album":westerb_sal.submit_form_data.processing_msg="Creating";westerb_sal.submit_form_data.p_message_pos=215;westerb_sal.submit_form_data.guest_msg="Everything validates OK, and if your privileges were higher than Guest's, the album would have been created"; westerb_sal.submit_form_data.request="new_album_creation";westerb_sal.submit_form_data.url=westerb_sal.HOME+"ajax/misc_calls.php?create_album"+(westerb_sal.is_modal_call?"=via_modal":"");break;case "login_form":westerb_sal.submit_form_data.processing_msg="Logging in";westerb_sal.submit_form_data.p_message_pos=8;westerb_sal.submit_form_data.request="login";westerb_sal.submit_form_data.url=westerb_sal.HOME+"ajax/misc_calls.php?login";break;case "add_user":westerb_sal.submit_form_data.processing_msg= "Adding user";westerb_sal.submit_form_data.guest_msg="Everything validates OK, and if your privileges were higher than Guest's, the user would have been added";westerb_sal.submit_form_data.request="add_user";westerb_sal.submit_form_data.url=westerb_sal.HOME+"ajax/misc_calls.php?add_user";break;case "post_comment":westerb_sal.submit_form_data.processing_msg="Posting",westerb_sal.submit_form_data.request="post_comment",westerb_sal.submit_form_data.url=westerb_sal.HOME+"ajax/misc_calls.php?post_comment="+ $("form.big_form").attr("p_id")}westerb_sal.is_modal_call?$("#modal_processing_msg").css("top",westerb_sal.submit_form_data.p_message_pos+"px").get(0).processing_msg(westerb_sal.submit_form_data.processing_msg):$("#processing_msg").get(0).processing_msg(westerb_sal.submit_form_data.processing_msg);if("new_album_creation"===westerb_sal.submit_form_data.request&&1==westerb_sal.perms)$.each(westerb_sal.form.fields,function(e,a){"submit"!==e&&a.attr("disabled","disabled")}),westerb_sal.is_modal_call? window.setTimeout(function(){westerb_sal.clear_p_timers();westerb_sal.close_box();westerb_sal.display_msg(westerb_sal.submit_form_data.guest_msg,"info",8500)},3E3):window.setTimeout(function(){westerb_sal.clear_p_timers();$("#processing_msg").html("");westerb_sal.display_msg(westerb_sal.submit_form_data.guest_msg,"info",8500);"create_album"===westerb_sal.cur_pg&&$("#main a:first").text("<< Back home");$.each(westerb_sal.form.fields,function(e,a){a.removeAttr("disabled");if("albumname"===a.attr("name")|| "notes"===a.attr("name"))a.css({color:"#777","font-weight":"bold"}).val($("#for_"+a.attr("name")).text()),$("#"+a.attr("name")).removeClass("success_msg notice_msg error_msg").addClass("char_counter").text(a.attr("maxlength"))});westerb_sal.form.xhr_in_progress=!1},3E3);else if("add_user"===westerb_sal.submit_form_data.request&&1==westerb_sal.perms)$.each(westerb_sal.form.fields,function(a,b){"submit"!==a&&b.attr("disabled","disabled")}),window.setTimeout(function(){westerb_sal.clear_p_timers();$("#processing_msg").html(""); westerb_sal.display_msg(westerb_sal.submit_form_data.guest_msg,"info",8500);$("#main a:first").text("<< Back home");$.each(westerb_sal.form.fields,function(a,b){b.removeAttr("disabled");if("first_name"===b.attr("name")||"last_name"===b.attr("name")||"new_username"===b.attr("name")||"new_password"===b.attr("name"))b.css({color:"#777","font-weight":"bold"}).val($("#for_"+b.attr("name")).text()),$("#"+b.attr("name")).removeClass("success_msg notice_msg error_msg").addClass("char_counter").text(b.attr("maxlength"))}); $("form input:checked").removeAttr("checked");$("ul.radios").addClass("none_checked");$("p.non_guest:first").slideUp(300,function(){$("p.non_guest:last").slideUp(400)});$("p.non_guest").children("input").each(function(){delete westerb_sal.form.validate_on_sub[$(this).attr("name")]});westerb_sal.form.xhr_in_progress=!1},3E3);else{if(westerb_sal.progress_events&&"new_photo_upload"==westerb_sal.submit_form_data.request&&"undefined"!==typeof File){var a=function(a){var b=$("#selector_progress_wrapper"), c=$("#upload_progress_percent");b.width(function(b,c){return c+Math.round(400*((a.loaded-$(this).data("prev_uploaded"))/a.total))});c.css("left",function(c,d){return parseInt(d)+Math.round(400*((a.loaded-b.data("prev_uploaded"))/a.total))});c.text(Math.round(100*a.loaded/a.total)+"%");b.data("prev_uploaded",a.loaded)};westerb_sal.form.xhr_submit_data.upload.onloadstart=function(a){$("#"+westerb_sal.form.fields.photo.attr("name")).hasClass("error_msg")&&$("#"+westerb_sal.form.fields.photo.attr("name")).removeClass("success_msg notice_msg error_msg").text(""); $("#selector_progress_wrapper").data("prev_uploaded",0);$("form div.file_selector").parent("div").css("width","350px");$("#upload_progress_percent").css({left:("photo_upload"!==westerb_sal.cur_pg?364:382)+"px",top:("photo_upload"!==westerb_sal.cur_pg?25:85)+"px"}).text("0%")};westerb_sal.form.xhr_submit_data.upload.onprogress=function(e){e.lengthComputable&&($("#upload_progress_bar").is(":hidden")&&(westerb_sal.onprogress_fired=!0,$(".pregress_info").show()),a(e))};westerb_sal.form.xhr_submit_data.upload.onload= function(a){var b=$("#selector_progress_wrapper"),c=$("#upload_progress_percent"),d=$(".pregress_info"),g=100-parseInt(c.text());0!==g?(b.animate({width:"750px"},100,"linear"),c.animate({left:("photo_upload"!==westerb_sal.cur_pg?764:782)+"px"},100,"linear",function(){b.css("width","1000px");d.fadeOut(1500,function(){westerb_sal.form.xhr_in_progress=westerb_sal.onprogress_fired=!1})}),function k(){c.text(parseInt(c.text())+1+"%");100>parseInt(c.text())&&window.setTimeout(k,g/100)}()):(b.css("width", "1000px"),d.fadeOut(1500,function(){westerb_sal.form.xhr_in_progress=westerb_sal.onprogress_fired=!1}))}}westerb_sal.form.xhr_submit_data.open("post",westerb_sal.submit_form_data.url,!0);if("new_photo_upload"==westerb_sal.submit_form_data.request){if(westerb_sal.is_modal_call&&"list_albums"===westerb_sal.cur_pg)westerb_sal.modal_caller_parent.data("uploaded_f_name",westerb_sal.form.fields.photo.val().replace(/^(?:[A-Z]\:(\\|\/))([a-zA-Z]+\1)+/g,""));else if(westerb_sal.is_modal_call&&"list_photos"=== westerb_sal.cur_pg){var c=0;westerb_sal.form.cover_radios.forEach(function(a,b,d){a.is(":checked")&&(c=a.val())});westerb_sal.modal_caller_parent.data("chosen_as_cover",c)}"undefined"!==typeof FormData?westerb_sal.post_FormData(westerb_sal.form.xhr_submit_data):"undefined"===typeof File&&($("body").append("<iframe id='upload_frame' name='upload_frame' style='width: 0; height: 0; '></iframe>"),$("iframe").load(function(){westerb_sal.clear_p_timers();westerb_sal.is_modal_call?$("#modal_processing_msg").html(""): $("#processing_msg").html("");var a,b,c="";try{this.contentDocument?a=this.contentDocument.body.innerHTML:this.contentWindow?a=this.contentWindow.document.body.innerHTML:this.document&&(a=this.document.body.innerHTML),/Error:/.test(a)?($("#"+westerb_sal.form.fields.photo.attr("name")).removeClass("success_msg notice_msg error_msg").text(""),a=a.replace("Error:",""),c="error"):(/Info:/.test(a)?(a=a.replace("Info:",""),c="info"):(b=a,a="Photo uploaded successfully",c="success"),westerb_sal.is_modal_call? (westerb_sal.update_photo_upload_onscreen_info(b),westerb_sal.close_box()):("photo_upload"===westerb_sal.cur_pg&&$("#main a:first").text("<< Back home"),$("#"+westerb_sal.form.fields.photo.attr("name")).removeClass("success_msg notice_msg error_msg").text(""),westerb_sal.form.fields.caption.css({color:"#777","font-weight":"bold"}).val($("#for_"+westerb_sal.form.fields.caption.attr("name")).text()),$("#"+westerb_sal.form.fields.caption.attr("name")).removeClass("success_msg notice_msg error_msg").addClass("char_counter").text(westerb_sal.form.fields.caption.attr("maxlength")), westerb_sal.form.fields.album_id.css({color:"#777","font-weight":"bold"}).val("0"),$("form input:checked").removeAttr("checked"),$("ul.radios").addClass("none_checked")))}catch(d){}!westerb_sal.is_modal_call||"error"!==c&&""!==a?westerb_sal.display_msg(a,c,"info"===c?8500:4E3):55<a.length?$("#"+westerb_sal.form.fields.photo.attr("name")).removeClass("success_msg notice_msg").addClass("error_msg").text(a):westerb_sal.display_modal_msg(a);westerb_sal.form.xhr_in_progress=!1;$(this).unbind("load").remove()}))}else{westerb_sal.form.xhr_submit_data.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");if("new_album_creation"===westerb_sal.submit_form_data.request)westerb_sal.form.xhr_submit_data.send("albumname="+encodeURIComponent(westerb_sal.form.fields.albumname.val().replace(" ","+","g"))+"&notes="+encodeURIComponent(westerb_sal.form.fields.notes.val().replace(" ","+","gm")));else if("login"===westerb_sal.submit_form_data.request)westerb_sal.form.xhr_submit_data.send("username="+westerb_sal.form.fields.username.val()+"&password="+westerb_sal.form.fields.password.val()); else if("add_user"===westerb_sal.submit_form_data.request){var d=0;westerb_sal.form.perms_radios.forEach(function(a,b,c){a.is(":checked")&&(d=a.val())});westerb_sal.form.xhr_submit_data.send("perms="+d+"&first_name="+encodeURIComponent(westerb_sal.form.fields.first_name.val().replace(" ","+","g"))+"&last_name="+encodeURIComponent(westerb_sal.form.fields.last_name.val().replace(" ","+","g"))+"&new_username="+encodeURIComponent(westerb_sal.form.fields.new_username.val().replace(" ","+","g"))+"&new_password="+ encodeURIComponent(westerb_sal.form.fields.new_password.val().replace(" ","+","g")))}"post_comment"===westerb_sal.submit_form_data.request&&westerb_sal.form.xhr_submit_data.send("author="+encodeURIComponent(westerb_sal.form.fields.author.val().replace(" ","+","g"))+"&comment="+encodeURIComponent(westerb_sal.form.fields.comment.val().replace(" ","+","gm")))}$.each(westerb_sal.form.fields,function(a,b){"submit"!==a&&b.attr("disabled","disabled")})}},writable:!0,enumerable:!0,configurable:!0});Object.defineProperty(Object.prototype.westerb_sal, "validate_photo",{value:function(){westerb_sal.validate_photo.pattern1=/.+(\.jpe?g|png)$/;westerb_sal.validate_photo.pattern2=/.+(\.jpeg)$/;westerb_sal.validate_photo.pattern3=/.+(\.jpg|png)$/;westerb_sal.validate_photo.fstr="";""!=$("form.big_form input:file").val()&&((westerb_sal.validate_photo.fstr=$("form.big_form input:file").val().toLowerCase(),westerb_sal.validate_photo.fstr=westerb_sal.validate_photo.fstr.replace(/^(?:[a-z]\:(\\|\/))([a-zA-Z]+\1)+/g,""),westerb_sal.validate_photo.pattern1.test(westerb_sal.validate_photo.fstr)|| ""==westerb_sal.validate_photo.fstr)?westerb_sal.validate_photo.pattern2.test(westerb_sal.validate_photo.fstr)&&25<westerb_sal.validate_photo.fstr.length-5?($("form.big_form input:file").addClass("error_bordered"),$("#photo").removeClass("success_msg notice_msg char_counter").addClass("error_msg"),$("#photo").text("The file name is "+(westerb_sal.validate_photo.fstr.length-5)+" characters long. Please keep it under 25 characters"),westerb_sal.form.record_errored_field(westerb_sal.form.fields.photo)): westerb_sal.validate_photo.pattern3.test(westerb_sal.validate_photo.fstr)&&25<westerb_sal.validate_photo.fstr.length-4?($("form.big_form input:file").addClass("error_bordered"),$("#photo").removeClass("success_msg notice_msg char_counter").addClass("error_msg"),$("#photo").text("The file name is "+(westerb_sal.validate_photo.fstr.length-4)+" characters long. Please keep it under 25 characters"),westerb_sal.form.record_errored_field(westerb_sal.form.fields.photo)):""!=westerb_sal.validate_photo.fstr&& (westerb_sal.form.remove_field_err_rec(westerb_sal.form.fields.photo),$("#photo").removeClass("error_msg notice_msg char_counter").addClass("success_msg"),$("#photo").text("Valid file provided")):($("form.big_form input:file").addClass("error_bordered"),$("#photo").removeClass("success_msg notice_msg char_counter").addClass("error_msg"),$("#photo").text("Provide a valid JPEG or PNG file"),westerb_sal.form.record_errored_field(westerb_sal.form.fields.photo)))},writable:!0,enumerable:!0,configurable:!0}); Object.defineProperty(Object.prototype.westerb_sal,"Form",{writable:!1,enumerable:!0,configurable:!0,value:function(){this_instance=this;this_instance.errors=[];this_instance.fields=Object.create(null);this_instance.validate_on_sub=Object.create(null);this_instance.update_counter_timer=null;this_instance.xhr_in_progress=!1;this_instance.xhr_submit_data=westerb_sal.create_xhr();westerb_sal.is_modal_call=$("form.big_form").hasClass("modal_dialog")?!0:!1;this_instance.xhr_submit_data.onreadystatechange= westerb_sal.is_modal_call?westerb_sal.handle_modal_submit_data_response:westerb_sal.handle_submit_data_response;"undefined"!==typeof FormData||"undefined"!==typeof File||"photo_upload"!==westerb_sal.cur_pg&&"list_albums"!==westerb_sal.cur_pg&&"list_photos"!==westerb_sal.cur_pg||$("form").attr({target:"upload_frame",action:westerb_sal.HOME+"ajax/misc_calls.php?upload_photo"+("list_photos"===westerb_sal.cur_pg?"=via_list_photos":"list_albums"===westerb_sal.cur_pg?"=via_list_albums":"")});$("form.big_form span.label").hide(); $("form.big_form span.for_radios").css({color:"#777","font-weight":"bold","font-size":"14px"});$("form.big_form .form_field").each(function(){if($(this).hasClass("p_holder")){$(this).parent("p").hasClass("non_guest")&&$(this).parent("p").hide();"caption"==$(this).attr("name")&&$("#for_caption").text("Photo caption");var a=$("#for_"+$(this).attr("name")).text();"TEXTAREA"==$(this).prop("tagName")&&$(this).css("font-size","15px");""==$(this).val()&&$(this).val(a);$(this).val()==a&&$(this).css({color:"public_index"!== westerb_sal.cur_pg||westerb_sal.blocking_login_dialog?"#777":"#444","font-weight":"bold"});$(this).focus(function(){$(this).val()==a&&$(this).val("");$(this).css({color:"#000","font-weight":"normal"})});$(this).hasClass("reqrd")||("text"==$(this).attr("type")&&$(this).focus(function(){var a=$(this),b=window.setInterval(function(){$("#"+a.attr("name")).text(parseInt(a.attr("maxlength"))-a.val().length)},80);a.bind("blur",function(){window.clearInterval(b)})}),$(this).blur(function(){""==$(this).val()&& ($(this).css({color:"public_index"===westerb_sal.cur_pg?"#444":"#777","font-weight":"bold"}),$(this).val(a))}))}"SELECT"==$(this).prop("tagName")&&("0"!=$(this).val()&&$(this).css({color:"#000","font-weight":"normal"}),$(this).change(function(){"0"!=$(this).val()?$(this).css({color:"#000","font-weight":"normal"}):$(this).css({color:"#777","font-weight":"bold"})}));$(this).hasClass("validate_on_sub")&&Object.defineProperty(this_instance.validate_on_sub,$(this).attr("name"),{value:$(this),writable:!0, enumerable:!0,configurable:!0});$(this).hasClass("radios")&&($(this).css("margin-left",$(this).attr("left")),Object.defineProperty(this_instance,$(this).attr("name"),{value:[],writable:!0,enumerable:!0,configurable:!0}),$(this).change(function(){$(this).removeClass("error_bordered");$("#"+$(this).attr("name")).text("").removeClass("error_msg");this_instance.remove_field_err_rec($(this))}),$(this).children("li").children("input").hover(function(){$(this).siblings("span.pre").css("opacity",".8")},function(){$(this).siblings("span.pre").css("opacity", ".6")}));if("radio"==$(this).attr("type"))this_instance[$(this).attr("name")+"_radios"].push($(this));else{if($(this).hasClass("msg_span")){var b='<span id="'+$(this).attr("name")+'" class="field_msg';$(this).attr("maxlength")&&(b+=" char_counter");"caption"===$(this).attr("name")&&(b+=" hash_change_removed_3 faded");"album_id"===$(this).attr("name")&&(b+=" hash_change_removed_3 faded");b+='">';$(this).attr("maxlength")&&(b=""==$(this).val()||$(this).val()==$("#for_"+$(this).attr("name")).text()? b+$(this).attr("maxlength"):b+($(this).attr("maxlength")-$(this).val().length));b+="</span>";"file"==$(this).attr("type")?(""!=$(this).val()&&$(this).val(""),$(this).parent("div.file_selector").wrap("<div id='selector_progress_wrapper' "+("photo_upload"!==westerb_sal.cur_pg?"class='blocking_dialog hash_change_removed_3 slided' ":"")+"style='width: 1000px; overflow: hidden; display: inline-block; '></div>"),$(this).parent("div.file_selector").parent("div").append(b),$(this).focus(function(){$(this).parent("div.file_selector").css("opacity", 0.8);""!=$(this).val()&&$(this).triggerHandler("blur")}),$(this).parent("div.file_selector").click(function(){$(this).children("input").focus()})):$(this).after(b)}if($(this).attr("maxlength")){var c,d=parseInt($(this).attr("maxlength"),10);$(this).keyup(function(){c=$(this).val().length;c>d&&($(this).val($(this).val().substring(0,d)),c=d);"password"==$(this).attr("type")?$("#"+$(this).siblings("input").attr("name")).text(d-c):$("#"+$(this).attr("name")).text(d-c)})}if($(this).hasClass("reqrd")){$(this).blur(function(){if(""== $(this).val()||0==$(this).val())$(this).hasClass("p_holder")&&($(this).css({color:"public_index"===westerb_sal.cur_pg?"#444":"#777","font-weight":"bold"}),$(this).val($("#for_"+$(this).attr("name")).text())),"file"==$(this).attr("type")?(b="A file will be required before submitting",$(this).parent("div.file_selector").css("opacity",0.6)):("password"==$(this).attr("type")?$(this).siblings("input").removeClass("error_bordered").addClass("notice_bordered"):$(this).removeClass("error_bordered").addClass("notice_bordered"), "SELECT"==$(this).prop("tagName")?b="A selection will be required before submitting":"comment"==$(this).attr("name")?(b="Required before submitting",910<$("div.centering:last").innerWidth()&&$("#"+$(this).attr("name")).css("font-size","13px")):b="This will have to be filled before submitting"),"password"==$(this).attr("type")?$("#"+$(this).siblings("input").attr("name")).removeClass("success_msg error_msg char_counter").addClass("notice_msg").text(b):$("#"+$(this).attr("name")).removeClass("success_msg error_msg char_counter").addClass("notice_msg").text(b)}); var g;$(this).focus(function(){$("div.message_wrapper").fadeOut(200);if("text"==$(this).attr("type")){var a=$(this);this_instance.update_counter_timer=window.setInterval(function(){$("#"+a.attr("name")).removeClass("error_msg success_msg").addClass("char_counter").text(parseInt(a.attr("maxlength"))-a.val().length)},80);a.bind("blur",function(){window.clearInterval(this_instance.update_counter_timer)})}if($(this).hasClass("has_pword")&&""==$(this).val()){var b=window.setInterval(function(){westerb_sal.form.fields.password&& ""!=westerb_sal.form.fields.password.val()&&(westerb_sal.form.fields.password_placeholder.hasClass("error_bordered")&&this_instance.remove_field_err_rec(westerb_sal.form.fields.password),westerb_sal.form.fields.password_placeholder.removeClass("error_bordered").css("display","none"),$("#"+westerb_sal.form.fields.password_placeholder.attr("name")).removeClass("notice_msg error_msg").addClass("char_counter"),$("#"+westerb_sal.form.fields.password_placeholder.attr("name")).text(parseInt(westerb_sal.form.fields.password.attr("maxlength"))- westerb_sal.form.fields.password.val().length))},80);a.bind("blur",function(){window.clearInterval(b)})}if(""==$(this).val()||0==$(this).val()||"file"==$(this).attr("type")&&$(this).hasClass("error_bordered"))$(this).removeClass("error_bordered notice_bordered"),$(this).attr("maxlength")?(g=$(this).attr("maxlength"),"comment"==$(this).attr("name")&&910<$("div.centering:last").innerWidth()&&$("#"+$(this).attr("name")).css("font-size","16px")):g="","password"==$(this).attr("type")?$("#"+$(this).siblings("input").attr("name")).removeClass("success_msg error_msg notice_msg").addClass("char_counter").text(g): $("#"+$(this).attr("name")).removeClass("success_msg error_msg notice_msg").addClass("char_counter").text(g),this_instance.remove_field_err_rec($(this))})}Object.defineProperty(this_instance.fields,$(this).attr("name"),{value:$(this),writable:!0,enumerable:!0,configurable:!0})}});westerb_sal.is_modal_call||$("form.big_form div:last").append("<div id='processing_msg' style='position: absolute; top: "+("public_index"===westerb_sal.cur_pg?99:10)+"px; left: "+("add_user"===westerb_sal.cur_pg?120:"public_index"=== westerb_sal.cur_pg?5:105)+"px; width: 140px; color: #222; font-weight: bold; '></div>");if(westerb_sal.progress_events&&("photo_upload"===westerb_sal.cur_pg||westerb_sal.is_modal_call)){var a;a="<div class='pregress_info' id='upload_progress_bar' style='position: absolute; top: 8px; left: 350px; width: 400px; border-radiu: 30px; overflow: hidden; z-index: 3000; display: none; '><div style='display: inline-block; border-top-left-radius: 35px; border-bottom-left-radius: 35px; width: 100px; height: 5px; background-color: #1C6487; '></div><div style='display: inline-block; width: 100px; height: 5px; background-color: #A20910; '></div>"; a+="<div style='display: inline-block; width: 100px; height: 5px; background-color: #C36500; '></div>";a+="<div style='display: inline-block; width: 100px; border-top-right-radius: 35px; border-bottom-right-radius: 35px; height: 5px; background-color: #93A50B; '></div>";a+="</div>";$("form.big_form div.file_selector").parent("div").append(a).after("<span class='pregress_info' id='upload_progress_percent' style='color: #222; font-weight: bold; font-size: 12px; position: absolute; top: "+("photo_upload"!== westerb_sal.cur_pg?25:85)+"px; left: "+("photo_upload"!==westerb_sal.cur_pg?364:382)+"px; z-index: 3000; display: none; '></span>")}if("photo_upload"===$("form.big_form").attr("id"))$("form.big_form .form_field[name=photo]").focus(function(){0===westerb_sal.photo_validation_sentinel&&(window.setInterval(westerb_sal.validate_photo,500),westerb_sal.photo_validation_sentinel++)});else if("add_user"===$("form.big_form").attr("id"))$("form.big_form .form_field[name=perms]").each(function(){$(this).change(function(){"1"!== $(this).val()?($("p.non_guest:first").addClass("hash_change_removed_3 slided").slideDown(200,function(){$("p.non_guest:last").addClass("hash_change_removed_3 slided").slideDown(200)}),$("p.non_guest").children("input").each(function(){westerb_sal.form.validate_on_sub[$(this).attr("name")]=$(this)})):($("p.non_guest:first").removeClass("hash_change_removed_3 slided").slideUp(200,function(){$("p.non_guest:last").removeClass("hash_change_removed_3 slided").slideUp(200)}),$("p.non_guest").children("input").each(function(){delete westerb_sal.form.validate_on_sub[$(this).attr("name")]; westerb_sal.form.remove_field_err_rec($(this))}))})}),$("form.big_form .form_field[name=new_username]").keyup(function(){var a=$(this).val().trim();/\s+/.test(a)?(window.clearInterval(westerb_sal.form.update_counter_timer),$(this).addClass("error_bordered"),$("#"+$(this).attr("name")).removeClass("char_counter").addClass("error_msg").text("No spaces are allowed between characters of the username"),westerb_sal.form.record_errored_field($(this))):"username"==a.toLowerCase()?(window.clearInterval(westerb_sal.form.update_counter_timer), $(this).addClass("error_bordered"),$("#"+$(this).attr("name")).removeClass("char_counter").addClass("error_msg").text('Sorry, "'+a+'" is not a valid username'),westerb_sal.form.record_errored_field($(this))):($(this).removeClass("error_bordered"),$("#"+$(this).attr("name")).removeClass("error_msg").addClass("char_counter"),westerb_sal.form.remove_field_err_rec($(this)))}).blur(function(){val=$(this).val().trim();val!=$("#for_"+$(this).attr("name")).text()&&/\s+/.test(val)?($(this).addClass("error_bordered"), $("#"+$(this).attr("name")).removeClass("char_counter").addClass("error_msg").text("No spaces are allowed between characters of the username"),westerb_sal.form.record_errored_field($(this))):"username"==val.toLowerCase()?($(this).addClass("error_bordered"),$("#"+$(this).attr("name")).removeClass("char_counter").addClass("error_msg").text('Sorry, "'+val+'" is not a valid username'),westerb_sal.form.record_errored_field($(this))):val!=$("#for_"+$(this).attr("name")).text()&&(westerb_sal.form.xhr_in_progress= !0,$("#"+$(this).attr("name")).get(0).processing_msg(),westerb_sal.xhr_check_u_name.open("get",westerb_sal.HOME+"ajax/misc_calls.php?u_name="+val,!0),westerb_sal.xhr_check_u_name.send(null))}),$("form.big_form .form_field[name=new_password]").keyup(function(){var a=$(this).val().trim();"password"==a.toLowerCase()?(window.clearInterval(westerb_sal.form.update_counter_timer),$(this).addClass("error_bordered"),$("#"+$(this).attr("name")).removeClass("char_counter").addClass("error_msg").text('Sorry, "'+ a+'" is a very weak password and is not allowed'),westerb_sal.form.record_errored_field($(this))):"new password"==a.toLowerCase()?(window.clearInterval(westerb_sal.form.update_counter_timer),$(this).addClass("error_bordered"),$("#"+$(this).attr("name")).removeClass("char_counter").addClass("error_msg").text('Sorry, "'+a+'" is not a valid password'),westerb_sal.form.record_errored_field($(this))):($(this).removeClass("error_bordered"),$("#"+$(this).attr("name")).removeClass("error_msg").addClass("char_counter"), westerb_sal.form.remove_field_err_rec($(this)))}).blur(function(){val=$(this).val().trim();"password"==val.toLowerCase()?($(this).addClass("error_bordered"),$("#"+$(this).attr("name")).removeClass("char_counter").addClass("error_msg").text('Sorry, "'+val+'" is a very weak password and is not allowed'),westerb_sal.form.record_errored_field($(this))):val!=$("#for_"+$(this).attr("name")).text()&&($(this).removeClass("error_bordered"),$("#"+$(this).attr("name")).removeClass("error_msg").addClass("char_counter").text(parseInt($(this).attr("maxlength"))- $(this).val().length),westerb_sal.form.remove_field_err_rec($(this)))});else if("login_form"===$("form.big_form").attr("id")){var c=$("form.big_form .form_field[name=password]"),d=$("form.big_form .form_field[name=password_placeholder]");c.parent("p").css("margin-bottom","45px").children("input").css("margin-left","0");""==c.val()&&d.css("display","inline");d.val("Password");"Password"==d.val()&&d.css({color:"#777","font-weight":"bold"});d.focus(function(){$(this).css("display","none");c.focus()}); c.focus(function(){d.css("display","none")});c.blur(function(){""==$(this).val()&&d.css("display","inline")});$("form.big_form .form_field[name=submit]").click(function(a){$(this).hasClass("login_success")||a.stopPropagation()})}}});Object.defineProperties(westerb_sal.Form.prototype,{validate:{value:function(){$("div.message_wrapper").remove();var a=null,c="";for(p in this.validate_on_sub)if(a=this.validate_on_sub[p],a.hasClass("radios"))this[p].forEach(function(c,e,b){c.get(0).checked&&a.removeClass("none_checked")}), a.hasClass("none_checked")&&(a.addClass("error_bordered"),$("#"+a.attr("name")).addClass("error_msg"),$("#"+a.attr("name")).text("Pick one of these choices before proceeding"),this.record_errored_field(a));else if(a.val()==$("#for_"+a.attr("name")).text()||""==a.val()||0==a.val())"password"==a.attr("type")?a.siblings("input").removeClass("notice_bordered").addClass("error_bordered"):a.removeClass("notice_bordered").addClass("error_bordered"),"file"==a.attr("type")?c="Provide a file to upload before proceeding": "SELECT"==a.prop("tagName")?c="Make a selection before proceeding":"comment"==a.attr("name")?(c="Required before submitting",910<$("div.centering:last").innerWidth()&&$("#"+a.attr("name")).css("font-size","13px")):c="Fill this field before proceeding","password"==a.attr("type")?$("#"+a.siblings("input").attr("name")).removeClass("notice_msg char_counter").addClass("error_msg").text(c):$("#"+a.attr("name")).removeClass("notice_msg char_counter").addClass("error_msg").text(c),this.record_errored_field(a); return 0===this.errors.length?!0:!1},writable:!0,enumerable:!0,configurable:!0},record_errored_field:{value:function(a){a=a.attr("name");-1===this.errors.indexOf(a)&&this.errors.push(a)},writable:!0,enumerable:!0,configurable:!0},remove_field_err_rec:{value:function(a){a=a.attr("name");a=this.errors.indexOf(a);-1!==a&&this.errors.splice(a,1)},writable:!0,enumerable:!0,configurable:!0}});Object.defineProperty(Object.prototype.westerb_sal,"form",{writable:!0,enumerable:!0,configurable:!0,value:new westerb_sal.Form}); $("body").on("submit","form.big_form",function(a){if(westerb_sal.form.xhr_in_progress)return $(this).hasClass("modal_dialog")?westerb_sal.please_wait_msg(a,!0):westerb_sal.please_wait_msg(a),!1;if(westerb_sal.form.validate()){if("list_albums"===westerb_sal.cur_pg&&westerb_sal.modal_caller_parent.hasClass("album")||"list_photos"===westerb_sal.cur_pg||"photo_upload"===westerb_sal.cur_pg){for(h=0;1E4>h;h++)window.clearInterval(h);westerb_sal.photo_validation_sentinel=0;westerb_sal.check_login_timer= window.setInterval(westerb_sal.check_login,6E3)}westerb_sal.submit_form_data();return"undefined"===typeof FormData&&"undefined"===typeof File&&!westerb_sal.blocking_login_dialog&&("photo_upload"===westerb_sal.cur_pg||"list_albums"===westerb_sal.cur_pg&&westerb_sal.modal_caller_parent.hasClass("album")||"list_photos"===westerb_sal.cur_pg)?!0:!1}return!1})});